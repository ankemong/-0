<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1512591473794042"
        crossorigin="anonymous"></script>
    <title>精准点击训练器 - 提升反应速度和精准度</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .game-container {
            text-align: center;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
        }

        .game-area {
            width: 100%;
            height: 100vh;
            position: relative;
            cursor: crosshair;
        }

        .target {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff4757, #ff3742);
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
            cursor: pointer;
            transition: all 0.1s ease;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .target:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.8);
        }

        .target.hit {
            background: radial-gradient(circle, #00ff88, #00e676);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .start-screen, .game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* 为底部导航留出空间 */
        }

        .start-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px;
            width: 100%;
            margin: auto;
            padding: 20px 0;
        }

        .game-over-screen {
            justify-content: center;
        }

        .title {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .btn {
            padding: 15px 40px;
            font-size: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
            max-width: 600px;
        }

        .difficulty-btn {
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .difficulty-btn.active {
            background: rgba(0,255,136,0.2);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }

        .difficulty-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .difficulty-stats {
            font-size: 11px;
            opacity: 0.7;
            line-height: 1.3;
        }




        .settings-panel {
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .settings-panel h4 {
            color: #00ff88;
            text-align: center;
            margin-bottom: 15px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-item label {
            font-size: 12px;
            color: #ccc;
            font-weight: 500;
        }

        .setting-item select {
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 13px;
            cursor: pointer;
        }

        .setting-item select:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 5px rgba(0,255,136,0.3);
        }

        .final-stats {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .accuracy-bar {
            width: 300px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px auto;
        }

        .accuracy-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa726, #00ff88);
            transition: width 0.5s ease;
        }

        .progress-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
        }

        .progress-ring-circle {
            stroke: rgba(0,255,136,0.3);
            stroke-width: 4;
            fill: transparent;
            r: 45;
            cx: 50;
            cy: 50;
        }

        .progress-ring-fill {
            stroke: #00ff88;
            stroke-width: 4;
            fill: transparent;
            r: 45;
            cx: 50;
            cy: 50;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.1s linear;
        }

        /* 舒尔特方格样式 */
        .schulte-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            gap: 4px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(0,255,136,0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .schulte-grid.size-3x3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .schulte-grid.size-4x4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .schulte-grid.size-5x5 {
            grid-template-columns: repeat(5, 1fr);
        }

        .schulte-grid.size-2x2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .schulte-grid.size-6x6 {
            grid-template-columns: repeat(6, 1fr);
        }

        .schulte-grid.size-7x7 {
            grid-template-columns: repeat(7, 1fr);
        }

        .schulte-grid.size-8x8 {
            grid-template-columns: repeat(8, 1fr);
        }

        .schulte-cell {
            width: 96px;
            height: 96px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.18s ease;
            user-select: none;
        }

        /* 不同尺寸方格的单元格大小调整（更大） */
        .schulte-grid.size-2x2 .schulte-cell { width: 120px; height: 120px; font-size: 36px; }
        .schulte-grid.size-3x3 .schulte-cell { width: 100px; height: 100px; font-size: 32px; }
        .schulte-grid.size-4x4 .schulte-cell { width: 96px; height: 96px; font-size: 28px; }
        .schulte-grid.size-5x5 .schulte-cell { width: 88px; height: 88px; font-size: 24px; }
        .schulte-grid.size-6x6 .schulte-cell { width: 80px; height: 80px; font-size: 20px; }
        .schulte-grid.size-7x7 .schulte-cell { width: 72px; height: 72px; font-size: 18px; }
        .schulte-grid.size-8x8 .schulte-cell { width: 64px; height: 64px; font-size: 16px; }

        .schulte-cell:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: #00ff88;
            transform: scale(1.05);
        }

        .schulte-cell.found {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #00ff88;
            color: #fff;
            animation: schulteSuccess 0.3s ease;
        }

        .schulte-cell.wrong {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #ff4757;
            animation: schulteError 0.3s ease;
        }

        @keyframes schulteSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @keyframes schulteError {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .schulte-info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid rgba(0,255,136,0.3);
            color: white;
            text-align: center;
        }

        .schulte-current-number {
            font-size: 24px;
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .schulte-stats {
            font-size: 14px;
            opacity: 0.8;
        }

        .schulte-size-selector {
            margin: 20px 0;
            text-align: center;
        }

        .schulte-size-btn {
            padding: 10px 20px;
            margin: 0 5px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .schulte-size-btn:hover,
        .schulte-size-btn.active {
            background: rgba(0,255,136,0.2);
            border-color: #00ff88;
        }

        /* 训练模式选择卡片 */
        .training-mode-selector {
            margin: 30px 0;
            text-align: center;
        }

        /* 页面底部导航 - 固定在页面最底部，不随滚动移动 */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            display: flex;
            justify-content: center;
            gap: 15px;
            background: rgba(0,0,0,0.8);
            padding: 12px 20px;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 -2px 20px rgba(0,0,0,0.3);
        }

        .footer-nav-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .footer-nav-btn:hover {
            background: rgba(0,255,136,0.1);
            border-color: rgba(0,255,136,0.3);
            color: #00ff88;
            transform: translateY(-1px);
        }

        /* 信息弹窗样式 */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .info-modal-content {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
            position: relative;
        }

        .info-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0,255,136,0.3);
        }

        .info-modal-title {
            color: #00ff88;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        .info-modal-close {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .info-modal-close:hover {
            background: rgba(255,71,87,0.2);
            border-color: #ff4757;
        }

        .info-modal-body {
            line-height: 1.6;
            font-size: 14px;
        }

        .info-modal-body h3 {
            color: #00ff88;
            margin: 20px 0 10px 0;
        }

        .info-modal-body p {
            margin: 10px 0;
            opacity: 0.9;
        }

        .info-modal-body ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-modal-body li {
            margin: 5px 0;
            opacity: 0.9;
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 20px 0;
            max-width: 800px;
            margin: 20px auto;
        }

        .mode-card {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mode-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,255,136,0.2);
        }

        .mode-card.active {
            background: rgba(0,255,136,0.15);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
            animation: modeIconFloat 3s ease-in-out infinite;
        }

        @keyframes modeIconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .mode-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 8px;
        }

        .mode-desc {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* 舒尔特方格设置区域 */
        .schulte-settings {
            margin: 30px 0;
        }

        .reaction-settings {
            margin: 30px 0;
        }

        .schulte-size-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .schulte-size-btn {
            padding: 12px 8px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .size-label {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .size-desc {
            font-size: 11px;
            opacity: 0.7;
            line-height: 1.2;
        }

        .schulte-info-panel {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        .schulte-info-panel h5 {
            color: #00ff88;
            margin-bottom: 10px;
            text-align: center;
        }

        .schulte-info-panel ul {
            list-style: none;
            padding: 0;
        }

        .schulte-info-panel li {
            margin: 5px 0;
            font-size: 13px;
            opacity: 0.9;
        }

        /* 广告位样式 */
        .ad-banner {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .ad-banner::before {
            content: '广告';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 10px;
            opacity: 0.5;
        }
        
        .ad-banner.large {
            min-height: 250px;
        }
        
        .ad-banner.small {
            min-height: 80px;
            font-size: 12px;
        }
        
    /* VIP/账户/支付样式与专业模式样式已移除以简化项目。 */
        
        .pro-mode-btn:hover {
            background: rgba(255,215,0,0.2);
            border-color: rgba(255,215,0,0.5);
            transform: translateY(-2px);
        }
        
        .pro-mode-btn.active {
            background: rgba(255,215,0,0.25);
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255,215,0,0.4);
        }
        
    .pro-mode-icon { display: none !important; }
    .pro-mode-name { display: none !important; }
        
        .pro-mode-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.2;
            color: #ccc;
        }
        
        /* 详细数据分析样式 */
        .detailed-stats {
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-title {
            font-size: 14px;
            color: #00ff88;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-desc {
            font-size: 12px;
            opacity: 0.7;
            line-height: 1.3;
        }
        
        .progress-chart {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .chart-title {
            color: #00ff88;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-label {
            min-width: 80px;
            font-size: 12px;
            text-align: right;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa726, #00ff88);
            transition: width 0.8s ease;
        }
        
        .progress-value {
            min-width: 50px;
            font-size: 12px;
            font-weight: bold;
            text-align: left;
        }
        
        /* 专属成就样式 */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        
        .achievement-card {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .achievement-card.unlocked {
            background: rgba(255,215,0,0.15);
            border-color: rgba(255,215,0,0.5);
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }
        
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        
        .achievement-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #00ff88;
        }
        
        .achievement-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.2;
        }

    </style>
</head>
<body>
    <div class="game-container">
        <!-- 开始界面 -->
        <div class="start-screen" id="startScreen">
            <div class="title">🎯 精准点击训练器</div>
            <div class="subtitle" data-i18n="subtitle">专业级反应速度和精准度训练平台</div>
            <div style="position: absolute; top: 18px; right: 18px;">
                <select id="langSelect" onchange="changeLanguage(this.value)">
                    <option value="zh">中文</option>
                    <option value="en">English</option>
                </select>
            </div>
            
            <!-- 训练模式选择 -->
            <div class="training-mode-selector">
                <h3 style="color: #00ff88; margin-bottom: 20px;" data-i18n="choose_mode">🎮 选择训练模式</h3>
                <div class="mode-cards">
                    <div class="mode-card active" data-mode="reaction">
                        <div class="mode-icon">🎯</div>
                        <div class="mode-title" data-i18n="reaction_mode">反应速度训练</div>
                        <div class="mode-desc" data-i18n="reaction_desc">点击随机目标，提升反应速度和精准度</div>
                    </div>
                    <div class="mode-card" data-mode="tracking">
                        <div class="mode-icon">🎮</div>
                        <div class="mode-title" data-i18n="tracking_mode">追踪训练</div>
                        <div class="mode-desc" data-i18n="tracking_desc">跟踪移动目标，提升动态反应能力</div>
                    </div>
                    <div class="mode-card" data-mode="schulte">
                        <div class="mode-icon">🧠</div>
                        <div class="mode-title" data-i18n="schulte_mode">舒尔特方格训练</div>
                        <div class="mode-desc" data-i18n="schulte_desc">按顺序点击数字，提升注意力和视觉搜索能力</div>
                    </div>
                </div>
            </div>

            <!-- 广告位已移除：使用页面 head 中的 AdSense 脚本提供广告 -->

            <!-- 反应速度训练设置 -->
            <div class="reaction-settings" id="reactionSettings">
                <h4 style="color: #00ff88; margin-bottom: 15px;">🎯 反应速度训练设置</h4>
                
                <div class="difficulty-selector">
                    <div class="difficulty-btn active" data-difficulty="easy">
                        <div class="difficulty-label" data-i18n="easy_label">🟢 新手</div>
                        <div class="difficulty-stats" data-i18n="easy_stats">目标: 60px<br>持续: 2.5s<br>间隔: 800ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="medium">
                        <div class="difficulty-label" data-i18n="medium_label">🟡 进阶</div>
                        <div class="difficulty-stats" data-i18n="medium_stats">目标: 45px<br>持续: 2.0s<br>间隔: 600ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="hard">
                        <div class="difficulty-label" data-i18n="hard_label">🟠 困难</div>
                        <div class="difficulty-stats" data-i18n="hard_stats">目标: 35px<br>持续: 1.5s<br>间隔: 400ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="expert">
                        <div class="difficulty-label" data-i18n="expert_label">🔴 专家</div>
                        <div class="difficulty-stats" data-i18n="expert_stats">目标: 25px<br>持续: 1.2s<br>间隔: 300ms</div>
                    </div>
                </div>
                
                <!-- 专业训练模式（已移除） -->
                
                <div class="settings-panel">
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label data-i18n="label_duration">游戏时长</label>
                            <select id="game-duration">
                                <option value="30" data-i18n="opt_30s">30秒</option>
                                <option value="60" selected data-i18n="opt_60s">60秒</option>
                                <option value="90" data-i18n="opt_90s">90秒</option>
                                <option value="120" data-i18n="opt_2min">2分钟</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_target_style">目标样式</label>
                            <select id="target-style">
                                <option value="head" selected data-i18n="opt_head">头部形状</option>
                                <option value="circle" data-i18n="opt_circle">圆形</option>
                                <option value="square" data-i18n="opt_square">方形</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_sound">音效反馈</label>
                            <select id="sound-effects">
                                <option value="on" selected data-i18n="opt_on">开启</option>
                                <option value="off" data-i18n="opt_off">关闭</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_training_mode">训练模式</label>
                            <select id="training-mode">
                                <option value="normal" selected data-i18n="mode_normal">普通模式</option>
                                <option value="flick" data-i18n="mode_flick">快速切换</option>
                                <option value="tracking" data-i18n="mode_tracking">跟踪训练</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 追踪训练设置 -->
            <div class="tracking-settings" id="trackingSettings" style="display: none;">
                <h4 style="color: #00ff88; margin-bottom: 15px;">🎮 追踪训练设置</h4>
                
                <div class="difficulty-selector">
                    <div class="difficulty-btn" data-difficulty="slow">
                        <div class="difficulty-label">🐢 缓慢</div>
                        <div class="difficulty-stats">目标: 50px<br>移动: 2px/帧<br>方向: 稳定</div>
                    </div>
                    <div class="difficulty-btn active" data-difficulty="medium">
                        <div class="difficulty-label">🎯 普通</div>
                        <div class="difficulty-stats">目标: 40px<br>移动: 3px/帧<br>方向: 随机</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="fast">
                        <div class="difficulty-label">⚡ 挑战</div>
                        <div class="difficulty-stats">目标: 30px<br>移动: 4px/帧<br>方向: 改变</div>
                    </div>
                </div>
                
                <div class="settings-panel">
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>训练时长</label>
                            <select id="tracking-duration">
                                <option value="60" selected>60秒</option>
                                <option value="90">90秒</option>
                                <option value="120">2分钟</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>音效反馈</label>
                            <select id="tracking-sound-effects">
                                <option value="on" selected>开启</option>
                                <option value="off">关闭</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="schulte-info-panel">
                    <h5>💫 训练价值：</h5>
                    <ul>
                        <li>• 提升动态视觉追踪能力</li>
                        <li>• 增强手眼协调性</li>
                        <li>• 训练预测判断能力</li>
                        <li>• 提升反应速度</li>
                    </ul>
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.7; text-align: center;">
                        💡 保持鼠标在目标上，跟随其移动轨迹
                    </div>
                </div>
            </div>
            

            <!-- 舒尔特方格训练设置 -->
            <div class="schulte-settings" id="schulteSettings" style="display: none;">
                <h4 style="color: #00ff88; margin-bottom: 15px;">🧠 舒尔特方格训练设置</h4>
                
                <div class="schulte-size-selector">
                    <button class="schulte-size-btn" data-size="2">
                        <div class="size-label">🌱 2x2</div>
                        <div class="size-desc">初学者 - 4个数字</div>
                    </button>
                    <button class="schulte-size-btn active" data-size="3">
                        <div class="size-label">🟢 3x3</div>
                        <div class="size-desc">入门级 - 9个数字</div>
                    </button>
                    <button class="schulte-size-btn" data-size="4">
                        <div class="size-label">🟡 4x4</div>
                        <div class="size-desc">进阶级 - 16个数字</div>
                    </button>
                    <button class="schulte-size-btn" data-size="5">
                        <div class="size-label">🟠 5x5</div>
                        <div class="size-desc">中级 - 25个数字</div>
                    </button>
                    <button class="schulte-size-btn" data-size="6">
                        <div class="size-label">🟣 6x6</div>
                        <div class="size-desc">高级 - 36个数字</div>
                    </button>
                    <button class="schulte-size-btn" data-size="7">
                        <div class="size-label">🔴 7x7</div>
                        <div class="size-desc">专家级 - 49个数字</div>
                    </button>
                    <button class="schulte-size-btn" data-size="8">
                        <div class="size-label">⚫ 8x8</div>
                        <div class="size-desc">大师级 - 64个数字</div>
                    </button>
                </div>
                
                <div class="settings-panel">
                    <div class="setting-item" style="text-align: center;">
                        <label>音效反馈</label>
                        <select id="schulte-sound-effects">
                            <option value="on" selected>开启</option>
                            <option value="off">关闭</option>
                        </select>
                    </div>
                </div>
                
                <div class="schulte-info-panel">
                    <h5>💫 训练价值：</h5>
                    <ul>
                        <li>• 提升注意力集中度</li>
                        <li>• 增强视觉搜索能力</li>
                        <li>• 训练周边视觉</li>
                        <li>• 改善认知处理速度</li>
                    </ul>
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.7; text-align: center;">
                        💡 建议从小尺寸开始，逐渐挑战更大方格
                    </div>
                </div>
            </div>
            
            <button class="btn" id="startTrainingBtn" onclick="startTraining()">开始训练</button>
            <!-- 专业训练按钮已移除 -->
            
            <!-- VIP会员推广横幅 -->
            <!-- VIP banner 已移除 -->
            
            <!-- 页面底部导航 - 只在开始界面显示 -->
            <div class="footer-nav">
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('about')">关于我们</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('contact')">联系我们</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('privacy')">隐私政策</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('features')">核心优势</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('disclaimer')">免责声明</a>
                <!-- 账户入口已移除 -->
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="header" id="gameHeader" style="display: none;">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">得分</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">命中率</div>
                    <div class="stat-value" id="accuracy">100%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">平均反应</div>
                    <div class="stat-value" id="avgReaction">0ms</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">剩余时间</div>
                    <div class="stat-value" id="timeLeft">30s</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">连击</div>
                    <div class="stat-value" id="combo">0</div>
                </div>
            </div>
        </div>

        <div class="game-area" id="gameArea"></div>

        <!-- 游戏结束界面 -->
        <div class="game-over-screen" id="gameOverScreen" style="display: none;">
            <div class="title">🏆 训练完成</div>
            
            <div class="final-stats" id="finalStats">
                <!-- 统计数据将在这里显示 -->
            </div>
            
            <button class="btn" onclick="restartGame()">再次训练</button>
            <button class="btn" onclick="backToMenu()">返回菜单</button>
        </div>
    </div>


    <!-- 信息弹窗 -->
    <div class="info-modal" id="infoModal">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h2 class="info-modal-title" id="infoModalTitle">标题</h2>
                <button class="info-modal-close" onclick="closeInfoModal()">&times;</button>
            </div>
            <div class="info-modal-body" id="infoModalBody">
                <!-- 内容将在这里动态加载 -->
            </div>
        </div>
    </div>

    <!-- 购买功能已取消 -->

    <!-- VIP 功能已取消 -->

    <!-- 账户系统已取消 -->

    <!-- 游戏结束广告位已移除；广告由 head 中的 AdSense 脚本提供 -->

    <script>
        let gameState = {
            score: 0,
            hits: 0,
            misses: 0,
            totalClicks: 0,
            reactionTimes: [],
            combo: 0,
            maxCombo: 0,
            gameTime: 60,
            totalGameTime: 60,
            currentTarget: null,
            targetStartTime: 0,
            gameActive: false,
            difficulty: 'easy',
            targetStyle: 'head',
            soundEnabled: true,
            trainingMode: 'normal',
            schulteSize: 3,
            schulteNumbers: [],
            schulteCurrentNumber: 1,
            schulteStartTime: 0
        };

        // 音效系统
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(frequency, duration, type = 'sine') {
            if (!gameState.soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        const difficulties = {
            easy: { targetSize: 60, targetTime: 2500, spawnDelay: 800, timeBonus: 1 },
            medium: { targetSize: 45, targetTime: 2000, spawnDelay: 600, timeBonus: 1.5 },
            hard: { targetSize: 35, targetTime: 1500, spawnDelay: 400, timeBonus: 2 },
            expert: { targetSize: 25, targetTime: 1200, spawnDelay: 300, timeBonus: 2.5 }
        };

        // 难度选择 - 改进事件监听器
        function setupDifficultyButtons() {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 找到相同父元素下的所有难度按钮
                    const parent = this.closest('.difficulty-selector');
                    parent.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameState.difficulty = this.dataset.difficulty;
                    console.log('难度设置为:', gameState.difficulty);
                });
            });
        }
        
        // 初始化难度按钮
        setupDifficultyButtons();

        // 舒尔特方格大小选择
        document.querySelectorAll('.schulte-size-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.schulte-size-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                gameState.schulteSize = parseInt(this.dataset.size);
            });
        });

        // 训练模式卡片选择
        document.querySelectorAll('.mode-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                const mode = this.dataset.mode;
                const reactionSettings = document.getElementById('reactionSettings');
                const trackingSettings = document.getElementById('trackingSettings');
                const schulteSettings = document.getElementById('schulteSettings');
                
                // 隐藏所有设置面板
                reactionSettings.style.display = 'none';
                trackingSettings.style.display = 'none';
                schulteSettings.style.display = 'none';
                
                // 显示对应设置面板并设置训练模式
                switch(mode) {
                    case 'reaction':
                        reactionSettings.style.display = 'block';
                        gameState.trainingMode = 'reaction';
                        break;
                    case 'tracking':
                        trackingSettings.style.display = 'block';
                        gameState.trainingMode = 'tracking';
                        // 初始化追踪训练的默认雾度
                        gameState.difficulty = 'medium';
                        break;
                    case 'schulte':
                        schulteSettings.style.display = 'block';
                        gameState.trainingMode = 'schulte';
                        break;
                }
            });
        });

        function startTraining() {
            document.getElementById('startScreen').style.display = 'none';
            
            if (gameState.trainingMode === 'schulte') {
                // 舒尔特方格训练
                const schulteSoundEnabled = document.getElementById('schulte-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    soundEnabled: schulteSoundEnabled,
                    schulteNumbers: [],
                    schulteCurrentNumber: 1,
                    schulteStartTime: 0
                };
                
                startSchulteGame();
            } else if (gameState.trainingMode === 'tracking') {
                // 追踪训练
                const duration = parseInt(document.getElementById('tracking-duration').value);
                const soundEnabled = document.getElementById('tracking-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameTime: duration,
                    totalGameTime: duration,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    soundEnabled: soundEnabled,
                    // 追踪训练专用状态
                    trackingTarget: null,
                    trackingStartTime: 0,
                    trackingScore: 0,
                    trackingTime: 0, // 鼠标在目标上的时间
                    isTracking: false,
                    trackingAccuracy: 0
                };
                
                startTrackingGame();
            } else if (gameState.trainingMode === 'sequence') {
                // 序列训练
                const rounds = parseInt(document.getElementById('sequence-rounds').value);
                const soundEnabled = document.getElementById('sequence-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameActive: true,
                    soundEnabled: soundEnabled,
                    // 序列训练专用状态
                    sequenceRounds: rounds,
                    currentRound: 0,
                    sequenceTargets: [],
                    currentSequence: [],
                    playerSequence: [],
                    isShowingSequence: false,
                    isPlayerTurn: false,
                    sequenceIndex: 0,
                    sequenceStartTime: 0
                };
                
                startSequenceGame();
            } else {
                // 反应速度训练
                const duration = parseInt(document.getElementById('game-duration').value);
                const targetStyle = document.getElementById('target-style').value;
                const soundEnabled = document.getElementById('sound-effects').value === 'on';
                const trainingMode = document.getElementById('training-mode').value;
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameTime: duration,
                    totalGameTime: duration,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    targetStyle: targetStyle,
                    soundEnabled: soundEnabled,
                    trainingMode: trainingMode,
                    schulteNumbers: [],
                    schulteCurrentNumber: 1,
                    schulteStartTime: 0
                };
                
                document.getElementById('gameHeader').style.display = 'block';
                updateStats();
                startGameTimer();
                spawnTarget();
            }
        }
        
        // 兼容旧的startGame函数
        function startGame() {
            startTraining();
        }

        function startGameTimer() {
            const timer = setInterval(() => {
                gameState.gameTime--;
                document.getElementById('timeLeft').textContent = gameState.gameTime + 's';
                
                if (gameState.gameTime <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }

        function spawnTarget() {
            if (!gameState.gameActive) return;
            
            // 清除当前目标
            if (gameState.currentTarget) {
                gameState.currentTarget.remove();
                gameState.misses++;
                gameState.combo = 0;
                gameState.totalClicks++;
            }
            
            const gameArea = document.getElementById('gameArea');
            const target = document.createElement('div');
            target.className = 'target';
            
            const config = difficulties[gameState.difficulty];
            
            target.style.width = config.targetSize + 'px';
            target.style.height = config.targetSize + 'px';
            
            // 根据设置应用目标样式
            switch(gameState.targetStyle) {
                case 'circle':
                    target.style.borderRadius = '50%';
                    target.style.background = 'radial-gradient(circle, #ff4757, #ff3742)';
                    break;
                case 'square':
                    target.style.borderRadius = '8px';
                    target.style.background = 'linear-gradient(135deg, #ff4757, #ff3742)';
                    break;
                case 'head':
                default:
                    target.style.borderRadius = '50% 50% 20% 20%';
                    target.style.background = 'radial-gradient(ellipse at center top, #ff4757, #ff3742)';
                    break;
            }
            
            // 随机位置（避免边缘）
            const margin = config.targetSize;
            const x = Math.random() * (window.innerWidth - 2 * margin) + margin;
            const y = Math.random() * (window.innerHeight - 200 - 2 * margin) + margin + 100;
            
            target.style.left = x - config.targetSize/2 + 'px';
            target.style.top = y - config.targetSize/2 + 'px';
            
            // 添加点击事件
            target.addEventListener('click', hitTarget);
            
            gameArea.appendChild(target);
            gameState.currentTarget = target;
            gameState.targetStartTime = Date.now();
            
            // 设置目标消失时间
            setTimeout(() => {
                if (gameState.currentTarget === target && gameState.gameActive) {
                    target.remove();
                    gameState.misses++;
                    gameState.combo = 0;
                    gameState.totalClicks++;
                    updateStats();
                    
                    // 生成下一个目标
                    setTimeout(() => spawnTarget(), config.spawnDelay);
                }
            }, config.targetTime);
        }

        function hitTarget(event) {
            event.preventDefault();
            if (!gameState.gameActive) return;
            
            const reactionTime = Date.now() - gameState.targetStartTime;
            gameState.reactionTimes.push(reactionTime);
            
            const config = difficulties[gameState.difficulty];
            let points = Math.max(100 - Math.floor(reactionTime / 10), 10);
            points = Math.floor(points * config.timeBonus);
            
            // 连击奖励
            if (gameState.combo > 0) {
                points += gameState.combo * 5;
            }
            
            gameState.score += points;
            gameState.hits++;
            gameState.combo++;
            gameState.totalClicks++;
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
            
            // 音效反馈
            const hitFreq = 600 + (gameState.combo * 50); // 连击越高音调越高
            playSound(hitFreq, 0.1);
            
            // 视觉反馈
            event.target.classList.add('hit');
            setTimeout(() => {
                if (event.target) event.target.remove();
            }, 100);
            
            gameState.currentTarget = null;
            updateStats();
            
            // 生成下一个目标
            setTimeout(() => spawnTarget(), config.spawnDelay);
        }

        // 点击空白区域
        document.getElementById('gameArea').addEventListener('click', function(event) {
            if (event.target === this && gameState.gameActive) {
                gameState.misses++;
                gameState.combo = 0;
                gameState.totalClicks++;
                playSound(200, 0.2); // 失误音效
                updateStats();
            }
        });

        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            document.getElementById('avgReaction').textContent = avgReaction + 'ms';
            
            document.getElementById('combo').textContent = gameState.combo;
        }

        function endGame() {
            gameState.gameActive = false;
            
            if (gameState.currentTarget) {
                gameState.currentTarget.remove();
            }
            
            document.getElementById('gameHeader').style.display = 'none';
            showGameOverScreen();
        }

        function showGameOverScreen() {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            
            // 评估等级
            let rank = '';
            let rankColor = '';
            if (accuracy >= 90 && avgReaction <= 400) {
                rank = '神枪手 🏆';
                rankColor = '#FFD700';
            } else if (accuracy >= 80 && avgReaction <= 500) {
                rank = '精英射手 🥇';
                rankColor = '#C0C0C0';
            } else if (accuracy >= 70 && avgReaction <= 600) {
                rank = '熟练射手 🥈';
                rankColor = '#CD7F32';
            } else if (accuracy >= 60) {
                rank = '新手射手 🥉';
                rankColor = '#87CEEB';
            } else {
                rank = '需要更多练习 💪';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">总得分: ${gameState.score}</div>
                        <div>命中: ${gameState.hits} / 总点击: ${gameState.totalClicks}</div>
                        <div>命中率: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>平均反应时间: ${avgReaction}ms</div>
                        <div>最佳连击: ${gameState.maxCombo}</div>
                        <div>难度: ${gameState.difficulty.toUpperCase()}</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">精准度评估:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>💡 提升建议:</p>
                    ${avgReaction > 500 ? '<p>• 尝试预判目标位置，提前准备点击</p>' : ''}
                    ${accuracy < 80 ? '<p>• 专注精准度而非速度，先求准再求快</p>' : ''}
                    ${gameState.maxCombo < 5 ? '<p>• 保持冷静，建立稳定的连击节奏</p>' : ''}
                    <p>• 建议每天训练10-15分钟以获得最佳效果</p>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <div style="font-size: 14px; margin-bottom: 10px;">历史最佳记录:</div>
                    <div id="bestRecord" style="color: #00ff88; font-weight: bold;">首次游戏</div>
                </div>
            `;
            
            // 保存和显示最佳记录
            saveBestRecord(accuracy, avgReaction, gameState.score);
            
            // 检查成就
            checkAchievements({
                accuracy: accuracy,
                avgReaction: avgReaction,
                score: gameState.score,
                maxCombo: gameState.maxCombo
            });

            // VIP 专属：显示详细统计并检查VIP成就
            if (vipStatus.isVIP) {
                showDetailedStats({ accuracy, avgReaction, score: gameState.score, maxCombo: gameState.maxCombo });
                checkVIPAchievements({ accuracy, avgReaction, score: gameState.score, maxCombo: gameState.maxCombo });
            }
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // 增强的记录系统
        function saveBestRecord(accuracy, avgReaction, score) {
            const currentRecord = {
                accuracy: accuracy,
                avgReaction: avgReaction,
                score: score,
                difficulty: gameState.difficulty,
                trainingMode: gameState.trainingMode,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            // 保存最佳记录
            const bestRecord = JSON.parse(localStorage.getItem('reactionGameBest') || '{}');
            
            if (!bestRecord.score || score > bestRecord.score) {
                localStorage.setItem('reactionGameBest', JSON.stringify(currentRecord));
                document.getElementById('bestRecord').textContent = 
                    `准确率: ${accuracy}% | 反应: ${avgReaction}ms | 得分: ${score}`;
                playSound(800, 0.3); // 新记录音效
            } else {
                document.getElementById('bestRecord').textContent = 
                    `准确率: ${bestRecord.accuracy}% | 反应: ${bestRecord.avgReaction}ms | 得分: ${bestRecord.score}`;
            }
            
            // 保存历史记录
            saveTrainingHistory(currentRecord);
        }
        
        // 保存训练历史
        function saveTrainingHistory(record) {
            let history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            history.push(record);
            
            // 保留最近100次记录
            if (history.length > 100) {
                history = history.slice(-100);
            }
            
            localStorage.setItem('trainingHistory', JSON.stringify(history));
        }
        
        // 获取训练统计
        function getTrainingStats() {
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            const recent = history.slice(-10); // 最近10次训练
            
            if (recent.length === 0) return null;
            
            const avgAccuracy = recent.reduce((sum, record) => sum + record.accuracy, 0) / recent.length;
            const avgReaction = recent.reduce((sum, record) => sum + record.avgReaction, 0) / recent.length;
            const avgScore = recent.reduce((sum, record) => sum + record.score, 0) / recent.length;
            
            const improvement = {
                accuracy: recent.length > 1 ? recent[recent.length-1].accuracy - recent[0].accuracy : 0,
                reaction: recent.length > 1 ? recent[0].avgReaction - recent[recent.length-1].avgReaction : 0,
                score: recent.length > 1 ? recent[recent.length-1].score - recent[0].score : 0
            };
            
            return {
                totalGames: history.length,
                recentGames: recent.length,
                avgAccuracy: Math.round(avgAccuracy),
                avgReaction: Math.round(avgReaction),
                avgScore: Math.round(avgScore),
                improvement
            };
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            startGame();
        }

        function backToMenu() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }







        // 舒尔特方格训练功能
        function startSchulteGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // 创建舒尔特方格信息面板
            const infoPanel = document.createElement('div');
            infoPanel.className = 'schulte-info';
            infoPanel.innerHTML = `
                <div class="schulte-current-number">寻找数字: ${gameState.schulteCurrentNumber}</div>
                <div class="schulte-stats">时间: <span id="schulteTime">0</span>s | 完成: <span id="schulteProgress">0/${gameState.schulteSize * gameState.schulteSize}</span></div>
            `;
            gameArea.appendChild(infoPanel);
            
            // 创建方格
            createSchulteGrid();
            
            // 开始计时
            gameState.schulteStartTime = Date.now();
            startSchulteTimer();
        }
        
        function createSchulteGrid() {
            const gameArea = document.getElementById('gameArea');
            const gridSize = gameState.schulteSize;
            const totalNumbers = gridSize * gridSize;
            
            // 生成随机数字数组
            gameState.schulteNumbers = Array.from({length: totalNumbers}, (_, i) => i + 1);
            for (let i = gameState.schulteNumbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.schulteNumbers[i], gameState.schulteNumbers[j]] = [gameState.schulteNumbers[j], gameState.schulteNumbers[i]];
            }
            
            // 创建网格
            const grid = document.createElement('div');
            grid.className = `schulte-grid size-${gridSize}x${gridSize}`;
            
            for (let i = 0; i < totalNumbers; i++) {
                const cell = document.createElement('div');
                cell.className = 'schulte-cell';
                cell.textContent = gameState.schulteNumbers[i];
                cell.dataset.number = gameState.schulteNumbers[i];
                cell.addEventListener('click', handleSchulteClick);
                grid.appendChild(cell);
            }
            
            gameArea.appendChild(grid);
        }
        
        function handleSchulteClick(event) {
            if (!gameState.gameActive) return;
            
            const clickedNumber = parseInt(event.target.dataset.number);
            
            if (clickedNumber === gameState.schulteCurrentNumber) {
                // 正确点击
                event.target.classList.add('found');
                gameState.schulteCurrentNumber++;
                gameState.hits++;
                
                const reactionTime = Date.now() - gameState.schulteStartTime;
                gameState.reactionTimes.push(reactionTime);
                
                playSound(600 + (gameState.schulteCurrentNumber * 20), 0.1);
                
                // 更新显示
                document.querySelector('.schulte-current-number').textContent = 
                    `寻找数字: ${gameState.schulteCurrentNumber}`;
                document.getElementById('schulteProgress').textContent = 
                    `${gameState.schulteCurrentNumber - 1}/${gameState.schulteSize * gameState.schulteSize}`;
                
                // 检查是否完成
                if (gameState.schulteCurrentNumber > gameState.schulteSize * gameState.schulteSize) {
                    endSchulteGame();
                }
            } else {
                // 错误点击
                event.target.classList.add('wrong');
                gameState.misses++;
                playSound(200, 0.2);
                
                setTimeout(() => {
                    event.target.classList.remove('wrong');
                }, 300);
            }
            
            gameState.totalClicks++;
        }
        
        function startSchulteTimer() {
            const timer = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(timer);
                    return;
                }
                
                const elapsed = Math.floor((Date.now() - gameState.schulteStartTime) / 1000);
                document.getElementById('schulteTime').textContent = elapsed;
            }, 100);
        }
        
        function endSchulteGame() {
            gameState.gameActive = false;
            const completionTime = Math.floor((Date.now() - gameState.schulteStartTime) / 1000);
            
            // 计算得分
            const baseScore = gameState.schulteSize * gameState.schulteSize * 100;
            const timeBonus = Math.max(0, 300 - completionTime) * 10; // 时间越短奖励越高
            const accuracyBonus = Math.floor((gameState.hits / gameState.totalClicks) * 200);
            gameState.score = baseScore + timeBonus + accuracyBonus;
            
            showSchulteGameOverScreen(completionTime);
        }
        
        function showSchulteGameOverScreen(completionTime) {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgTimePerNumber = Math.round(completionTime / (gameState.schulteSize * gameState.schulteSize) * 100) / 100;
            
            // 评估等级（根据方格大小调整标准）
            let rank = '';
            let rankColor = '';
            const gridSize = gameState.schulteSize;
            const baseTime = gridSize * gridSize * 1.5; // 基础时间标准
            
            if (completionTime <= baseTime * 0.5 && accuracy >= 95) {
                rank = '注意力大师 🧠';
                rankColor = '#FFD700';
            } else if (completionTime <= baseTime * 0.7 && accuracy >= 90) {
                rank = '专注达人 ⭐';
                rankColor = '#C0C0C0';
            } else if (completionTime <= baseTime && accuracy >= 85) {
                rank = '集中能手 💫';
                rankColor = '#CD7F32';
            } else if (accuracy >= 80) {
                rank = '注意力新手 🌟';
                rankColor = '#87CEEB';
            } else {
                rank = '需要更多练习 💪';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">总得分: ${gameState.score}</div>
                        <div>完成时间: ${completionTime}秒</div>
                        <div>准确率: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>方格大小: ${gameState.schulteSize}x${gameState.schulteSize}</div>
                        <div>平均每数字: ${avgTimePerNumber}s</div>
                        <div>错误点击: ${gameState.misses}次</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">完成度评估:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>💡 提升建议:</p>
                    ${completionTime > 60 ? '<p>• 练习快速扫描，用周边视觉寻找数字</p>' : ''}
                    ${accuracy < 90 ? '<p>• 保持冷静，先确认数字再点击</p>' : ''}
                    ${avgTimePerNumber > 2 ? '<p>• 尝试记忆数字位置，减少重复搜索</p>' : ''}
                    <p>• 舒尔特方格训练能有效提升注意力和视觉搜索能力</p>
                    <p>• 建议从小尺寸开始，逐渐挑战大尺寸方格</p>
                </div>
            `;
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        // 成就系统
        const achievements = {
            firstBlood: { name: '第一滴血', desc: '完成第一次训练', icon: '🎆', unlocked: false },
            perfectShot: { name: '完美射手', desc: '单次训练准确率100%', icon: '💎', unlocked: false },
            speedDemon: { name: '速度魔王', desc: '平均反应时间低于300ms', icon: '⚡', unlocked: false },
            comboMaster: { name: '连击大师', desc: '单次连击数超过20', icon: '🔥', unlocked: false },
            persistent: { name: '持之以恒', desc: '累计训练50次', icon: '🏆', unlocked: false },
            sharpShooter: { name: '神射手', desc: '达到神枪手等级', icon: '🎯', unlocked: false },
            nightOwl: { name: '夜猫子', desc: '晚上10点后训练', icon: '🦉', unlocked: false },
            earlyBird: { name: '早起鸟儿', desc: '早上6点前训练', icon: '🐦', unlocked: false }
        };
        
        // 检查成就
        function checkAchievements(gameResult) {
            const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements') || '{}');
            const newlyUnlocked = [];
            
            // 第一次训练
            if (!unlockedAchievements.firstBlood) {
                unlockedAchievements.firstBlood = true;
                newlyUnlocked.push('firstBlood');
            }
            
            // 完美准确率
            if (!unlockedAchievements.perfectShot && gameResult.accuracy === 100) {
                unlockedAchievements.perfectShot = true;
                newlyUnlocked.push('perfectShot');
            }
            
            // 速度魔王
            if (!unlockedAchievements.speedDemon && gameResult.avgReaction < 300) {
                unlockedAchievements.speedDemon = true;
                newlyUnlocked.push('speedDemon');
            }
            
            // 连击大师
            if (!unlockedAchievements.comboMaster && gameResult.maxCombo > 20) {
                unlockedAchievements.comboMaster = true;
                newlyUnlocked.push('comboMaster');
            }
            
            // 神射手
            if (!unlockedAchievements.sharpShooter && gameResult.accuracy >= 90 && gameResult.avgReaction <= 400) {
                unlockedAchievements.sharpShooter = true;
                newlyUnlocked.push('sharpShooter');
            }
            
            // 检查训练次数
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            if (!unlockedAchievements.persistent && history.length >= 50) {
                unlockedAchievements.persistent = true;
                newlyUnlocked.push('persistent');
            }
            
            // 检查时间成就
            const currentHour = new Date().getHours();
            if (!unlockedAchievements.nightOwl && currentHour >= 22) {
                unlockedAchievements.nightOwl = true;
                newlyUnlocked.push('nightOwl');
            }
            if (!unlockedAchievements.earlyBird && currentHour <= 6) {
                unlockedAchievements.earlyBird = true;
                newlyUnlocked.push('earlyBird');
            }
            
            localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
            
            // 显示新解锁的成就
            if (newlyUnlocked.length > 0) {
                showAchievements(newlyUnlocked);
            }
        }
        
        // 显示成就弹窗
        function showAchievements(achievementIds) {
            achievementIds.forEach((id, index) => {
                setTimeout(() => {
                    const achievement = achievements[id];
                    const popup = document.createElement('div');
                    popup.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 20px;
                        border-radius: 15px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                        z-index: 1000;
                        min-width: 300px;
                        animation: slideIn 0.5s ease;
                        border: 2px solid #FFD700;
                    `;
                    
                    popup.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 10px;">${achievement.icon}</div>
                            <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px; color: #FFD700;">成就解锁！</div>
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">${achievement.name}</div>
                            <div style="font-size: 14px; opacity: 0.9;">${achievement.desc}</div>
                        </div>
                    `;
                    
                    document.body.appendChild(popup);
                    
                    // 播放成就音效
                    playSound(880, 0.2);
                    setTimeout(() => playSound(1100, 0.2), 200);
                    setTimeout(() => playSound(1320, 0.3), 400);
                    
                    // 3秒后移除弹窗
                    setTimeout(() => {
                        if (popup.parentNode) {
                            popup.remove();
                        }
                    }, 3000);
                }, index * 500); // 多个成就依次显示
            });
        }
        
        // 添加滑入动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // 追踪训练模式功能
        const trackingDifficulties = {
            slow: { targetSize: 50, speed: 2, pattern: 'linear' },
            medium: { targetSize: 40, speed: 3, pattern: 'random' },
            fast: { targetSize: 30, speed: 4, pattern: 'change' }
        };
        
        function startTrackingGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // 显示游戏统计头部
            document.getElementById('gameHeader').style.display = 'block';
            
            // 创建移动目标
            createTrackingTarget();
            
            // 开始计时和统计更新
            gameState.trackingStartTime = Date.now();
            startTrackingTimer();
            startTrackingStatsUpdate();
        }
        
        function createTrackingTarget() {
            const gameArea = document.getElementById('gameArea');
            
            // 确保清理旧目标
            if (gameState.trackingTarget) {
                gameState.trackingTarget.remove();
                gameState.trackingTarget = null;
            }
            
            const target = document.createElement('div');
            target.className = 'target tracking-target';
            
            const config = trackingDifficulties[gameState.difficulty];
            
            // 设置目标样式
            target.style.cssText = `
                position: absolute;
                width: ${config.targetSize}px;
                height: ${config.targetSize}px;
                border-radius: 50%;
                background: radial-gradient(circle, #ff4757, #ff3742);
                border: 3px solid #fff;
                box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
                cursor: pointer;
                transition: all 0.1s ease;
                z-index: 10;
            `;
            
            // 初始位置
            const margin = config.targetSize + 20;
            const x = Math.random() * (window.innerWidth - 2 * margin) + margin;
            const y = Math.random() * (window.innerHeight - 300) + 150;
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            // 初始移动方向
            target.vx = (Math.random() - 0.5) * config.speed * 2;
            target.vy = (Math.random() - 0.5) * config.speed * 2;
            
            // 添加鼠标事件监听
            target.addEventListener('mouseenter', () => {
                if (gameState.gameActive) {
                    gameState.isTracking = true;
                    target.style.background = 'radial-gradient(circle, #00ff88, #00e676)';
                    target.style.boxShadow = '0 0 25px rgba(0, 255, 136, 0.8)';
                    if (gameState.soundEnabled) {
                        playSound(400, 0.1);
                    }
                }
            });
            
            target.addEventListener('mouseleave', () => {
                if (gameState.gameActive) {
                    gameState.isTracking = false;
                    target.style.background = 'radial-gradient(circle, #ff4757, #ff3742)';
                    target.style.boxShadow = '0 0 20px rgba(255, 71, 87, 0.6)';
                }
            });
            
            gameArea.appendChild(target);
            gameState.trackingTarget = target;
            
            console.log('追踪目标创建完成');
            
            // 开始移动目标
            moveTrackingTarget();
        }
        
        function moveTrackingTarget() {
            if (!gameState.gameActive || !gameState.trackingTarget) return;
            
            const target = gameState.trackingTarget;
            const config = trackingDifficulties[gameState.difficulty];
            
            // 获取当前位置
            let x = parseFloat(target.style.left);
            let y = parseFloat(target.style.top);
            
            // 边界检测和反弹
            if (x <= 0 || x >= window.innerWidth - config.targetSize) {
                target.vx = -target.vx;
            }
            if (y <= 100 || y >= window.innerHeight - 100 - config.targetSize) {
                target.vy = -target.vy;
            }
            
            // 根据难度模式处理目标移动
            if (config.pattern === 'linear') {
                // 慢速模式：保持直线移动，只在碰到边界时改变方向
                // 这里不需要额外操作，因为边界检测已经处理了方向变化
            } else if (config.pattern === 'random' && Math.random() < 0.02) {
                // 中速模式：偶尔随机改变方向
                target.vx = (Math.random() - 0.5) * config.speed * 2;
                target.vy = (Math.random() - 0.5) * config.speed * 2;
            } else if (config.pattern === 'change' && Math.random() < 0.05) {
                // 快速模式：频繁且更剧烈地改变方向
                target.vx = (Math.random() - 0.5) * config.speed * 2;
                target.vy = (Math.random() - 0.5) * config.speed * 2;
            }
            
            // 更新位置
            x += target.vx;
            y += target.vy;
            
            // 确保在边界内
            x = Math.max(0, Math.min(window.innerWidth - config.targetSize, x));
            y = Math.max(100, Math.min(window.innerHeight - 100 - config.targetSize, y));
            
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            // 继续移动
            requestAnimationFrame(moveTrackingTarget);
        }
        
        function startTrackingTimer() {
            const timer = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(timer);
                    return;
                }
                
                gameState.gameTime--;
                document.getElementById('timeLeft').textContent = gameState.gameTime + 's';
                
                if (gameState.gameTime <= 0) {
                    clearInterval(timer);
                    endTrackingGame();
                }
            }, 1000);
        }
        
        function startTrackingStatsUpdate() {
            const updateInterval = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(updateInterval);
                    return;
                }
                
                // 如果鼠标在目标上，增加追踪时间和得分
                if (gameState.isTracking) {
                    gameState.trackingTime += 16; // 约60fps，每帧16ms
                    gameState.trackingScore += 1;
                    gameState.score += 1;
                }
                
                // 计算追踪准确率
                const totalTime = Date.now() - gameState.trackingStartTime;
                gameState.trackingAccuracy = Math.round((gameState.trackingTime / totalTime) * 100);
                
                // 更新显示
                updateTrackingStats();
            }, 16); // 约60fps
        }
        
        function updateTrackingStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('accuracy').textContent = gameState.trackingAccuracy + '%';
            
            // 使用追踪时间作为"反应时间"显示
            const avgTrackingTime = gameState.trackingTime > 0 ? Math.round(gameState.trackingTime / 1000) : 0;
            document.getElementById('avgReaction').textContent = avgTrackingTime + 's';
            
            // 连击数显示为连续追踪时间
            const comboTime = gameState.isTracking ? Math.round(gameState.trackingTime / 100) / 10 : 0;
            document.getElementById('combo').textContent = comboTime + 's';
        }
        
        function endTrackingGame() {
            gameState.gameActive = false;
            
            if (gameState.trackingTarget) {
                gameState.trackingTarget.remove();
            }
            
            document.getElementById('gameHeader').style.display = 'none';
            showTrackingGameOverScreen();
        }
        
        function showTrackingGameOverScreen() {
            const totalTime = gameState.totalGameTime * 1000;
            const trackingAccuracy = Math.round((gameState.trackingTime / totalTime) * 100);
            const avgTrackingTime = Math.round(gameState.trackingTime / 1000 * 10) / 10;
            
            // 评估等级
            let rank = '';
            let rankColor = '';
            if (trackingAccuracy >= 80) {
                rank = '追踪大师 🎮';
                rankColor = '#FFD700';
            } else if (trackingAccuracy >= 60) {
                rank = '追踪能手 ⚡';
                rankColor = '#C0C0C0';
            } else if (trackingAccuracy >= 40) {
                rank = '追踪新手 🌟';
                rankColor = '#CD7F32';
            } else {
                rank = '需要更多练习 💪';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">总得分: ${gameState.score}</div>
                        <div>追踪准确率: ${trackingAccuracy}%</div>
                        <div>追踪时长: ${avgTrackingTime}秒</div>
                    </div>
                    <div>
                        <div>训练时长: ${gameState.totalGameTime}秒</div>
                        <div>难度: ${gameState.difficulty.toUpperCase()}</div>
                        <div>目标大小: ${trackingDifficulties[gameState.difficulty].targetSize}px</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">追踪能力评估:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${trackingAccuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>💡 提升建议:</p>
                    ${trackingAccuracy < 50 ? '<p>• 专注于跟随目标中心，保持鼠标稳定</p>' : ''}
                    ${trackingAccuracy < 70 ? '<p>• 预测目标移动轨迹，提前移动鼠标</p>' : ''}
                    <p>• 追踪训练能有效提升动态视觉反应和手眼协调能力</p>
                </div>
            `;
            
            // 保存记录并检查成就
            saveBestRecord(trackingAccuracy, avgTrackingTime * 1000, gameState.score);
            checkAchievements({
                accuracy: trackingAccuracy,
                avgReaction: avgTrackingTime * 1000,
                score: gameState.score,
                maxCombo: Math.round(gameState.trackingTime / 1000)
            });
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // 序列训练模式功能
        const sequenceLengthSettings = {
            short: { minLength: 3, maxLength: 4 },
            medium: { minLength: 5, maxLength: 6 },
            long: { minLength: 7, maxLength: 8 },
            ultra: { minLength: 9, maxLength: 10 }
        };
        
        const sequenceSpeedSettings = {
            slow: { displayTime: 1200, interval: 400 },
            medium: { displayTime: 800, interval: 200 },
            fast: { displayTime: 500, interval: 150 },
            ultra: { displayTime: 300, interval: 100 }
        };
        
        // 为了兼容性保留旧的配置
        const sequenceDifficulties = {
            long: { minLength: 7, maxLength: 8, displayTime: 800, interval: 200 }
        };
        
        function startSequenceGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // 创建序列信息面板
            const infoPanel = document.createElement('div');
            infoPanel.className = 'schulte-info';
            infoPanel.innerHTML = `
                <div class="schulte-current-number">轮次: <span id="currentRound">1</span>/${gameState.sequenceRounds}</div>
                <div class="schulte-stats">得分: <span id="sequenceScore">0</span> | 准确率: <span id="sequenceAccuracy">100%</span></div>
                <div style="margin-top: 10px; font-size: 14px; opacity: 0.8;" id="sequenceInstruction">准备开始...</div>
            `;
            gameArea.appendChild(infoPanel);
            
            // 开始第一轮
            setTimeout(() => startSequenceRound(), 1000);
        }
        
        function startSequenceRound() {
            // 先递增轮次计数
            gameState.currentRound++;
            
            console.log('开始新一轮序列训练:', gameState.currentRound, '/', gameState.sequenceRounds);
            
            if (gameState.currentRound > gameState.sequenceRounds) {
                console.log('所有轮次完成，结束游戏');
                endSequenceGame();
                return;
            }
            
            // 重置当前轮次的状态
            gameState.currentSequence = [];
            gameState.playerSequence = [];
            gameState.sequenceIndex = 0;
            gameState.isShowingSequence = true;
            gameState.isPlayerTurn = false;
            
            console.log('当前轮次设置为:', gameState.currentRound);
            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('sequenceInstruction').textContent = '观察序列...';
            
            // 获取用户设置
            const lengthSetting = document.getElementById('sequence-length').value;
            const speedSetting = document.getElementById('sequence-speed').value;
            console.log('用户设置 - 长度:', lengthSetting, '速度:', speedSetting);
            
            // 获取序列长度配置
            const lengthConfig = sequenceLengthSettings[lengthSetting];
            const sequenceLength = Math.floor(Math.random() * (lengthConfig.maxLength - lengthConfig.minLength + 1)) + lengthConfig.minLength;
            console.log('生成序列长度:', sequenceLength);
            
            // 保存当前设置供后续使用
            gameState.currentLengthConfig = lengthConfig;
            gameState.currentSpeedConfig = sequenceSpeedSettings[speedSetting];
            console.log('保存的速度配置:', gameState.currentSpeedConfig);
            
            // 创建目标位置
            createSequenceTargets();
            
            // 生成序列
            for (let i = 0; i < sequenceLength; i++) {
                gameState.currentSequence.push(Math.floor(Math.random() * 9)); // 0-8对应9个位置
            }
            console.log('生成的序列:', gameState.currentSequence);
            
            // 显示序列
            console.log('准备显示序列，500ms后开始');
            setTimeout(() => {
                console.log('开始显示序列步骤');
                showSequenceStep();
            }, 500);
        }
        
        function createSequenceTargets() {
            const gameArea = document.getElementById('gameArea');
            
            // 清除旧的目标
            const oldTargets = gameArea.querySelectorAll('.sequence-target');
            oldTargets.forEach(target => target.remove());
            
            // 重置目标数组
            gameState.sequenceTargets = [];
            
            // 创建3x3网格的目标
            for (let i = 0; i < 9; i++) {
                const target = document.createElement('div');
                target.className = 'sequence-target';
                target.dataset.index = i;
                
                // 计算位置（3x3网格）
                const row = Math.floor(i / 3);
                const col = i % 3;
                const size = 60;
                const spacing = 100;
                const startX = window.innerWidth / 2 - spacing;
                const startY = window.innerHeight / 2 - spacing;
                
                target.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${startX + col * spacing}px;
                    top: ${startY + row * spacing}px;
                    background: linear-gradient(135deg, #2c3e50, #34495e);
                    border: 2px solid rgba(255,255,255,0.3);
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                    color: white;
                    font-weight: bold;
                    z-index: 10;
                `;
                
                target.textContent = i + 1;
                
                // 添加点击事件
                target.addEventListener('click', () => handleSequenceClick(i));
                
                gameArea.appendChild(target);
                gameState.sequenceTargets.push(target);
            }
            
            console.log('序列目标创建完成:', gameState.sequenceTargets.length);
        }
        
        function showSequenceStep() {
            if (!gameState.gameActive || !gameState.isShowingSequence) {
                console.log('showSequenceStep stopped - gameActive:', gameState.gameActive, 'isShowingSequence:', gameState.isShowingSequence);
                return;
            }
            
            // 使用新的速度配置，如果没有则使用默认
            const speedConfig = gameState.currentSpeedConfig || { displayTime: 800, interval: 200 };
            console.log('使用速度配置:', speedConfig);
            
            if (gameState.sequenceIndex < gameState.currentSequence.length) {
                const targetIndex = gameState.currentSequence[gameState.sequenceIndex];
                const target = gameState.sequenceTargets[targetIndex];
                
                console.log('显示序列步骤:', gameState.sequenceIndex, '目标索引:', targetIndex, '目标存在:', !!target);
                
                if (!target) {
                    console.error('目标不存在! targetIndex:', targetIndex, 'sequenceTargets:', gameState.sequenceTargets);
                    return;
                }
                
                // 高亮目标
                target.style.background = 'linear-gradient(135deg, #00ff88, #00e676)';
                target.style.borderColor = '#00ff88';
                target.style.transform = 'scale(1.2)';
                
                playSound(600 + (gameState.sequenceIndex * 100), 0.2);
                
                // 显示时间后恢复
                setTimeout(() => {
                    if (!gameState.gameActive || !gameState.isShowingSequence) {
                        console.log('游戏状态已改变，停止序列显示');
                        return;
                    }
                    
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                    target.style.transform = 'scale(1)';
                    
                    gameState.sequenceIndex++;
                    console.log('序列索引增加到:', gameState.sequenceIndex);
                    
                    // 继续下一个或开始玩家回合
                    setTimeout(() => {
                        if (gameState.sequenceIndex < gameState.currentSequence.length) {
                            console.log('继续下一个序列步骤');
                            showSequenceStep();
                        } else {
                            console.log('序列显示完成，开始玩家回合');
                            startPlayerTurn();
                        }
                    }, speedConfig.interval);
                }, speedConfig.displayTime);
            } else {
                console.log('序列索引超出范围，开始玩家回合');
                startPlayerTurn();
            }
        }
        
        function startPlayerTurn() {
            gameState.isShowingSequence = false;
            gameState.isPlayerTurn = true;
            gameState.sequenceIndex = 0;
            
            document.getElementById('sequenceInstruction').textContent = '请按顺序点击目标...';
        }
        
        function handleSequenceClick(targetIndex) {
            if (!gameState.gameActive || !gameState.isPlayerTurn) return;
            
            const target = gameState.sequenceTargets[targetIndex];
            
            if (targetIndex === gameState.currentSequence[gameState.sequenceIndex]) {
                // 正确点击
                target.style.background = 'linear-gradient(135deg, #00ff88, #00e676)';
                target.style.borderColor = '#00ff88';
                
                gameState.playerSequence.push(targetIndex);
                gameState.sequenceIndex++;
                gameState.hits++;
                gameState.score += 10;
                
                playSound(700, 0.1);
                
                setTimeout(() => {
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                }, 200);
                
                // 检查是否完成序列
                if (gameState.sequenceIndex >= gameState.currentSequence.length) {
                    gameState.combo++;
                    gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
                    setTimeout(() => {
                        document.getElementById('sequenceInstruction').textContent = '正确！准备下一轮...';
                        setTimeout(() => startSequenceRound(), 1500);
                    }, 500);
                }
            } else {
                // 错误点击
                target.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                target.style.borderColor = '#ff4757';
                
                gameState.misses++;
                gameState.combo = 0;
                playSound(200, 0.3);
                
                setTimeout(() => {
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                    
                    document.getElementById('sequenceInstruction').textContent = '错误！重新开始这一轮...';
                    // 错误时重新开始当前轮次，需要先减去轮次计数
                    setTimeout(() => {
                        gameState.currentRound--; // 恢复到当前轮次
                        startSequenceRound();
                    }, 1500);
                }, 200);
            }
            
            gameState.totalClicks++;
            updateSequenceStats();
        }
        
        function updateSequenceStats() {
            document.getElementById('sequenceScore').textContent = gameState.score;
            
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 100;
            document.getElementById('sequenceAccuracy').textContent = accuracy + '%';
        }
        
        function endSequenceGame() {
            gameState.gameActive = false;
            showSequenceGameOverScreen();
        }
        
        function showSequenceGameOverScreen() {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            
            // 评估等级
            let rank = '';
            let rankColor = '';
            if (accuracy >= 90 && gameState.combo >= gameState.sequenceRounds * 0.8) {
                rank = '记忆大师 🧠';
                rankColor = '#FFD700';
            } else if (accuracy >= 75 && gameState.combo >= gameState.sequenceRounds * 0.6) {
                rank = '序列专家 ⚡';
                rankColor = '#C0C0C0';
            } else if (accuracy >= 60) {
                rank = '记忆新手 🌟';
                rankColor = '#CD7F32';
            } else {
                rank = '需要更多练习 💪';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">总得分: ${gameState.score}</div>
                        <div>完成轮次: ${gameState.currentRound}/${gameState.sequenceRounds}</div>
                        <div>记忆准确率: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>连续正确: ${gameState.maxCombo}轮</div>
                        <div>难度: ${gameState.difficulty.toUpperCase()}</div>
                        <div>总点击: ${gameState.totalClicks}次</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">记忆能力评估:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>💡 提升建议:</p>
                    ${accuracy < 70 ? '<p>• 专注观察序列，可以在脑中重复目标位置</p>' : ''}
                    ${gameState.maxCombo < gameState.sequenceRounds * 0.5 ? '<p>• 尝试将序列编码为记忆路径或故事</p>' : ''}
                    <p>• 序列训练能有效提升工作记忆和注意力</p>
                </div>
            `;
            
            // 保存记录并检查成就
            saveBestRecord(accuracy, avgReaction || 1000, gameState.score);
            checkAchievements({
                accuracy: accuracy,
                avgReaction: avgReaction || 1000,
                score: gameState.score,
                maxCombo: gameState.maxCombo
            });
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // 防止右键菜单
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // 信息弹窗功能
        const infoModalContent = {
            about: {
                title: '🏢 关于我们',
                content: `
                    <h3>🎆 产品介绍</h3>
                    <p>精准点击训练器是一款专业级的反应速度和精准度训练平台，为用户提供多维度的认知训练体验。</p>
                    
                    <h3>🎯 功能特色</h3>
                    <ul>
                        <li>🎯 反应速度训练 - 提升点击反应和目标识别能力</li>
                        <li>🎮 追踪训练 - 增强动态视觉跟踪及手眼协调</li>
                        <li>🔢 序列训练 - 训练工作记忆和序列处理能力</li>
                        <li>🧠 舒尔特方格 - 提升注意力集中和视觉搜索</li>
                    </ul>
                    
                    <h3>📊 科学依据</h3>
                    <p>我们的训练方法基于认知神经科学的研究成果，针对不同的认知能力进行针对性训练，帮助用户在日常生活和工作中取得更好的表现。</p>
                    
                    <h3>📅 版本信息</h3>
                    <p>当前版本：v2.1.0 | 更新日期：2024年12月</p>
                `
            },
            xpro: {
                title: '🖱️ X‑Pro 推荐',
                content: `
                    <h3>X‑Pro 高精度游戏鼠标</h3>
                    <p>X‑Pro 提供稳定的定位精度和低延迟传感器，适合追踪与快速点射训练。主要特点：</p>
                    <ul>
                        <li>高精度光学传感器（可调 DPI）</li>
                        <li>低延迟微动开关</li>
                        <li>人体工学设计与轻量化外壳</li>
                        <li>可自定义按键与配置保存</li>
                    </ul>
                    <p style="margin-top:10px;">购买与更多信息，请访问制造商页面或在本地渠道搜索型号 <strong>X‑Pro</strong>。</p>
                    <div style="text-align:center; margin-top:12px;">
                        <button class="btn" onclick="closeInfoModal()">关闭</button>
                    </div>
                `
            },
            contact: {
                title: '📞 联系我们',
                content: `
                    <h3>📧 联系方式</h3>
                    <p>如果您在使用过程中遇到任何问题，或对产品有任何建议，欢迎通过邮箱联系我们：</p>
                    
                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: rgba(0,255,136,0.1); border-radius: 15px; border: 2px solid rgba(0,255,136,0.3);">
                        <h3 style="color: #00ff88; margin-bottom: 10px;">📧 邮箱地址</h3>
                        <p style="font-size: 18px; font-weight: bold; color: #00ff88;">lujinfen783@gmail.com</p>
                    </div>
                    
                    <h3>💬 反馈建议</h3>
                    <p>您的意见和建议对我们非常重要！请随时通过邮箱向我们反馈产品使用体验，帮助我们持续改进和优化产品。</p>
                    
                    <p style="margin-top: 20px; font-size: 12px; opacity: 0.7; text-align: center;">
                        我们会尽快回复您的邮件咨询
                    </p>
                `
            },
            privacy: {
                title: '🔒 隐私政策',
                content: `
                    <h3>📊 数据收集</h3>
                    <p>我们仅收集您的训练数据用于游戏体验优化，包括：</p>
                    <ul>
                        <li>训练成绩和进度记录</li>
                        <li>设置偏好和难度选择</li>
                        <li>成就解锁和历史记录</li>
                    </ul>
                    
                    <h3>💾 数据存储</h3>
                    <p>所有数据均存储在您的本地浏览器中，不会上传至任何服务器。您可以随时清除浏览器数据来删除这些信息。</p>
                    
                    <h3>🚫 不收集的信息</h3>
                    <p>我们不会收集：</p>
                    <ul>
                        <li>个人身份信息（姓名、身份证号等）</li>
                        <li>联系方式（电话、邮箱等）</li>
                        <li>位置信息</li>
                        <li>设备唯一标识符</li>
                    </ul>
                    
                    <h3>🛡️ 数据安全</h3>
                    <p>我们采用先进的加密技术保护您的数据安全，并严格遵守相关法律法规。</p>
                    
                    <h3>📅 政策更新</h3>
                    <p>本隐私政策可能会不定期更新，更新后会在游戏中显示通知。最后更新日期：2024年12月。</p>
                `
            },
            disclaimer: {
                title: '⚠️ 免责声明',
                content: `
                    <h3>🎯 产品用途</h3>
                    <p>精准点击训练器仅供娱乐和认知训练使用，不应用于医疗诊断、治疗或任何医学目的。</p>
                    
                    <h3>📊 训练效果</h3>
                    <p>训练效果因人而异，我们不能保证任何特定的训练效果或改善程度。请以科学的态度对待训练成果。</p>
                    
                    <h3>⚠️ 健康提示</h3>
                    <ul>
                        <li>请适度使用，避免长时间连续训练</li>
                        <li>如感到眼部疲劳或不适，请立即停止使用</li>
                        <li>有相关疾病者请在医生指导下使用</li>
                        <li>请在光线适宜、环境安全的地方使用</li>
                    </ul>
                    
                    <h3>📜 技术支持</h3>
                    <p>本产品基于Web技术开发，可能在不同设备和浏览器上表现不同。我们不对由此引起的技术问题承担责任。</p>
                    
                    <h3>📅 法律声明</h3>
                    <p>在法律允许的最大范围内，我们对因使用本产品而产生的任何直接或间接损失不承担责任。</p>
                    
                    <p style="margin-top: 20px; font-size: 12px; opacity: 0.7; text-align: center;">
                        最后更新日期：2024年12月 | 版本：v2.1.0
                    </p>
                `
            }
            ,
            features: {
                title: '🚀 核心优势 & 训练体系',
                content: `
                    <h3>🎯 核心优势</h3>
                    <ul>
                        <li><strong>智能训练系统</strong>：AI驱动的动态难度调整、实时追踪与分析、个性化训练计划</li>
                        <li><strong>竞技排行榜</strong>：全球玩家实时排名、历史最佳记录追踪、周/月冠军榜、好友挑战功能</li>
                        <li><strong>进阶系统</strong>：科学技能评估、阶段性训练目标、成就徽章系统、视觉化进度追踪</li>
                    </ul>

                    <h3>📊 训练系统</h3>
                    <h4>👶 入门级别 — "3天快速入门计划"</h4>
                    <ul>
                        <li>掌握基本定位技巧</li>
                        <li>建立正确的训练节奏</li>
                        <li>首次完成5×5挑战</li>
                        <li>了解训练原理与方法</li>
                    </ul>

                    <h4>⚡ 进阶训练</h4>
                    <ul>
                        <li>干扰模式训练（色块、文字）</li>
                        <li>瞬时记忆挑战（数字闪现）</li>
                        <li>多维数据分析（反应时间、准确率）</li>
                        <li>时间压力模式</li>
                    </ul>

                    <h4>🎓 专家指导</h4>
                    <ul>
                        <li>应用神经可塑性原理</li>
                        <li>定制训练计划</li>
                        <li>专业数据分析报告</li>
                        <li>认知能力发展趋势分析</li>
                    </ul>
                `
            }
        };
        
        function showInfoModal(type) {
            const modal = document.getElementById('infoModal');
            const title = document.getElementById('infoModalTitle');
            const body = document.getElementById('infoModalBody');
            
            if (infoModalContent[type]) {
                title.textContent = infoModalContent[type].title;
                body.innerHTML = infoModalContent[type].content;
                modal.style.display = 'flex';
                
                // 播放弹窗打开音效
                if (gameState.soundEnabled) {
                    playSound(800, 0.1);
                }
            }
        }
        
        function closeInfoModal() {
            const modal = document.getElementById('infoModal');
            modal.style.display = 'none';
            
            // 播放弹窗关闭音效
            if (gameState.soundEnabled) {
                playSound(600, 0.1);
            }
        }

        function showXProInfo() {
            showInfoModal('xpro');
        }
        
        // 点击弹窗背景关闭弹窗
        document.getElementById('infoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeInfoModal();
            }
        });
        
        // ESC 键关闭弹窗
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const infoModal = document.getElementById('infoModal');
                const purchaseModal = document.getElementById('purchaseModal');
                
                if (infoModal.style.display === 'flex') {
                    closeInfoModal();
                }
                
                if (purchaseModal.style.display === 'flex') {
                    closePurchaseModal();
                }
            }
        });
        
        // VIP会员系统功能
        let vipStatus = {
            isVIP: false,
            plan: null,
            expiryDate: null,
            features: {
                removeAds: false,
                premiumModes: false,
                detailedStats: false
            }
        };
        
        // 从本地存储加载VIP状态
        function loadVIPStatus() {
            const savedVIP = JSON.parse(localStorage.getItem('vipStatus') || '{}');
            if (savedVIP.isVIP) {
                // 检查是否过期
                if (savedVIP.expiryDate && new Date(savedVIP.expiryDate) > new Date()) {
                    vipStatus = savedVIP;
                    updateVIPUI();
                } else if (savedVIP.plan === 'lifetime') {
                    // 终身VIP永不过期
                    vipStatus = savedVIP;
                    updateVIPUI();
                } else {
                    // VIP已过期
                    resetVIPStatus();
                }
            }
        }

    // VIP/账户/支付功能已取消，API 不可用
    // VIP/账户/支付已取消：保留最小 vipStatus 对象与安全的 no-op 接口，避免引用错误
    const API_BASE_URL = '';

    function resetVIPStatus() {
        vipStatus = { isVIP: false, plan: null, expiryDate: null, features: {} };
        localStorage.setItem('vipStatus', JSON.stringify(vipStatus));
        updateVIPUI();
    }

    function updateVIPUI() {
        const vipStatusElement = document.getElementById('vipStatus');
        if (!vipStatusElement) return;
        if (vipStatus.isVIP) vipStatusElement.classList.add('show');
        else vipStatusElement.classList.remove('show');
    }

    function showPurchaseModal() { alert('购买功能已取消'); }
    function closePurchaseModal() { /* noop */ }
    function openPaymentPanel() { alert('购买功能已取消'); }
    function closePaymentPanel() { /* noop */ }
    function selectPlan(plan) { alert('购买功能已取消'); }
    function initiatePayment(plan) { alert('购买功能已取消'); }
    // 支付逻辑已移除，保留接口为 no-op
        
        // 显示支付成功提示
        function showSuccessMessage(plan) {
            // 创建成功提示
            const successMsg = document.createElement('div');
            successMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #00ff88, #00e676);
                color: #1a1a1a;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                font-weight: bold;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                z-index: 2000;
                animation: bounceIn 0.5s;
            `;
            
            let planName = '月度去广告订阅';
            if (plan === 'yearly') planName = '年度（暂不可用）';
            if (plan === 'lifetime') planName = '终身（暂不可用）';
            
            successMsg.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 20px;">✅</div>
                <div style="font-size: 24px; margin-bottom: 10px;">支付成功！</div>
                <div style="font-size: 18px;">您已成功升级为${planName}VIP会员</div>
            `;
            
            document.body.appendChild(successMsg);
            
            // 播放成功音效
            playSound(880, 0.2);
            setTimeout(() => playSound(1100, 0.2), 200);
            setTimeout(() => playSound(1320, 0.3), 400);
            
            // 3秒后移除提示
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }
        
        // 隐藏所有广告
        function hideAllAds() {
            const adElements = document.querySelectorAll('.ad-banner');
            adElements.forEach(ad => {
                ad.style.display = 'none';
            });
        }
        
        // 显示所有广告
        function showAllAds() {
            const adElements = document.querySelectorAll('.ad-banner');
            adElements.forEach(ad => {
                // 如果广告没有其他原因需要隐藏，则显示
                if (ad.id !== 'gameEndAd') {
                    ad.style.display = 'flex';
                }
            });
        }
        
        // 解锁付费功能
        function unlockPremiumFeatures() {
            const premiumFeatures = document.querySelectorAll('.premium-feature');
            premiumFeatures.forEach(feature => {
                feature.classList.add('unlocked');
            });
        }
        
        // 锁定付费功能
        function lockPremiumFeatures() {
            const premiumFeatures = document.querySelectorAll('.premium-feature');
            premiumFeatures.forEach(feature => {
                feature.classList.remove('unlocked');
            });
        }
        
    // 广告位已移除，保留安全的 no-op 接口以防旧代码调用
    function showGameEndAd() { /* noop: ads provided by AdSense in head */ }
    function hideGameEndAd() { /* noop */ }
        
    // 专业训练功能已移除：保留空实现以防其他代码调用
    const professionalModeSettings = {};
    function setupProfessionalModes() { /* 已移除 */ }
    function startProfessionalTraining() { /* 已移除 */ }
    function spawnProfessionalTarget() { /* 已移除 */ }
    function hitProfessionalTarget() { /* 已移除 */ }
    function spawnChaosTarget() { /* 已移除 */ }
    function hitChaosTarget() { /* 已移除 */ }
        
        // 详细数据分析功能
        function generateDetailedStats() {
            if (!vipStatus.isVIP) return null;
            
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            const recent = history.slice(-20); // 最近20次训练
            
            if (recent.length === 0) return null;
            
            // 计算各种统计数据
            const stats = {
                totalGames: history.length,
                averageAccuracy: recent.reduce((sum, record) => sum + record.accuracy, 0) / recent.length,
                averageReaction: recent.reduce((sum, record) => sum + record.avgReaction, 0) / recent.length,
                averageScore: recent.reduce((sum, record) => sum + record.score, 0) / recent.length,
                bestAccuracy: Math.max(...recent.map(r => r.accuracy)),
                bestReaction: Math.min(...recent.map(r => r.avgReaction)),
                bestScore: Math.max(...recent.map(r => r.score)),
                improvement: {
                    accuracy: recent.length > 5 ? 
                        recent.slice(-5).reduce((sum, r) => sum + r.accuracy, 0) / 5 - 
                        recent.slice(0, 5).reduce((sum, r) => sum + r.accuracy, 0) / 5 : 0,
                    reaction: recent.length > 5 ? 
                        recent.slice(0, 5).reduce((sum, r) => sum + r.avgReaction, 0) / 5 -
                        recent.slice(-5).reduce((sum, r) => sum + r.avgReaction, 0) / 5 : 0
                },
                consistencyScore: calculateConsistency(recent),
                strengthsAndWeaknesses: analyzePerformance(recent)
            };
            
            return stats;
        }
        
        // 计算一致性得分
        function calculateConsistency(records) {
            if (records.length < 3) return 0;
            
            const accuracies = records.map(r => r.accuracy);
            const reactions = records.map(r => r.avgReaction);
            
            const accStdDev = calculateStandardDeviation(accuracies);
            const reactStdDev = calculateStandardDeviation(reactions);
            
            // 标准差越小，一致性越高
            const consistency = Math.max(0, 100 - (accStdDev + reactStdDev / 10));
            return Math.round(consistency);
        }
        
        // 计算标准差
        function calculateStandardDeviation(values) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            const squaredDiffs = values.map(val => Math.pow(val - mean, 2));
            const avgSquaredDiff = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
            return Math.sqrt(avgSquaredDiff);
        }
        
        // 分析优缺点
        function analyzePerformance(records) {
            const avgAccuracy = records.reduce((sum, r) => sum + r.accuracy, 0) / records.length;
            const avgReaction = records.reduce((sum, r) => sum + r.avgReaction, 0) / records.length;
            
            const strengths = [];
            const weaknesses = [];
            
            if (avgAccuracy >= 85) strengths.push('精准度优秀');
            else if (avgAccuracy < 70) weaknesses.push('精准度需提升');
            
            if (avgReaction <= 400) strengths.push('反应速度优秀');
            else if (avgReaction > 600) weaknesses.push('反应速度需提升');
            
            const consistency = calculateConsistency(records);
            if (consistency >= 80) strengths.push('表现稳定');
            else if (consistency < 60) weaknesses.push('表现波动较大');
            
            return { strengths, weaknesses };
        }
        
        // 显示详细统计数据
        function showDetailedStats(gameResult) {
            if (!vipStatus.isVIP) return;
            
            const detailedStats = generateDetailedStats();
            if (!detailedStats) return;
            
            const statsHtml = `
                <div class="detailed-stats">
                    <h3 style="text-align: center; color: #00ff88; margin-bottom: 20px;">🎯 VIP详细数据分析</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-title">平均准确率</div>
                            <div class="stat-value">${Math.round(detailedStats.averageAccuracy)}%</div>
                            <div class="stat-desc">最近20次训练平均值</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">平均反应时间</div>
                            <div class="stat-value">${Math.round(detailedStats.averageReaction)}ms</div>
                            <div class="stat-desc">反应速度表现</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">平均得分</div>
                            <div class="stat-value">${Math.round(detailedStats.averageScore)}</div>
                            <div class="stat-desc">综合表现评估</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">稳定性评分</div>
                            <div class="stat-value">${detailedStats.consistencyScore}%</div>
                            <div class="stat-desc">表现一致性指标</div>
                        </div>
                    </div>
                    
                    <div class="progress-chart">
                        <div class="chart-title">🚀 进步趋势分析</div>
                        <div class="progress-bars">
                            <div class="progress-item">
                                <div class="progress-label">准确率进步</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.max(0, Math.min(100, 50 + detailedStats.improvement.accuracy * 2))}%"></div>
                                </div>
                                <div class="progress-value">${detailedStats.improvement.accuracy > 0 ? '+' : ''}${Math.round(detailedStats.improvement.accuracy * 10) / 10}%</div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-label">反应时间</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.max(0, Math.min(100, 50 + detailedStats.improvement.reaction / 10))}%"></div>
                                </div>
                                <div class="progress-value">${detailedStats.improvement.reaction > 0 ? '-' : '+'}${Math.round(Math.abs(detailedStats.improvement.reaction))}ms</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="background: rgba(0,255,136,0.1); border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00ff88; margin-bottom: 10px;">💪 优势项目</h4>
                            ${detailedStats.strengthsAndWeaknesses.strengths.length > 0 ? 
                                detailedStats.strengthsAndWeaknesses.strengths.map(s => `<div style="margin: 5px 0; font-size: 13px;">• ${s}</div>`).join('') : 
                                '<div style="opacity: 0.7; font-size: 13px;">继续加油！</div>'}
                        </div>
                        <div style="background: rgba(255,107,53,0.1); border-radius: 10px; padding: 15px;">
                            <h4 style="color: #ff6b35; margin-bottom: 10px;">🎯 提升空间</h4>
                            ${detailedStats.strengthsAndWeaknesses.weaknesses.length > 0 ? 
                                detailedStats.strengthsAndWeaknesses.weaknesses.map(w => `<div style="margin: 5px 0; font-size: 13px;">• ${w}</div>`).join('') : 
                                '<div style="opacity: 0.7; font-size: 13px;">表现优秀！</div>'}
                        </div>
                    </div>
                </div>
            `;
            
            // 插入到游戏结束统计中
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML += statsHtml;
        }
        
        // VIP 成就系统已禁用（按用户要求取消账户与 VIP）
        // 保留简短占位以避免运行时引用错误。
        const vipAchievements = {};

        function checkVIPAchievements(gameResult) {
            // VIP 功能已移除 — no-op
            return;
        }

        function showVIPAchievements(achievementIds) {
            // VIP 功能已移除 — no-op
            return;
        }
        
        // 页面加载时加载VIP状态
        function initializeApp() {
            console.log('初始化应用...');
            loadVIPStatus();
            // 账户系统初始化
            loadAccounts();
            updateAccountUI();
            setupProfessionalModes();
            
            // 确保点击弹窗背景能关闭弹窗
            const purchaseModal = document.getElementById('purchaseModal');
            if (purchaseModal) {
                purchaseModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closePurchaseModal();
                    }
                });
            }

            const accountModal = document.getElementById('accountModal');
            if (accountModal) {
                accountModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeAccountModal();
                    }
                });
            }

            // 绑定支付方式按钮（如果存在）
            const payWeChat = document.getElementById('payWeChat');
            const payAlipay = document.getElementById('payAlipay');
            const payPaypal = document.getElementById('payPaypal');
            if (payWeChat && payAlipay && payPaypal) {
                const buttons = [payWeChat, payAlipay, payPaypal];
                buttons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        buttons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                // 默认选中微信
                payWeChat.classList.add('active');
            }
            
            console.log('应用初始化完成，VIP状态:', vipStatus);
        }

    function openAccountModal() { alert('账户功能已取消'); }

        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
        }
        
        // 多种方式确保初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // 确保页面完全加载后也执行一次
        window.addEventListener('load', function() {
            setTimeout(initializeApp, 100);
        });

        // --- 新增：恢复购买与广告轮播逻辑 ---

    // 账户与VIP功能已取消，下面为安全的空实现以避免运行时报错
    function registerAccount() { alert('账户功能已取消'); }
    function loginAccount() { alert('账户功能已取消'); }
    function logoutAccount() { /* noop */ }
    function updateAccountUI() { /* noop */ }
    function changePasswordPrompt() { alert('账户功能已取消'); }
    function deleteAccountPrompt() { alert('账户功能已取消'); }
    function changePassword() { /* noop */ }
    function deleteAccount() { return false; }

        function getCurrentUser() {
            return currentUser;
        }

        function saveAccountReceipt(receipt) {
            // attach receipt to current user if exists
            loadAccounts();
            if (!currentUser) {
                // fallback: save to global vipReceipt
                localStorage.setItem('vipReceipt', JSON.stringify(receipt));
                return;
            }
            const a = accounts[currentUser] || { passwordHash: null, receipts: [], vipStatus: null };
            a.receipts = a.receipts || [];
            a.receipts.push(receipt);
            // also update user's vipStatus
            a.vipStatus = {
                plan: receipt.plan,
                purchaseDate: receipt.purchaseDate,
                receiptId: receipt.receiptId,
                expiryDate: new Date(new Date(receipt.purchaseDate).setMonth(new Date(receipt.purchaseDate).getMonth() + 1)).toISOString(),
                features: { removeAds: true, premiumModes: false, detailedStats: false }
            };
            accounts[currentUser] = a;
            saveAccounts();
        }

        function restorePurchasesForCurrentUser() {
            // 账户/购买系统已被用户取消 — 不执行恢复操作
            alert('恢复购买功能已取消');
            return;
        }

        function applyReceiptToVIP(receipt) {
            const now = new Date();
            const expiry = new Date(now.setMonth(now.getMonth() + 1));
            vipStatus = {
                isVIP: true,
                plan: receipt.plan || 'monthly',
                expiryDate: expiry.toISOString(),
                purchaseDate: receipt.purchaseDate || new Date().toISOString(),
                receiptId: receipt.receiptId,
                features: { removeAds: true, premiumModes: false, detailedStats: false }
            };
            localStorage.setItem('vipStatus', JSON.stringify(vipStatus));
            updateVIPUI();
            showSuccessMessage('monthly');
        }

        // ===== 结束账户系统 =====

    function saveMockReceipt() { alert('购买功能已取消'); return null; }

        // 恢复购买（从本地收据）
    function simulateRestorePurchase() { alert('恢复购买功能已取消'); }

        // 模拟支付成功流程（主实现）
    function simulateSuccessfulPayment() { alert('购买功能已取消'); }

        // 显示VIP管理面板（简单实现）
        function showVIPManagement() {
            const saved = JSON.parse(localStorage.getItem('vipStatus') || '{}');
            if (!saved.isVIP) {
                alert('当前未为VIP。购买功能已取消。');
                return;
            }

            const expiry = saved.expiryDate ? new Date(saved.expiryDate).toLocaleString() : '永久';
            const plan = saved.plan || '未知';
            const receipt = saved.receiptId ? ('收据ID: ' + saved.receiptId) : '';

            const msg = `当前VIP: ${plan}\n到期时间: ${expiry}\n${receipt}\n\n您可以选择退出VIP以恢复广告（本地操作）。如需在商店取消订阅，请在相应应用/平台管理订阅。`;
            if (confirm(msg)) {
                // 提供一个退出VIP的选项
                resetVIPStatus();
            }
        }

        // 从菜单直接进入专业训练（需要VIP）
        function startProfessionalFromMenu() {
            if (!vipStatus.isVIP) {
                // 提示并跳转到购买弹窗
                if (confirm('专业训练为VIP专属功能，是否前往升级？')) {
                    alert('购买功能已取消');
                }
                return;
            }

            // VIP 用户直接进入专业训练设置并打开专业模式选择
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameHeader').style.display = 'block';
            gameState.trainingMode = 'professional';
            // 默认选择第一个专业模式
            const firstPro = document.querySelector('.pro-mode-btn');
            if (firstPro) firstPro.classList.add('active');
            setupProfessionalModes();
            startProfessionalTraining();
        }

        // 广告轮播（非VIP时启用）：简单轮播文案
        let adRotationInterval = null;
        const ads = [
            {title: '定位精度优化', detail: '提升定位精度，推荐型号：X-Pro', action: 'showXProInfo'},
            {title: '人体工学机械键盘', detail: '长时间训练也更舒适'},
            {title: '专业鼠标垫', detail: '低摩擦/高稳定，提升追踪表现'},
            {title: '训练计划订制', detail: '专家定制训练计划，提高效率'}
        ];

        function startAdRotation() {
            stopAdRotation();
            if (vipStatus.isVIP) return; // VIP 不显示轮播

            const adElements = document.querySelectorAll('.ad-banner');
            let index = 0;
            adRotationInterval = setInterval(() => {
                adElements.forEach(ad => {
                    const content = `<div style=\"display:flex;flex-direction:column;align-items:center;\"><div style=\"font-size:18px;margin-bottom:6px;\">${ads[index].title}</div><div style=\"font-size:13px;opacity:0.85;\">${ads[index].detail}</div></div>`;
                    ad.innerHTML = content;
                    // keep ad label
                    const label = document.createElement('div');
                    label.style.cssText = 'position:absolute;top:5px;right:8px;font-size:10px;opacity:0.5;';
                    label.textContent = '广告';
                    ad.appendChild(label);
                });
                index = (index + 1) % ads.length;
            }, 4000);
        }

        function stopAdRotation() {
            if (adRotationInterval) {
                clearInterval(adRotationInterval);
                adRotationInterval = null;
            }
        }

        // 在VIP状态更新时控制广告轮播
        const originalUpdateVIPUI = updateVIPUI;
        updateVIPUI = function() {
            originalUpdateVIPUI();
            if (vipStatus.isVIP) {
                stopAdRotation();
            } else {
                startAdRotation();
            }
        };

        // 启动广告轮播（页面加载后）
        window.addEventListener('load', function() {
            setTimeout(() => {
                startAdRotation();
            }, 200);
        });

        // --- 结束新增内容 ---
        // --- i18n 简易实现 ---
        const i18n = {
            zh: {
                subtitle: '专业级反应速度和精准度训练平台',
                choose_mode: '🎮 选择训练模式',
                reaction_mode: '反应速度训练',
                reaction_desc: '点击随机目标，提升反应速度和精准度',
                tracking_mode: '追踪训练',
                tracking_desc: '跟踪移动目标，提升动态反应能力',
                schulte_mode: '舒尔特方格训练',
                schulte_desc: '按顺序点击数字，提升注意力和视觉搜索能力',
                training_mode: '训练模式',
                mode_normal: '普通模式',
                mode_flick: '快速切换',
                mode_tracking: '跟踪训练',
                easy_label: '🟢 新手',
                easy_stats: '目标: 60px\n持续: 2.5s\n间隔: 800ms',
                medium_label: '🟡 进阶',
                medium_stats: '目标: 45px\n持续: 2.0s\n间隔: 600ms',
                hard_label: '🟠 困难',
                hard_stats: '目标: 35px\n持续: 1.5s\n间隔: 400ms',
                expert_label: '🔴 专家',
                expert_stats: '目标: 25px\n持续: 1.2s\n间隔: 300ms',
                label_duration: '游戏时长',
                opt_30s: '30秒',
                opt_60s: '60秒',
                opt_90s: '90秒',
                opt_2min: '2分钟',
                label_target_style: '目标样式',
                opt_head: '头部形状',
                opt_circle: '圆形',
                opt_square: '方形',
                label_sound: '音效反馈',
                opt_on: '开启',
                opt_off: '关闭',
                label_training_mode: '训练模式',
            },
            en: {
                subtitle: 'Professional reaction speed & precision trainer',
                choose_mode: '🎮 Choose training mode',
                reaction_mode: 'Reaction Speed',
                reaction_desc: 'Click appearing targets to improve speed and accuracy',
                tracking_mode: 'Tracking',
                tracking_desc: 'Follow moving targets to improve dynamic response',
                schulte_mode: 'Schulte Grid',
                schulte_desc: 'Click numbers in order to improve attention and visual search',
                training_mode: 'Training mode',
                mode_normal: 'Normal',
                mode_flick: 'Flick',
                mode_tracking: 'Tracking',
                easy_label: '🟢 Easy',
                easy_stats: 'Target: 60px\nDuration: 2.5s\nInterval: 800ms',
                medium_label: '🟡 Medium',
                medium_stats: 'Target: 45px\nDuration: 2.0s\nInterval: 600ms',
                hard_label: '🟠 Hard',
                hard_stats: 'Target: 35px\nDuration: 1.5s\nInterval: 400ms',
                expert_label: '🔴 Expert',
                expert_stats: 'Target: 25px\nDuration: 1.2s\nInterval: 300ms',
                label_duration: 'Game duration',
                opt_30s: '30s',
                opt_60s: '60s',
                opt_90s: '90s',
                opt_2min: '2 min',
                label_target_style: 'Target style',
                opt_head: 'Head shape',
                opt_circle: 'Circle',
                opt_square: 'Square',
                label_sound: 'Sound effects',
                opt_on: 'On',
                opt_off: 'Off',
                label_training_mode: 'Training mode',
            }
        };

        function getStoredLang() {
            return localStorage.getItem('i18n_lang') || 'zh';
        }

        function changeLanguage(lang) {
            if (!i18n[lang]) return;
            localStorage.setItem('i18n_lang', lang);
            translateAll(lang);
        }

        function t(key) {
            const lang = getStoredLang();
            return (i18n[lang] && i18n[lang][key]) || key;
        }

        function translateAll(lang) {
            lang = lang || getStoredLang();
            const sel = document.getElementById('langSelect');
            if (sel) sel.value = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const text = (i18n[lang] && i18n[lang][key]) || el.textContent;
                el.textContent = text;
            });
        }

        window.addEventListener('DOMContentLoaded', function() {
            translateAll(getStoredLang());
        });
        window.addEventListener('load', function() { translateAll(getStoredLang()); });
    </script>
</body>
</html>
