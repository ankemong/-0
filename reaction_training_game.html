<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1512591473794042"
        crossorigin="anonymous"></script>
    <title>ç²¾å‡†ç‚¹å‡»è®­ç»ƒå™¨ - æå‡ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .game-container {
            text-align: center;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
        }

        .game-area {
            width: 100%;
            height: 100vh;
            position: relative;
            cursor: crosshair;
        }

        .target {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff4757, #ff3742);
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
            cursor: pointer;
            transition: all 0.1s ease;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .target:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.8);
        }

        .target.hit {
            background: radial-gradient(circle, #00ff88, #00e676);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .start-screen, .game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* ä¸ºåº•éƒ¨å¯¼èˆªç•™å‡ºç©ºé—´ */
        }

        .start-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px;
            width: 100%;
            margin: auto;
            padding: 20px 0;
        }

        .game-over-screen {
            justify-content: center;
        }

        .title {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .btn {
            padding: 15px 40px;
            font-size: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
            max-width: 600px;
        }

        .difficulty-btn {
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .difficulty-btn.active {
            background: rgba(0,255,136,0.2);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }

        .difficulty-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .difficulty-stats {
            font-size: 11px;
            opacity: 0.7;
            line-height: 1.3;
        }




        .settings-panel {
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .settings-panel h4 {
            color: #00ff88;
            text-align: center;
            margin-bottom: 15px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-item label {
            font-size: 12px;
            color: #ccc;
            font-weight: 500;
        }

        .setting-item select {
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 13px;
            cursor: pointer;
        }

        .setting-item select:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 5px rgba(0,255,136,0.3);
        }

        .final-stats {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .accuracy-bar {
            width: 300px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px auto;
        }

        .accuracy-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa726, #00ff88);
            transition: width 0.5s ease;
        }

        .progress-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
        }

        .progress-ring-circle {
            stroke: rgba(0,255,136,0.3);
            stroke-width: 4;
            fill: transparent;
            r: 45;
            cx: 50;
            cy: 50;
        }

        .progress-ring-fill {
            stroke: #00ff88;
            stroke-width: 4;
            fill: transparent;
            r: 45;
            cx: 50;
            cy: 50;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.1s linear;
        }

        /* èˆ’å°”ç‰¹æ–¹æ ¼æ ·å¼ */
        .schulte-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            gap: 4px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(0,255,136,0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .schulte-grid.size-3x3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .schulte-grid.size-4x4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .schulte-grid.size-5x5 {
            grid-template-columns: repeat(5, 1fr);
        }

        .schulte-grid.size-2x2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .schulte-grid.size-6x6 {
            grid-template-columns: repeat(6, 1fr);
        }

        .schulte-grid.size-7x7 {
            grid-template-columns: repeat(7, 1fr);
        }

        .schulte-grid.size-8x8 {
            grid-template-columns: repeat(8, 1fr);
        }

        .schulte-cell {
            width: 96px;
            height: 96px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.18s ease;
            user-select: none;
        }

        /* ä¸åŒå°ºå¯¸æ–¹æ ¼çš„å•å…ƒæ ¼å¤§å°è°ƒæ•´ï¼ˆæ›´å¤§ï¼‰ */
        .schulte-grid.size-2x2 .schulte-cell { width: 120px; height: 120px; font-size: 36px; }
        .schulte-grid.size-3x3 .schulte-cell { width: 100px; height: 100px; font-size: 32px; }
        .schulte-grid.size-4x4 .schulte-cell { width: 96px; height: 96px; font-size: 28px; }
        .schulte-grid.size-5x5 .schulte-cell { width: 88px; height: 88px; font-size: 24px; }
        .schulte-grid.size-6x6 .schulte-cell { width: 80px; height: 80px; font-size: 20px; }
        .schulte-grid.size-7x7 .schulte-cell { width: 72px; height: 72px; font-size: 18px; }
        .schulte-grid.size-8x8 .schulte-cell { width: 64px; height: 64px; font-size: 16px; }

        .schulte-cell:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: #00ff88;
            transform: scale(1.05);
        }

        .schulte-cell.found {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #00ff88;
            color: #fff;
            animation: schulteSuccess 0.3s ease;
        }

        .schulte-cell.wrong {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #ff4757;
            animation: schulteError 0.3s ease;
        }

        @keyframes schulteSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @keyframes schulteError {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .schulte-info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid rgba(0,255,136,0.3);
            color: white;
            text-align: center;
        }

        .schulte-current-number {
            font-size: 24px;
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .schulte-stats {
            font-size: 14px;
            opacity: 0.8;
        }

        .schulte-size-selector {
            margin: 20px 0;
            text-align: center;
        }

        .schulte-size-btn {
            padding: 10px 20px;
            margin: 0 5px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .schulte-size-btn:hover,
        .schulte-size-btn.active {
            background: rgba(0,255,136,0.2);
            border-color: #00ff88;
        }

        /* è®­ç»ƒæ¨¡å¼é€‰æ‹©å¡ç‰‡ */
        .training-mode-selector {
            margin: 30px 0;
            text-align: center;
        }

        /* é¡µé¢åº•éƒ¨å¯¼èˆª - å›ºå®šåœ¨é¡µé¢æœ€åº•éƒ¨ï¼Œä¸éšæ»šåŠ¨ç§»åŠ¨ */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            display: flex;
            justify-content: center;
            gap: 15px;
            background: rgba(0,0,0,0.8);
            padding: 12px 20px;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 -2px 20px rgba(0,0,0,0.3);
        }

        .footer-nav-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .footer-nav-btn:hover {
            background: rgba(0,255,136,0.1);
            border-color: rgba(0,255,136,0.3);
            color: #00ff88;
            transform: translateY(-1px);
        }

        /* ä¿¡æ¯å¼¹çª—æ ·å¼ */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .info-modal-content {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
            position: relative;
        }

        .info-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0,255,136,0.3);
        }

        .info-modal-title {
            color: #00ff88;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        .info-modal-close {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .info-modal-close:hover {
            background: rgba(255,71,87,0.2);
            border-color: #ff4757;
        }

        .info-modal-body {
            line-height: 1.6;
            font-size: 14px;
        }

        .info-modal-body h3 {
            color: #00ff88;
            margin: 20px 0 10px 0;
        }

        .info-modal-body p {
            margin: 10px 0;
            opacity: 0.9;
        }

        .info-modal-body ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-modal-body li {
            margin: 5px 0;
            opacity: 0.9;
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 20px 0;
            max-width: 800px;
            margin: 20px auto;
        }

        .mode-card {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mode-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,255,136,0.2);
        }

        .mode-card.active {
            background: rgba(0,255,136,0.15);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
            animation: modeIconFloat 3s ease-in-out infinite;
        }

        @keyframes modeIconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .mode-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 8px;
        }

        .mode-desc {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* èˆ’å°”ç‰¹æ–¹æ ¼è®¾ç½®åŒºåŸŸ */
        .schulte-settings {
            margin: 30px 0;
        }

        .reaction-settings {
            margin: 30px 0;
        }

        .schulte-size-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .schulte-size-btn {
            padding: 12px 8px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .size-label {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .size-desc {
            font-size: 11px;
            opacity: 0.7;
            line-height: 1.2;
        }

        .schulte-info-panel {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        .schulte-info-panel h5 {
            color: #00ff88;
            margin-bottom: 10px;
            text-align: center;
        }

        .schulte-info-panel ul {
            list-style: none;
            padding: 0;
        }

        .schulte-info-panel li {
            margin: 5px 0;
            font-size: 13px;
            opacity: 0.9;
        }

        /* å¹¿å‘Šä½æ ·å¼ */
        .ad-banner {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .ad-banner::before {
            content: 'å¹¿å‘Š';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 10px;
            opacity: 0.5;
        }
        
        .ad-banner.large {
            min-height: 250px;
        }
        
        .ad-banner.small {
            min-height: 80px;
            font-size: 12px;
        }
        
    /* VIP/è´¦æˆ·/æ”¯ä»˜æ ·å¼ä¸ä¸“ä¸šæ¨¡å¼æ ·å¼å·²ç§»é™¤ä»¥ç®€åŒ–é¡¹ç›®ã€‚ */
        
        .pro-mode-btn:hover {
            background: rgba(255,215,0,0.2);
            border-color: rgba(255,215,0,0.5);
            transform: translateY(-2px);
        }
        
        .pro-mode-btn.active {
            background: rgba(255,215,0,0.25);
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255,215,0,0.4);
        }
        
    .pro-mode-icon { display: none !important; }
    .pro-mode-name { display: none !important; }
        
        .pro-mode-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.2;
            color: #ccc;
        }
        
        /* è¯¦ç»†æ•°æ®åˆ†ææ ·å¼ */
        .detailed-stats {
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-title {
            font-size: 14px;
            color: #00ff88;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-desc {
            font-size: 12px;
            opacity: 0.7;
            line-height: 1.3;
        }
        
        .progress-chart {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .chart-title {
            color: #00ff88;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-label {
            min-width: 80px;
            font-size: 12px;
            text-align: right;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa726, #00ff88);
            transition: width 0.8s ease;
        }
        
        .progress-value {
            min-width: 50px;
            font-size: 12px;
            font-weight: bold;
            text-align: left;
        }
        
        /* ä¸“å±æˆå°±æ ·å¼ */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        
        .achievement-card {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .achievement-card.unlocked {
            background: rgba(255,215,0,0.15);
            border-color: rgba(255,215,0,0.5);
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }
        
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        
        .achievement-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #00ff88;
        }
        
        .achievement-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.2;
        }

    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¼€å§‹ç•Œé¢ -->
        <div class="start-screen" id="startScreen">
            <div class="title">ğŸ¯ ç²¾å‡†ç‚¹å‡»è®­ç»ƒå™¨</div>
            <div class="subtitle" data-i18n="subtitle">ä¸“ä¸šçº§ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦è®­ç»ƒå¹³å°</div>
            <div style="position: absolute; top: 18px; right: 18px;">
                <select id="langSelect" onchange="changeLanguage(this.value)">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                </select>
            </div>
            
            <!-- è®­ç»ƒæ¨¡å¼é€‰æ‹© -->
            <div class="training-mode-selector">
                <h3 style="color: #00ff88; margin-bottom: 20px;" data-i18n="choose_mode">ğŸ® é€‰æ‹©è®­ç»ƒæ¨¡å¼</h3>
                <div class="mode-cards">
                    <div class="mode-card active" data-mode="reaction">
                        <div class="mode-icon">ğŸ¯</div>
                        <div class="mode-title" data-i18n="reaction_mode">ååº”é€Ÿåº¦è®­ç»ƒ</div>
                        <div class="mode-desc" data-i18n="reaction_desc">ç‚¹å‡»éšæœºç›®æ ‡ï¼Œæå‡ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦</div>
                    </div>
                    <div class="mode-card" data-mode="tracking">
                        <div class="mode-icon">ğŸ®</div>
                        <div class="mode-title" data-i18n="tracking_mode">è¿½è¸ªè®­ç»ƒ</div>
                        <div class="mode-desc" data-i18n="tracking_desc">è·Ÿè¸ªç§»åŠ¨ç›®æ ‡ï¼Œæå‡åŠ¨æ€ååº”èƒ½åŠ›</div>
                    </div>
                    <div class="mode-card" data-mode="schulte">
                        <div class="mode-icon">ğŸ§ </div>
                        <div class="mode-title" data-i18n="schulte_mode">èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒ</div>
                        <div class="mode-desc" data-i18n="schulte_desc">æŒ‰é¡ºåºç‚¹å‡»æ•°å­—ï¼Œæå‡æ³¨æ„åŠ›å’Œè§†è§‰æœç´¢èƒ½åŠ›</div>
                    </div>
                </div>
            </div>

            <!-- å¹¿å‘Šä½å·²ç§»é™¤ï¼šä½¿ç”¨é¡µé¢ head ä¸­çš„ AdSense è„šæœ¬æä¾›å¹¿å‘Š -->

            <!-- ååº”é€Ÿåº¦è®­ç»ƒè®¾ç½® -->
            <div class="reaction-settings" id="reactionSettings">
                <h4 style="color: #00ff88; margin-bottom: 15px;">ğŸ¯ ååº”é€Ÿåº¦è®­ç»ƒè®¾ç½®</h4>
                
                <div class="difficulty-selector">
                    <div class="difficulty-btn active" data-difficulty="easy">
                        <div class="difficulty-label" data-i18n="easy_label">ğŸŸ¢ æ–°æ‰‹</div>
                        <div class="difficulty-stats" data-i18n="easy_stats">ç›®æ ‡: 60px<br>æŒç»­: 2.5s<br>é—´éš”: 800ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="medium">
                        <div class="difficulty-label" data-i18n="medium_label">ğŸŸ¡ è¿›é˜¶</div>
                        <div class="difficulty-stats" data-i18n="medium_stats">ç›®æ ‡: 45px<br>æŒç»­: 2.0s<br>é—´éš”: 600ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="hard">
                        <div class="difficulty-label" data-i18n="hard_label">ğŸŸ  å›°éš¾</div>
                        <div class="difficulty-stats" data-i18n="hard_stats">ç›®æ ‡: 35px<br>æŒç»­: 1.5s<br>é—´éš”: 400ms</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="expert">
                        <div class="difficulty-label" data-i18n="expert_label">ğŸ”´ ä¸“å®¶</div>
                        <div class="difficulty-stats" data-i18n="expert_stats">ç›®æ ‡: 25px<br>æŒç»­: 1.2s<br>é—´éš”: 300ms</div>
                    </div>
                </div>
                
                <!-- ä¸“ä¸šè®­ç»ƒæ¨¡å¼ï¼ˆå·²ç§»é™¤ï¼‰ -->
                
                <div class="settings-panel">
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label data-i18n="label_duration">æ¸¸æˆæ—¶é•¿</label>
                            <select id="game-duration">
                                <option value="30" data-i18n="opt_30s">30ç§’</option>
                                <option value="60" selected data-i18n="opt_60s">60ç§’</option>
                                <option value="90" data-i18n="opt_90s">90ç§’</option>
                                <option value="120" data-i18n="opt_2min">2åˆ†é’Ÿ</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_target_style">ç›®æ ‡æ ·å¼</label>
                            <select id="target-style">
                                <option value="head" selected data-i18n="opt_head">å¤´éƒ¨å½¢çŠ¶</option>
                                <option value="circle" data-i18n="opt_circle">åœ†å½¢</option>
                                <option value="square" data-i18n="opt_square">æ–¹å½¢</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_sound">éŸ³æ•ˆåé¦ˆ</label>
                            <select id="sound-effects">
                                <option value="on" selected data-i18n="opt_on">å¼€å¯</option>
                                <option value="off" data-i18n="opt_off">å…³é—­</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label data-i18n="label_training_mode">è®­ç»ƒæ¨¡å¼</label>
                            <select id="training-mode">
                                <option value="normal" selected data-i18n="mode_normal">æ™®é€šæ¨¡å¼</option>
                                <option value="flick" data-i18n="mode_flick">å¿«é€Ÿåˆ‡æ¢</option>
                                <option value="tracking" data-i18n="mode_tracking">è·Ÿè¸ªè®­ç»ƒ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¿½è¸ªè®­ç»ƒè®¾ç½® -->
            <div class="tracking-settings" id="trackingSettings" style="display: none;">
                <h4 style="color: #00ff88; margin-bottom: 15px;">ğŸ® è¿½è¸ªè®­ç»ƒè®¾ç½®</h4>
                
                <div class="difficulty-selector">
                    <div class="difficulty-btn" data-difficulty="slow">
                        <div class="difficulty-label">ğŸ¢ ç¼“æ…¢</div>
                        <div class="difficulty-stats">ç›®æ ‡: 50px<br>ç§»åŠ¨: 2px/å¸§<br>æ–¹å‘: ç¨³å®š</div>
                    </div>
                    <div class="difficulty-btn active" data-difficulty="medium">
                        <div class="difficulty-label">ğŸ¯ æ™®é€š</div>
                        <div class="difficulty-stats">ç›®æ ‡: 40px<br>ç§»åŠ¨: 3px/å¸§<br>æ–¹å‘: éšæœº</div>
                    </div>
                    <div class="difficulty-btn" data-difficulty="fast">
                        <div class="difficulty-label">âš¡ æŒ‘æˆ˜</div>
                        <div class="difficulty-stats">ç›®æ ‡: 30px<br>ç§»åŠ¨: 4px/å¸§<br>æ–¹å‘: æ”¹å˜</div>
                    </div>
                </div>
                
                <div class="settings-panel">
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>è®­ç»ƒæ—¶é•¿</label>
                            <select id="tracking-duration">
                                <option value="60" selected>60ç§’</option>
                                <option value="90">90ç§’</option>
                                <option value="120">2åˆ†é’Ÿ</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>éŸ³æ•ˆåé¦ˆ</label>
                            <select id="tracking-sound-effects">
                                <option value="on" selected>å¼€å¯</option>
                                <option value="off">å…³é—­</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="schulte-info-panel">
                    <h5>ğŸ’« è®­ç»ƒä»·å€¼ï¼š</h5>
                    <ul>
                        <li>â€¢ æå‡åŠ¨æ€è§†è§‰è¿½è¸ªèƒ½åŠ›</li>
                        <li>â€¢ å¢å¼ºæ‰‹çœ¼åè°ƒæ€§</li>
                        <li>â€¢ è®­ç»ƒé¢„æµ‹åˆ¤æ–­èƒ½åŠ›</li>
                        <li>â€¢ æå‡ååº”é€Ÿåº¦</li>
                    </ul>
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.7; text-align: center;">
                        ğŸ’¡ ä¿æŒé¼ æ ‡åœ¨ç›®æ ‡ä¸Šï¼Œè·Ÿéšå…¶ç§»åŠ¨è½¨è¿¹
                    </div>
                </div>
            </div>
            

            <!-- èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒè®¾ç½® -->
            <div class="schulte-settings" id="schulteSettings" style="display: none;">
                <h4 style="color: #00ff88; margin-bottom: 15px;">ğŸ§  èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒè®¾ç½®</h4>
                
                <div class="schulte-size-selector">
                    <button class="schulte-size-btn" data-size="2">
                        <div class="size-label">ğŸŒ± 2x2</div>
                        <div class="size-desc">åˆå­¦è€… - 4ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn active" data-size="3">
                        <div class="size-label">ğŸŸ¢ 3x3</div>
                        <div class="size-desc">å…¥é—¨çº§ - 9ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn" data-size="4">
                        <div class="size-label">ğŸŸ¡ 4x4</div>
                        <div class="size-desc">è¿›é˜¶çº§ - 16ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn" data-size="5">
                        <div class="size-label">ğŸŸ  5x5</div>
                        <div class="size-desc">ä¸­çº§ - 25ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn" data-size="6">
                        <div class="size-label">ğŸŸ£ 6x6</div>
                        <div class="size-desc">é«˜çº§ - 36ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn" data-size="7">
                        <div class="size-label">ğŸ”´ 7x7</div>
                        <div class="size-desc">ä¸“å®¶çº§ - 49ä¸ªæ•°å­—</div>
                    </button>
                    <button class="schulte-size-btn" data-size="8">
                        <div class="size-label">âš« 8x8</div>
                        <div class="size-desc">å¤§å¸ˆçº§ - 64ä¸ªæ•°å­—</div>
                    </button>
                </div>
                
                <div class="settings-panel">
                    <div class="setting-item" style="text-align: center;">
                        <label>éŸ³æ•ˆåé¦ˆ</label>
                        <select id="schulte-sound-effects">
                            <option value="on" selected>å¼€å¯</option>
                            <option value="off">å…³é—­</option>
                        </select>
                    </div>
                </div>
                
                <div class="schulte-info-panel">
                    <h5>ğŸ’« è®­ç»ƒä»·å€¼ï¼š</h5>
                    <ul>
                        <li>â€¢ æå‡æ³¨æ„åŠ›é›†ä¸­åº¦</li>
                        <li>â€¢ å¢å¼ºè§†è§‰æœç´¢èƒ½åŠ›</li>
                        <li>â€¢ è®­ç»ƒå‘¨è¾¹è§†è§‰</li>
                        <li>â€¢ æ”¹å–„è®¤çŸ¥å¤„ç†é€Ÿåº¦</li>
                    </ul>
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.7; text-align: center;">
                        ğŸ’¡ å»ºè®®ä»å°å°ºå¯¸å¼€å§‹ï¼Œé€æ¸æŒ‘æˆ˜æ›´å¤§æ–¹æ ¼
                    </div>
                </div>
            </div>
            
            <button class="btn" id="startTrainingBtn" onclick="startTraining()">å¼€å§‹è®­ç»ƒ</button>
            <!-- ä¸“ä¸šè®­ç»ƒæŒ‰é’®å·²ç§»é™¤ -->
            
            <!-- VIPä¼šå‘˜æ¨å¹¿æ¨ªå¹… -->
            <!-- VIP banner å·²ç§»é™¤ -->
            
            <!-- é¡µé¢åº•éƒ¨å¯¼èˆª - åªåœ¨å¼€å§‹ç•Œé¢æ˜¾ç¤º -->
            <div class="footer-nav">
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('about')">å…³äºæˆ‘ä»¬</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('contact')">è”ç³»æˆ‘ä»¬</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('privacy')">éšç§æ”¿ç­–</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('features')">æ ¸å¿ƒä¼˜åŠ¿</a>
                <a href="#" class="footer-nav-btn" onclick="showInfoModal('disclaimer')">å…è´£å£°æ˜</a>
                <!-- è´¦æˆ·å…¥å£å·²ç§»é™¤ -->
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div class="header" id="gameHeader" style="display: none;">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">å¾—åˆ†</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å‘½ä¸­ç‡</div>
                    <div class="stat-value" id="accuracy">100%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å¹³å‡ååº”</div>
                    <div class="stat-value" id="avgReaction">0ms</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å‰©ä½™æ—¶é—´</div>
                    <div class="stat-value" id="timeLeft">30s</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">è¿å‡»</div>
                    <div class="stat-value" id="combo">0</div>
                </div>
            </div>
        </div>

        <div class="game-area" id="gameArea"></div>

        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div class="game-over-screen" id="gameOverScreen" style="display: none;">
            <div class="title">ğŸ† è®­ç»ƒå®Œæˆ</div>
            
            <div class="final-stats" id="finalStats">
                <!-- ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <button class="btn" onclick="restartGame()">å†æ¬¡è®­ç»ƒ</button>
            <button class="btn" onclick="backToMenu()">è¿”å›èœå•</button>
        </div>
    </div>


    <!-- ä¿¡æ¯å¼¹çª— -->
    <div class="info-modal" id="infoModal">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h2 class="info-modal-title" id="infoModalTitle">æ ‡é¢˜</h2>
                <button class="info-modal-close" onclick="closeInfoModal()">&times;</button>
            </div>
            <div class="info-modal-body" id="infoModalBody">
                <!-- å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ -->

    <!-- VIP åŠŸèƒ½å·²å–æ¶ˆ -->

    <!-- è´¦æˆ·ç³»ç»Ÿå·²å–æ¶ˆ -->

    <!-- æ¸¸æˆç»“æŸå¹¿å‘Šä½å·²ç§»é™¤ï¼›å¹¿å‘Šç”± head ä¸­çš„ AdSense è„šæœ¬æä¾› -->

    <script>
        let gameState = {
            score: 0,
            hits: 0,
            misses: 0,
            totalClicks: 0,
            reactionTimes: [],
            combo: 0,
            maxCombo: 0,
            gameTime: 60,
            totalGameTime: 60,
            currentTarget: null,
            targetStartTime: 0,
            gameActive: false,
            difficulty: 'easy',
            targetStyle: 'head',
            soundEnabled: true,
            trainingMode: 'normal',
            schulteSize: 3,
            schulteNumbers: [],
            schulteCurrentNumber: 1,
            schulteStartTime: 0
        };

        // éŸ³æ•ˆç³»ç»Ÿ
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(frequency, duration, type = 'sine') {
            if (!gameState.soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        const difficulties = {
            easy: { targetSize: 60, targetTime: 2500, spawnDelay: 800, timeBonus: 1 },
            medium: { targetSize: 45, targetTime: 2000, spawnDelay: 600, timeBonus: 1.5 },
            hard: { targetSize: 35, targetTime: 1500, spawnDelay: 400, timeBonus: 2 },
            expert: { targetSize: 25, targetTime: 1200, spawnDelay: 300, timeBonus: 2.5 }
        };

        // éš¾åº¦é€‰æ‹© - æ”¹è¿›äº‹ä»¶ç›‘å¬å™¨
        function setupDifficultyButtons() {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // æ‰¾åˆ°ç›¸åŒçˆ¶å…ƒç´ ä¸‹çš„æ‰€æœ‰éš¾åº¦æŒ‰é’®
                    const parent = this.closest('.difficulty-selector');
                    parent.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameState.difficulty = this.dataset.difficulty;
                    console.log('éš¾åº¦è®¾ç½®ä¸º:', gameState.difficulty);
                });
            });
        }
        
        // åˆå§‹åŒ–éš¾åº¦æŒ‰é’®
        setupDifficultyButtons();

        // èˆ’å°”ç‰¹æ–¹æ ¼å¤§å°é€‰æ‹©
        document.querySelectorAll('.schulte-size-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.schulte-size-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                gameState.schulteSize = parseInt(this.dataset.size);
            });
        });

        // è®­ç»ƒæ¨¡å¼å¡ç‰‡é€‰æ‹©
        document.querySelectorAll('.mode-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                const mode = this.dataset.mode;
                const reactionSettings = document.getElementById('reactionSettings');
                const trackingSettings = document.getElementById('trackingSettings');
                const schulteSettings = document.getElementById('schulteSettings');
                
                // éšè—æ‰€æœ‰è®¾ç½®é¢æ¿
                reactionSettings.style.display = 'none';
                trackingSettings.style.display = 'none';
                schulteSettings.style.display = 'none';
                
                // æ˜¾ç¤ºå¯¹åº”è®¾ç½®é¢æ¿å¹¶è®¾ç½®è®­ç»ƒæ¨¡å¼
                switch(mode) {
                    case 'reaction':
                        reactionSettings.style.display = 'block';
                        gameState.trainingMode = 'reaction';
                        break;
                    case 'tracking':
                        trackingSettings.style.display = 'block';
                        gameState.trainingMode = 'tracking';
                        // åˆå§‹åŒ–è¿½è¸ªè®­ç»ƒçš„é»˜è®¤é›¾åº¦
                        gameState.difficulty = 'medium';
                        break;
                    case 'schulte':
                        schulteSettings.style.display = 'block';
                        gameState.trainingMode = 'schulte';
                        break;
                }
            });
        });

        function startTraining() {
            document.getElementById('startScreen').style.display = 'none';
            
            if (gameState.trainingMode === 'schulte') {
                // èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒ
                const schulteSoundEnabled = document.getElementById('schulte-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    soundEnabled: schulteSoundEnabled,
                    schulteNumbers: [],
                    schulteCurrentNumber: 1,
                    schulteStartTime: 0
                };
                
                startSchulteGame();
            } else if (gameState.trainingMode === 'tracking') {
                // è¿½è¸ªè®­ç»ƒ
                const duration = parseInt(document.getElementById('tracking-duration').value);
                const soundEnabled = document.getElementById('tracking-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameTime: duration,
                    totalGameTime: duration,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    soundEnabled: soundEnabled,
                    // è¿½è¸ªè®­ç»ƒä¸“ç”¨çŠ¶æ€
                    trackingTarget: null,
                    trackingStartTime: 0,
                    trackingScore: 0,
                    trackingTime: 0, // é¼ æ ‡åœ¨ç›®æ ‡ä¸Šçš„æ—¶é—´
                    isTracking: false,
                    trackingAccuracy: 0
                };
                
                startTrackingGame();
            } else if (gameState.trainingMode === 'sequence') {
                // åºåˆ—è®­ç»ƒ
                const rounds = parseInt(document.getElementById('sequence-rounds').value);
                const soundEnabled = document.getElementById('sequence-sound-effects').value === 'on';
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameActive: true,
                    soundEnabled: soundEnabled,
                    // åºåˆ—è®­ç»ƒä¸“ç”¨çŠ¶æ€
                    sequenceRounds: rounds,
                    currentRound: 0,
                    sequenceTargets: [],
                    currentSequence: [],
                    playerSequence: [],
                    isShowingSequence: false,
                    isPlayerTurn: false,
                    sequenceIndex: 0,
                    sequenceStartTime: 0
                };
                
                startSequenceGame();
            } else {
                // ååº”é€Ÿåº¦è®­ç»ƒ
                const duration = parseInt(document.getElementById('game-duration').value);
                const targetStyle = document.getElementById('target-style').value;
                const soundEnabled = document.getElementById('sound-effects').value === 'on';
                const trainingMode = document.getElementById('training-mode').value;
                
                gameState = {
                    ...gameState,
                    score: 0,
                    hits: 0,
                    misses: 0,
                    totalClicks: 0,
                    reactionTimes: [],
                    combo: 0,
                    maxCombo: 0,
                    gameTime: duration,
                    totalGameTime: duration,
                    currentTarget: null,
                    targetStartTime: 0,
                    gameActive: true,
                    targetStyle: targetStyle,
                    soundEnabled: soundEnabled,
                    trainingMode: trainingMode,
                    schulteNumbers: [],
                    schulteCurrentNumber: 1,
                    schulteStartTime: 0
                };
                
                document.getElementById('gameHeader').style.display = 'block';
                updateStats();
                startGameTimer();
                spawnTarget();
            }
        }
        
        // å…¼å®¹æ—§çš„startGameå‡½æ•°
        function startGame() {
            startTraining();
        }

        function startGameTimer() {
            const timer = setInterval(() => {
                gameState.gameTime--;
                document.getElementById('timeLeft').textContent = gameState.gameTime + 's';
                
                if (gameState.gameTime <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }

        function spawnTarget() {
            if (!gameState.gameActive) return;
            
            // æ¸…é™¤å½“å‰ç›®æ ‡
            if (gameState.currentTarget) {
                gameState.currentTarget.remove();
                gameState.misses++;
                gameState.combo = 0;
                gameState.totalClicks++;
            }
            
            const gameArea = document.getElementById('gameArea');
            const target = document.createElement('div');
            target.className = 'target';
            
            const config = difficulties[gameState.difficulty];
            
            target.style.width = config.targetSize + 'px';
            target.style.height = config.targetSize + 'px';
            
            // æ ¹æ®è®¾ç½®åº”ç”¨ç›®æ ‡æ ·å¼
            switch(gameState.targetStyle) {
                case 'circle':
                    target.style.borderRadius = '50%';
                    target.style.background = 'radial-gradient(circle, #ff4757, #ff3742)';
                    break;
                case 'square':
                    target.style.borderRadius = '8px';
                    target.style.background = 'linear-gradient(135deg, #ff4757, #ff3742)';
                    break;
                case 'head':
                default:
                    target.style.borderRadius = '50% 50% 20% 20%';
                    target.style.background = 'radial-gradient(ellipse at center top, #ff4757, #ff3742)';
                    break;
            }
            
            // éšæœºä½ç½®ï¼ˆé¿å…è¾¹ç¼˜ï¼‰
            const margin = config.targetSize;
            const x = Math.random() * (window.innerWidth - 2 * margin) + margin;
            const y = Math.random() * (window.innerHeight - 200 - 2 * margin) + margin + 100;
            
            target.style.left = x - config.targetSize/2 + 'px';
            target.style.top = y - config.targetSize/2 + 'px';
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            target.addEventListener('click', hitTarget);
            
            gameArea.appendChild(target);
            gameState.currentTarget = target;
            gameState.targetStartTime = Date.now();
            
            // è®¾ç½®ç›®æ ‡æ¶ˆå¤±æ—¶é—´
            setTimeout(() => {
                if (gameState.currentTarget === target && gameState.gameActive) {
                    target.remove();
                    gameState.misses++;
                    gameState.combo = 0;
                    gameState.totalClicks++;
                    updateStats();
                    
                    // ç”Ÿæˆä¸‹ä¸€ä¸ªç›®æ ‡
                    setTimeout(() => spawnTarget(), config.spawnDelay);
                }
            }, config.targetTime);
        }

        function hitTarget(event) {
            event.preventDefault();
            if (!gameState.gameActive) return;
            
            const reactionTime = Date.now() - gameState.targetStartTime;
            gameState.reactionTimes.push(reactionTime);
            
            const config = difficulties[gameState.difficulty];
            let points = Math.max(100 - Math.floor(reactionTime / 10), 10);
            points = Math.floor(points * config.timeBonus);
            
            // è¿å‡»å¥–åŠ±
            if (gameState.combo > 0) {
                points += gameState.combo * 5;
            }
            
            gameState.score += points;
            gameState.hits++;
            gameState.combo++;
            gameState.totalClicks++;
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
            
            // éŸ³æ•ˆåé¦ˆ
            const hitFreq = 600 + (gameState.combo * 50); // è¿å‡»è¶Šé«˜éŸ³è°ƒè¶Šé«˜
            playSound(hitFreq, 0.1);
            
            // è§†è§‰åé¦ˆ
            event.target.classList.add('hit');
            setTimeout(() => {
                if (event.target) event.target.remove();
            }, 100);
            
            gameState.currentTarget = null;
            updateStats();
            
            // ç”Ÿæˆä¸‹ä¸€ä¸ªç›®æ ‡
            setTimeout(() => spawnTarget(), config.spawnDelay);
        }

        // ç‚¹å‡»ç©ºç™½åŒºåŸŸ
        document.getElementById('gameArea').addEventListener('click', function(event) {
            if (event.target === this && gameState.gameActive) {
                gameState.misses++;
                gameState.combo = 0;
                gameState.totalClicks++;
                playSound(200, 0.2); // å¤±è¯¯éŸ³æ•ˆ
                updateStats();
            }
        });

        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            document.getElementById('avgReaction').textContent = avgReaction + 'ms';
            
            document.getElementById('combo').textContent = gameState.combo;
        }

        function endGame() {
            gameState.gameActive = false;
            
            if (gameState.currentTarget) {
                gameState.currentTarget.remove();
            }
            
            document.getElementById('gameHeader').style.display = 'none';
            showGameOverScreen();
        }

        function showGameOverScreen() {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            
            // è¯„ä¼°ç­‰çº§
            let rank = '';
            let rankColor = '';
            if (accuracy >= 90 && avgReaction <= 400) {
                rank = 'ç¥æªæ‰‹ ğŸ†';
                rankColor = '#FFD700';
            } else if (accuracy >= 80 && avgReaction <= 500) {
                rank = 'ç²¾è‹±å°„æ‰‹ ğŸ¥‡';
                rankColor = '#C0C0C0';
            } else if (accuracy >= 70 && avgReaction <= 600) {
                rank = 'ç†Ÿç»ƒå°„æ‰‹ ğŸ¥ˆ';
                rankColor = '#CD7F32';
            } else if (accuracy >= 60) {
                rank = 'æ–°æ‰‹å°„æ‰‹ ğŸ¥‰';
                rankColor = '#87CEEB';
            } else {
                rank = 'éœ€è¦æ›´å¤šç»ƒä¹  ğŸ’ª';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">æ€»å¾—åˆ†: ${gameState.score}</div>
                        <div>å‘½ä¸­: ${gameState.hits} / æ€»ç‚¹å‡»: ${gameState.totalClicks}</div>
                        <div>å‘½ä¸­ç‡: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>å¹³å‡ååº”æ—¶é—´: ${avgReaction}ms</div>
                        <div>æœ€ä½³è¿å‡»: ${gameState.maxCombo}</div>
                        <div>éš¾åº¦: ${gameState.difficulty.toUpperCase()}</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">ç²¾å‡†åº¦è¯„ä¼°:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>ğŸ’¡ æå‡å»ºè®®:</p>
                    ${avgReaction > 500 ? '<p>â€¢ å°è¯•é¢„åˆ¤ç›®æ ‡ä½ç½®ï¼Œæå‰å‡†å¤‡ç‚¹å‡»</p>' : ''}
                    ${accuracy < 80 ? '<p>â€¢ ä¸“æ³¨ç²¾å‡†åº¦è€Œéé€Ÿåº¦ï¼Œå…ˆæ±‚å‡†å†æ±‚å¿«</p>' : ''}
                    ${gameState.maxCombo < 5 ? '<p>â€¢ ä¿æŒå†·é™ï¼Œå»ºç«‹ç¨³å®šçš„è¿å‡»èŠ‚å¥</p>' : ''}
                    <p>â€¢ å»ºè®®æ¯å¤©è®­ç»ƒ10-15åˆ†é’Ÿä»¥è·å¾—æœ€ä½³æ•ˆæœ</p>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <div style="font-size: 14px; margin-bottom: 10px;">å†å²æœ€ä½³è®°å½•:</div>
                    <div id="bestRecord" style="color: #00ff88; font-weight: bold;">é¦–æ¬¡æ¸¸æˆ</div>
                </div>
            `;
            
            // ä¿å­˜å’Œæ˜¾ç¤ºæœ€ä½³è®°å½•
            saveBestRecord(accuracy, avgReaction, gameState.score);
            
            // æ£€æŸ¥æˆå°±
            checkAchievements({
                accuracy: accuracy,
                avgReaction: avgReaction,
                score: gameState.score,
                maxCombo: gameState.maxCombo
            });

            // VIP ä¸“å±ï¼šæ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡å¹¶æ£€æŸ¥VIPæˆå°±
            if (vipStatus.isVIP) {
                showDetailedStats({ accuracy, avgReaction, score: gameState.score, maxCombo: gameState.maxCombo });
                checkVIPAchievements({ accuracy, avgReaction, score: gameState.score, maxCombo: gameState.maxCombo });
            }
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // å¢å¼ºçš„è®°å½•ç³»ç»Ÿ
        function saveBestRecord(accuracy, avgReaction, score) {
            const currentRecord = {
                accuracy: accuracy,
                avgReaction: avgReaction,
                score: score,
                difficulty: gameState.difficulty,
                trainingMode: gameState.trainingMode,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            // ä¿å­˜æœ€ä½³è®°å½•
            const bestRecord = JSON.parse(localStorage.getItem('reactionGameBest') || '{}');
            
            if (!bestRecord.score || score > bestRecord.score) {
                localStorage.setItem('reactionGameBest', JSON.stringify(currentRecord));
                document.getElementById('bestRecord').textContent = 
                    `å‡†ç¡®ç‡: ${accuracy}% | ååº”: ${avgReaction}ms | å¾—åˆ†: ${score}`;
                playSound(800, 0.3); // æ–°è®°å½•éŸ³æ•ˆ
            } else {
                document.getElementById('bestRecord').textContent = 
                    `å‡†ç¡®ç‡: ${bestRecord.accuracy}% | ååº”: ${bestRecord.avgReaction}ms | å¾—åˆ†: ${bestRecord.score}`;
            }
            
            // ä¿å­˜å†å²è®°å½•
            saveTrainingHistory(currentRecord);
        }
        
        // ä¿å­˜è®­ç»ƒå†å²
        function saveTrainingHistory(record) {
            let history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            history.push(record);
            
            // ä¿ç•™æœ€è¿‘100æ¬¡è®°å½•
            if (history.length > 100) {
                history = history.slice(-100);
            }
            
            localStorage.setItem('trainingHistory', JSON.stringify(history));
        }
        
        // è·å–è®­ç»ƒç»Ÿè®¡
        function getTrainingStats() {
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            const recent = history.slice(-10); // æœ€è¿‘10æ¬¡è®­ç»ƒ
            
            if (recent.length === 0) return null;
            
            const avgAccuracy = recent.reduce((sum, record) => sum + record.accuracy, 0) / recent.length;
            const avgReaction = recent.reduce((sum, record) => sum + record.avgReaction, 0) / recent.length;
            const avgScore = recent.reduce((sum, record) => sum + record.score, 0) / recent.length;
            
            const improvement = {
                accuracy: recent.length > 1 ? recent[recent.length-1].accuracy - recent[0].accuracy : 0,
                reaction: recent.length > 1 ? recent[0].avgReaction - recent[recent.length-1].avgReaction : 0,
                score: recent.length > 1 ? recent[recent.length-1].score - recent[0].score : 0
            };
            
            return {
                totalGames: history.length,
                recentGames: recent.length,
                avgAccuracy: Math.round(avgAccuracy),
                avgReaction: Math.round(avgReaction),
                avgScore: Math.round(avgScore),
                improvement
            };
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            startGame();
        }

        function backToMenu() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }







        // èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒåŠŸèƒ½
        function startSchulteGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // åˆ›å»ºèˆ’å°”ç‰¹æ–¹æ ¼ä¿¡æ¯é¢æ¿
            const infoPanel = document.createElement('div');
            infoPanel.className = 'schulte-info';
            infoPanel.innerHTML = `
                <div class="schulte-current-number">å¯»æ‰¾æ•°å­—: ${gameState.schulteCurrentNumber}</div>
                <div class="schulte-stats">æ—¶é—´: <span id="schulteTime">0</span>s | å®Œæˆ: <span id="schulteProgress">0/${gameState.schulteSize * gameState.schulteSize}</span></div>
            `;
            gameArea.appendChild(infoPanel);
            
            // åˆ›å»ºæ–¹æ ¼
            createSchulteGrid();
            
            // å¼€å§‹è®¡æ—¶
            gameState.schulteStartTime = Date.now();
            startSchulteTimer();
        }
        
        function createSchulteGrid() {
            const gameArea = document.getElementById('gameArea');
            const gridSize = gameState.schulteSize;
            const totalNumbers = gridSize * gridSize;
            
            // ç”Ÿæˆéšæœºæ•°å­—æ•°ç»„
            gameState.schulteNumbers = Array.from({length: totalNumbers}, (_, i) => i + 1);
            for (let i = gameState.schulteNumbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.schulteNumbers[i], gameState.schulteNumbers[j]] = [gameState.schulteNumbers[j], gameState.schulteNumbers[i]];
            }
            
            // åˆ›å»ºç½‘æ ¼
            const grid = document.createElement('div');
            grid.className = `schulte-grid size-${gridSize}x${gridSize}`;
            
            for (let i = 0; i < totalNumbers; i++) {
                const cell = document.createElement('div');
                cell.className = 'schulte-cell';
                cell.textContent = gameState.schulteNumbers[i];
                cell.dataset.number = gameState.schulteNumbers[i];
                cell.addEventListener('click', handleSchulteClick);
                grid.appendChild(cell);
            }
            
            gameArea.appendChild(grid);
        }
        
        function handleSchulteClick(event) {
            if (!gameState.gameActive) return;
            
            const clickedNumber = parseInt(event.target.dataset.number);
            
            if (clickedNumber === gameState.schulteCurrentNumber) {
                // æ­£ç¡®ç‚¹å‡»
                event.target.classList.add('found');
                gameState.schulteCurrentNumber++;
                gameState.hits++;
                
                const reactionTime = Date.now() - gameState.schulteStartTime;
                gameState.reactionTimes.push(reactionTime);
                
                playSound(600 + (gameState.schulteCurrentNumber * 20), 0.1);
                
                // æ›´æ–°æ˜¾ç¤º
                document.querySelector('.schulte-current-number').textContent = 
                    `å¯»æ‰¾æ•°å­—: ${gameState.schulteCurrentNumber}`;
                document.getElementById('schulteProgress').textContent = 
                    `${gameState.schulteCurrentNumber - 1}/${gameState.schulteSize * gameState.schulteSize}`;
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (gameState.schulteCurrentNumber > gameState.schulteSize * gameState.schulteSize) {
                    endSchulteGame();
                }
            } else {
                // é”™è¯¯ç‚¹å‡»
                event.target.classList.add('wrong');
                gameState.misses++;
                playSound(200, 0.2);
                
                setTimeout(() => {
                    event.target.classList.remove('wrong');
                }, 300);
            }
            
            gameState.totalClicks++;
        }
        
        function startSchulteTimer() {
            const timer = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(timer);
                    return;
                }
                
                const elapsed = Math.floor((Date.now() - gameState.schulteStartTime) / 1000);
                document.getElementById('schulteTime').textContent = elapsed;
            }, 100);
        }
        
        function endSchulteGame() {
            gameState.gameActive = false;
            const completionTime = Math.floor((Date.now() - gameState.schulteStartTime) / 1000);
            
            // è®¡ç®—å¾—åˆ†
            const baseScore = gameState.schulteSize * gameState.schulteSize * 100;
            const timeBonus = Math.max(0, 300 - completionTime) * 10; // æ—¶é—´è¶ŠçŸ­å¥–åŠ±è¶Šé«˜
            const accuracyBonus = Math.floor((gameState.hits / gameState.totalClicks) * 200);
            gameState.score = baseScore + timeBonus + accuracyBonus;
            
            showSchulteGameOverScreen(completionTime);
        }
        
        function showSchulteGameOverScreen(completionTime) {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgTimePerNumber = Math.round(completionTime / (gameState.schulteSize * gameState.schulteSize) * 100) / 100;
            
            // è¯„ä¼°ç­‰çº§ï¼ˆæ ¹æ®æ–¹æ ¼å¤§å°è°ƒæ•´æ ‡å‡†ï¼‰
            let rank = '';
            let rankColor = '';
            const gridSize = gameState.schulteSize;
            const baseTime = gridSize * gridSize * 1.5; // åŸºç¡€æ—¶é—´æ ‡å‡†
            
            if (completionTime <= baseTime * 0.5 && accuracy >= 95) {
                rank = 'æ³¨æ„åŠ›å¤§å¸ˆ ğŸ§ ';
                rankColor = '#FFD700';
            } else if (completionTime <= baseTime * 0.7 && accuracy >= 90) {
                rank = 'ä¸“æ³¨è¾¾äºº â­';
                rankColor = '#C0C0C0';
            } else if (completionTime <= baseTime && accuracy >= 85) {
                rank = 'é›†ä¸­èƒ½æ‰‹ ğŸ’«';
                rankColor = '#CD7F32';
            } else if (accuracy >= 80) {
                rank = 'æ³¨æ„åŠ›æ–°æ‰‹ ğŸŒŸ';
                rankColor = '#87CEEB';
            } else {
                rank = 'éœ€è¦æ›´å¤šç»ƒä¹  ğŸ’ª';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">æ€»å¾—åˆ†: ${gameState.score}</div>
                        <div>å®Œæˆæ—¶é—´: ${completionTime}ç§’</div>
                        <div>å‡†ç¡®ç‡: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>æ–¹æ ¼å¤§å°: ${gameState.schulteSize}x${gameState.schulteSize}</div>
                        <div>å¹³å‡æ¯æ•°å­—: ${avgTimePerNumber}s</div>
                        <div>é”™è¯¯ç‚¹å‡»: ${gameState.misses}æ¬¡</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">å®Œæˆåº¦è¯„ä¼°:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>ğŸ’¡ æå‡å»ºè®®:</p>
                    ${completionTime > 60 ? '<p>â€¢ ç»ƒä¹ å¿«é€Ÿæ‰«æï¼Œç”¨å‘¨è¾¹è§†è§‰å¯»æ‰¾æ•°å­—</p>' : ''}
                    ${accuracy < 90 ? '<p>â€¢ ä¿æŒå†·é™ï¼Œå…ˆç¡®è®¤æ•°å­—å†ç‚¹å‡»</p>' : ''}
                    ${avgTimePerNumber > 2 ? '<p>â€¢ å°è¯•è®°å¿†æ•°å­—ä½ç½®ï¼Œå‡å°‘é‡å¤æœç´¢</p>' : ''}
                    <p>â€¢ èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒèƒ½æœ‰æ•ˆæå‡æ³¨æ„åŠ›å’Œè§†è§‰æœç´¢èƒ½åŠ›</p>
                    <p>â€¢ å»ºè®®ä»å°å°ºå¯¸å¼€å§‹ï¼Œé€æ¸æŒ‘æˆ˜å¤§å°ºå¯¸æ–¹æ ¼</p>
                </div>
            `;
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        // æˆå°±ç³»ç»Ÿ
        const achievements = {
            firstBlood: { name: 'ç¬¬ä¸€æ»´è¡€', desc: 'å®Œæˆç¬¬ä¸€æ¬¡è®­ç»ƒ', icon: 'ğŸ†', unlocked: false },
            perfectShot: { name: 'å®Œç¾å°„æ‰‹', desc: 'å•æ¬¡è®­ç»ƒå‡†ç¡®ç‡100%', icon: 'ğŸ’', unlocked: false },
            speedDemon: { name: 'é€Ÿåº¦é­”ç‹', desc: 'å¹³å‡ååº”æ—¶é—´ä½äº300ms', icon: 'âš¡', unlocked: false },
            comboMaster: { name: 'è¿å‡»å¤§å¸ˆ', desc: 'å•æ¬¡è¿å‡»æ•°è¶…è¿‡20', icon: 'ğŸ”¥', unlocked: false },
            persistent: { name: 'æŒä¹‹ä»¥æ’', desc: 'ç´¯è®¡è®­ç»ƒ50æ¬¡', icon: 'ğŸ†', unlocked: false },
            sharpShooter: { name: 'ç¥å°„æ‰‹', desc: 'è¾¾åˆ°ç¥æªæ‰‹ç­‰çº§', icon: 'ğŸ¯', unlocked: false },
            nightOwl: { name: 'å¤œçŒ«å­', desc: 'æ™šä¸Š10ç‚¹åè®­ç»ƒ', icon: 'ğŸ¦‰', unlocked: false },
            earlyBird: { name: 'æ—©èµ·é¸Ÿå„¿', desc: 'æ—©ä¸Š6ç‚¹å‰è®­ç»ƒ', icon: 'ğŸ¦', unlocked: false }
        };
        
        // æ£€æŸ¥æˆå°±
        function checkAchievements(gameResult) {
            const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements') || '{}');
            const newlyUnlocked = [];
            
            // ç¬¬ä¸€æ¬¡è®­ç»ƒ
            if (!unlockedAchievements.firstBlood) {
                unlockedAchievements.firstBlood = true;
                newlyUnlocked.push('firstBlood');
            }
            
            // å®Œç¾å‡†ç¡®ç‡
            if (!unlockedAchievements.perfectShot && gameResult.accuracy === 100) {
                unlockedAchievements.perfectShot = true;
                newlyUnlocked.push('perfectShot');
            }
            
            // é€Ÿåº¦é­”ç‹
            if (!unlockedAchievements.speedDemon && gameResult.avgReaction < 300) {
                unlockedAchievements.speedDemon = true;
                newlyUnlocked.push('speedDemon');
            }
            
            // è¿å‡»å¤§å¸ˆ
            if (!unlockedAchievements.comboMaster && gameResult.maxCombo > 20) {
                unlockedAchievements.comboMaster = true;
                newlyUnlocked.push('comboMaster');
            }
            
            // ç¥å°„æ‰‹
            if (!unlockedAchievements.sharpShooter && gameResult.accuracy >= 90 && gameResult.avgReaction <= 400) {
                unlockedAchievements.sharpShooter = true;
                newlyUnlocked.push('sharpShooter');
            }
            
            // æ£€æŸ¥è®­ç»ƒæ¬¡æ•°
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            if (!unlockedAchievements.persistent && history.length >= 50) {
                unlockedAchievements.persistent = true;
                newlyUnlocked.push('persistent');
            }
            
            // æ£€æŸ¥æ—¶é—´æˆå°±
            const currentHour = new Date().getHours();
            if (!unlockedAchievements.nightOwl && currentHour >= 22) {
                unlockedAchievements.nightOwl = true;
                newlyUnlocked.push('nightOwl');
            }
            if (!unlockedAchievements.earlyBird && currentHour <= 6) {
                unlockedAchievements.earlyBird = true;
                newlyUnlocked.push('earlyBird');
            }
            
            localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
            
            // æ˜¾ç¤ºæ–°è§£é”çš„æˆå°±
            if (newlyUnlocked.length > 0) {
                showAchievements(newlyUnlocked);
            }
        }
        
        // æ˜¾ç¤ºæˆå°±å¼¹çª—
        function showAchievements(achievementIds) {
            achievementIds.forEach((id, index) => {
                setTimeout(() => {
                    const achievement = achievements[id];
                    const popup = document.createElement('div');
                    popup.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 20px;
                        border-radius: 15px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                        z-index: 1000;
                        min-width: 300px;
                        animation: slideIn 0.5s ease;
                        border: 2px solid #FFD700;
                    `;
                    
                    popup.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 10px;">${achievement.icon}</div>
                            <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px; color: #FFD700;">æˆå°±è§£é”ï¼</div>
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">${achievement.name}</div>
                            <div style="font-size: 14px; opacity: 0.9;">${achievement.desc}</div>
                        </div>
                    `;
                    
                    document.body.appendChild(popup);
                    
                    // æ’­æ”¾æˆå°±éŸ³æ•ˆ
                    playSound(880, 0.2);
                    setTimeout(() => playSound(1100, 0.2), 200);
                    setTimeout(() => playSound(1320, 0.3), 400);
                    
                    // 3ç§’åç§»é™¤å¼¹çª—
                    setTimeout(() => {
                        if (popup.parentNode) {
                            popup.remove();
                        }
                    }, 3000);
                }, index * 500); // å¤šä¸ªæˆå°±ä¾æ¬¡æ˜¾ç¤º
            });
        }
        
        // æ·»åŠ æ»‘å…¥åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // è¿½è¸ªè®­ç»ƒæ¨¡å¼åŠŸèƒ½
        const trackingDifficulties = {
            slow: { targetSize: 50, speed: 2, pattern: 'linear' },
            medium: { targetSize: 40, speed: 3, pattern: 'random' },
            fast: { targetSize: 30, speed: 4, pattern: 'change' }
        };
        
        function startTrackingGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // æ˜¾ç¤ºæ¸¸æˆç»Ÿè®¡å¤´éƒ¨
            document.getElementById('gameHeader').style.display = 'block';
            
            // åˆ›å»ºç§»åŠ¨ç›®æ ‡
            createTrackingTarget();
            
            // å¼€å§‹è®¡æ—¶å’Œç»Ÿè®¡æ›´æ–°
            gameState.trackingStartTime = Date.now();
            startTrackingTimer();
            startTrackingStatsUpdate();
        }
        
        function createTrackingTarget() {
            const gameArea = document.getElementById('gameArea');
            
            // ç¡®ä¿æ¸…ç†æ—§ç›®æ ‡
            if (gameState.trackingTarget) {
                gameState.trackingTarget.remove();
                gameState.trackingTarget = null;
            }
            
            const target = document.createElement('div');
            target.className = 'target tracking-target';
            
            const config = trackingDifficulties[gameState.difficulty];
            
            // è®¾ç½®ç›®æ ‡æ ·å¼
            target.style.cssText = `
                position: absolute;
                width: ${config.targetSize}px;
                height: ${config.targetSize}px;
                border-radius: 50%;
                background: radial-gradient(circle, #ff4757, #ff3742);
                border: 3px solid #fff;
                box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
                cursor: pointer;
                transition: all 0.1s ease;
                z-index: 10;
            `;
            
            // åˆå§‹ä½ç½®
            const margin = config.targetSize + 20;
            const x = Math.random() * (window.innerWidth - 2 * margin) + margin;
            const y = Math.random() * (window.innerHeight - 300) + 150;
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            // åˆå§‹ç§»åŠ¨æ–¹å‘
            target.vx = (Math.random() - 0.5) * config.speed * 2;
            target.vy = (Math.random() - 0.5) * config.speed * 2;
            
            // æ·»åŠ é¼ æ ‡äº‹ä»¶ç›‘å¬
            target.addEventListener('mouseenter', () => {
                if (gameState.gameActive) {
                    gameState.isTracking = true;
                    target.style.background = 'radial-gradient(circle, #00ff88, #00e676)';
                    target.style.boxShadow = '0 0 25px rgba(0, 255, 136, 0.8)';
                    if (gameState.soundEnabled) {
                        playSound(400, 0.1);
                    }
                }
            });
            
            target.addEventListener('mouseleave', () => {
                if (gameState.gameActive) {
                    gameState.isTracking = false;
                    target.style.background = 'radial-gradient(circle, #ff4757, #ff3742)';
                    target.style.boxShadow = '0 0 20px rgba(255, 71, 87, 0.6)';
                }
            });
            
            gameArea.appendChild(target);
            gameState.trackingTarget = target;
            
            console.log('è¿½è¸ªç›®æ ‡åˆ›å»ºå®Œæˆ');
            
            // å¼€å§‹ç§»åŠ¨ç›®æ ‡
            moveTrackingTarget();
        }
        
        function moveTrackingTarget() {
            if (!gameState.gameActive || !gameState.trackingTarget) return;
            
            const target = gameState.trackingTarget;
            const config = trackingDifficulties[gameState.difficulty];
            
            // è·å–å½“å‰ä½ç½®
            let x = parseFloat(target.style.left);
            let y = parseFloat(target.style.top);
            
            // è¾¹ç•Œæ£€æµ‹å’Œåå¼¹
            if (x <= 0 || x >= window.innerWidth - config.targetSize) {
                target.vx = -target.vx;
            }
            if (y <= 100 || y >= window.innerHeight - 100 - config.targetSize) {
                target.vy = -target.vy;
            }
            
            // æ ¹æ®éš¾åº¦æ¨¡å¼å¤„ç†ç›®æ ‡ç§»åŠ¨
            if (config.pattern === 'linear') {
                // æ…¢é€Ÿæ¨¡å¼ï¼šä¿æŒç›´çº¿ç§»åŠ¨ï¼Œåªåœ¨ç¢°åˆ°è¾¹ç•Œæ—¶æ”¹å˜æ–¹å‘
                // è¿™é‡Œä¸éœ€è¦é¢å¤–æ“ä½œï¼Œå› ä¸ºè¾¹ç•Œæ£€æµ‹å·²ç»å¤„ç†äº†æ–¹å‘å˜åŒ–
            } else if (config.pattern === 'random' && Math.random() < 0.02) {
                // ä¸­é€Ÿæ¨¡å¼ï¼šå¶å°”éšæœºæ”¹å˜æ–¹å‘
                target.vx = (Math.random() - 0.5) * config.speed * 2;
                target.vy = (Math.random() - 0.5) * config.speed * 2;
            } else if (config.pattern === 'change' && Math.random() < 0.05) {
                // å¿«é€Ÿæ¨¡å¼ï¼šé¢‘ç¹ä¸”æ›´å‰§çƒˆåœ°æ”¹å˜æ–¹å‘
                target.vx = (Math.random() - 0.5) * config.speed * 2;
                target.vy = (Math.random() - 0.5) * config.speed * 2;
            }
            
            // æ›´æ–°ä½ç½®
            x += target.vx;
            y += target.vy;
            
            // ç¡®ä¿åœ¨è¾¹ç•Œå†…
            x = Math.max(0, Math.min(window.innerWidth - config.targetSize, x));
            y = Math.max(100, Math.min(window.innerHeight - 100 - config.targetSize, y));
            
            target.style.left = x + 'px';
            target.style.top = y + 'px';
            
            // ç»§ç»­ç§»åŠ¨
            requestAnimationFrame(moveTrackingTarget);
        }
        
        function startTrackingTimer() {
            const timer = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(timer);
                    return;
                }
                
                gameState.gameTime--;
                document.getElementById('timeLeft').textContent = gameState.gameTime + 's';
                
                if (gameState.gameTime <= 0) {
                    clearInterval(timer);
                    endTrackingGame();
                }
            }, 1000);
        }
        
        function startTrackingStatsUpdate() {
            const updateInterval = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(updateInterval);
                    return;
                }
                
                // å¦‚æœé¼ æ ‡åœ¨ç›®æ ‡ä¸Šï¼Œå¢åŠ è¿½è¸ªæ—¶é—´å’Œå¾—åˆ†
                if (gameState.isTracking) {
                    gameState.trackingTime += 16; // çº¦60fpsï¼Œæ¯å¸§16ms
                    gameState.trackingScore += 1;
                    gameState.score += 1;
                }
                
                // è®¡ç®—è¿½è¸ªå‡†ç¡®ç‡
                const totalTime = Date.now() - gameState.trackingStartTime;
                gameState.trackingAccuracy = Math.round((gameState.trackingTime / totalTime) * 100);
                
                // æ›´æ–°æ˜¾ç¤º
                updateTrackingStats();
            }, 16); // çº¦60fps
        }
        
        function updateTrackingStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('accuracy').textContent = gameState.trackingAccuracy + '%';
            
            // ä½¿ç”¨è¿½è¸ªæ—¶é—´ä½œä¸º"ååº”æ—¶é—´"æ˜¾ç¤º
            const avgTrackingTime = gameState.trackingTime > 0 ? Math.round(gameState.trackingTime / 1000) : 0;
            document.getElementById('avgReaction').textContent = avgTrackingTime + 's';
            
            // è¿å‡»æ•°æ˜¾ç¤ºä¸ºè¿ç»­è¿½è¸ªæ—¶é—´
            const comboTime = gameState.isTracking ? Math.round(gameState.trackingTime / 100) / 10 : 0;
            document.getElementById('combo').textContent = comboTime + 's';
        }
        
        function endTrackingGame() {
            gameState.gameActive = false;
            
            if (gameState.trackingTarget) {
                gameState.trackingTarget.remove();
            }
            
            document.getElementById('gameHeader').style.display = 'none';
            showTrackingGameOverScreen();
        }
        
        function showTrackingGameOverScreen() {
            const totalTime = gameState.totalGameTime * 1000;
            const trackingAccuracy = Math.round((gameState.trackingTime / totalTime) * 100);
            const avgTrackingTime = Math.round(gameState.trackingTime / 1000 * 10) / 10;
            
            // è¯„ä¼°ç­‰çº§
            let rank = '';
            let rankColor = '';
            if (trackingAccuracy >= 80) {
                rank = 'è¿½è¸ªå¤§å¸ˆ ğŸ®';
                rankColor = '#FFD700';
            } else if (trackingAccuracy >= 60) {
                rank = 'è¿½è¸ªèƒ½æ‰‹ âš¡';
                rankColor = '#C0C0C0';
            } else if (trackingAccuracy >= 40) {
                rank = 'è¿½è¸ªæ–°æ‰‹ ğŸŒŸ';
                rankColor = '#CD7F32';
            } else {
                rank = 'éœ€è¦æ›´å¤šç»ƒä¹  ğŸ’ª';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">æ€»å¾—åˆ†: ${gameState.score}</div>
                        <div>è¿½è¸ªå‡†ç¡®ç‡: ${trackingAccuracy}%</div>
                        <div>è¿½è¸ªæ—¶é•¿: ${avgTrackingTime}ç§’</div>
                    </div>
                    <div>
                        <div>è®­ç»ƒæ—¶é•¿: ${gameState.totalGameTime}ç§’</div>
                        <div>éš¾åº¦: ${gameState.difficulty.toUpperCase()}</div>
                        <div>ç›®æ ‡å¤§å°: ${trackingDifficulties[gameState.difficulty].targetSize}px</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">è¿½è¸ªèƒ½åŠ›è¯„ä¼°:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${trackingAccuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>ğŸ’¡ æå‡å»ºè®®:</p>
                    ${trackingAccuracy < 50 ? '<p>â€¢ ä¸“æ³¨äºè·Ÿéšç›®æ ‡ä¸­å¿ƒï¼Œä¿æŒé¼ æ ‡ç¨³å®š</p>' : ''}
                    ${trackingAccuracy < 70 ? '<p>â€¢ é¢„æµ‹ç›®æ ‡ç§»åŠ¨è½¨è¿¹ï¼Œæå‰ç§»åŠ¨é¼ æ ‡</p>' : ''}
                    <p>â€¢ è¿½è¸ªè®­ç»ƒèƒ½æœ‰æ•ˆæå‡åŠ¨æ€è§†è§‰ååº”å’Œæ‰‹çœ¼åè°ƒèƒ½åŠ›</p>
                </div>
            `;
            
            // ä¿å­˜è®°å½•å¹¶æ£€æŸ¥æˆå°±
            saveBestRecord(trackingAccuracy, avgTrackingTime * 1000, gameState.score);
            checkAchievements({
                accuracy: trackingAccuracy,
                avgReaction: avgTrackingTime * 1000,
                score: gameState.score,
                maxCombo: Math.round(gameState.trackingTime / 1000)
            });
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // åºåˆ—è®­ç»ƒæ¨¡å¼åŠŸèƒ½
        const sequenceLengthSettings = {
            short: { minLength: 3, maxLength: 4 },
            medium: { minLength: 5, maxLength: 6 },
            long: { minLength: 7, maxLength: 8 },
            ultra: { minLength: 9, maxLength: 10 }
        };
        
        const sequenceSpeedSettings = {
            slow: { displayTime: 1200, interval: 400 },
            medium: { displayTime: 800, interval: 200 },
            fast: { displayTime: 500, interval: 150 },
            ultra: { displayTime: 300, interval: 100 }
        };
        
        // ä¸ºäº†å…¼å®¹æ€§ä¿ç•™æ—§çš„é…ç½®
        const sequenceDifficulties = {
            long: { minLength: 7, maxLength: 8, displayTime: 800, interval: 200 }
        };
        
        function startSequenceGame() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            
            // åˆ›å»ºåºåˆ—ä¿¡æ¯é¢æ¿
            const infoPanel = document.createElement('div');
            infoPanel.className = 'schulte-info';
            infoPanel.innerHTML = `
                <div class="schulte-current-number">è½®æ¬¡: <span id="currentRound">1</span>/${gameState.sequenceRounds}</div>
                <div class="schulte-stats">å¾—åˆ†: <span id="sequenceScore">0</span> | å‡†ç¡®ç‡: <span id="sequenceAccuracy">100%</span></div>
                <div style="margin-top: 10px; font-size: 14px; opacity: 0.8;" id="sequenceInstruction">å‡†å¤‡å¼€å§‹...</div>
            `;
            gameArea.appendChild(infoPanel);
            
            // å¼€å§‹ç¬¬ä¸€è½®
            setTimeout(() => startSequenceRound(), 1000);
        }
        
        function startSequenceRound() {
            // å…ˆé€’å¢è½®æ¬¡è®¡æ•°
            gameState.currentRound++;
            
            console.log('å¼€å§‹æ–°ä¸€è½®åºåˆ—è®­ç»ƒ:', gameState.currentRound, '/', gameState.sequenceRounds);
            
            if (gameState.currentRound > gameState.sequenceRounds) {
                console.log('æ‰€æœ‰è½®æ¬¡å®Œæˆï¼Œç»“æŸæ¸¸æˆ');
                endSequenceGame();
                return;
            }
            
            // é‡ç½®å½“å‰è½®æ¬¡çš„çŠ¶æ€
            gameState.currentSequence = [];
            gameState.playerSequence = [];
            gameState.sequenceIndex = 0;
            gameState.isShowingSequence = true;
            gameState.isPlayerTurn = false;
            
            console.log('å½“å‰è½®æ¬¡è®¾ç½®ä¸º:', gameState.currentRound);
            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('sequenceInstruction').textContent = 'è§‚å¯Ÿåºåˆ—...';
            
            // è·å–ç”¨æˆ·è®¾ç½®
            const lengthSetting = document.getElementById('sequence-length').value;
            const speedSetting = document.getElementById('sequence-speed').value;
            console.log('ç”¨æˆ·è®¾ç½® - é•¿åº¦:', lengthSetting, 'é€Ÿåº¦:', speedSetting);
            
            // è·å–åºåˆ—é•¿åº¦é…ç½®
            const lengthConfig = sequenceLengthSettings[lengthSetting];
            const sequenceLength = Math.floor(Math.random() * (lengthConfig.maxLength - lengthConfig.minLength + 1)) + lengthConfig.minLength;
            console.log('ç”Ÿæˆåºåˆ—é•¿åº¦:', sequenceLength);
            
            // ä¿å­˜å½“å‰è®¾ç½®ä¾›åç»­ä½¿ç”¨
            gameState.currentLengthConfig = lengthConfig;
            gameState.currentSpeedConfig = sequenceSpeedSettings[speedSetting];
            console.log('ä¿å­˜çš„é€Ÿåº¦é…ç½®:', gameState.currentSpeedConfig);
            
            // åˆ›å»ºç›®æ ‡ä½ç½®
            createSequenceTargets();
            
            // ç”Ÿæˆåºåˆ—
            for (let i = 0; i < sequenceLength; i++) {
                gameState.currentSequence.push(Math.floor(Math.random() * 9)); // 0-8å¯¹åº”9ä¸ªä½ç½®
            }
            console.log('ç”Ÿæˆçš„åºåˆ—:', gameState.currentSequence);
            
            // æ˜¾ç¤ºåºåˆ—
            console.log('å‡†å¤‡æ˜¾ç¤ºåºåˆ—ï¼Œ500msåå¼€å§‹');
            setTimeout(() => {
                console.log('å¼€å§‹æ˜¾ç¤ºåºåˆ—æ­¥éª¤');
                showSequenceStep();
            }, 500);
        }
        
        function createSequenceTargets() {
            const gameArea = document.getElementById('gameArea');
            
            // æ¸…é™¤æ—§çš„ç›®æ ‡
            const oldTargets = gameArea.querySelectorAll('.sequence-target');
            oldTargets.forEach(target => target.remove());
            
            // é‡ç½®ç›®æ ‡æ•°ç»„
            gameState.sequenceTargets = [];
            
            // åˆ›å»º3x3ç½‘æ ¼çš„ç›®æ ‡
            for (let i = 0; i < 9; i++) {
                const target = document.createElement('div');
                target.className = 'sequence-target';
                target.dataset.index = i;
                
                // è®¡ç®—ä½ç½®ï¼ˆ3x3ç½‘æ ¼ï¼‰
                const row = Math.floor(i / 3);
                const col = i % 3;
                const size = 60;
                const spacing = 100;
                const startX = window.innerWidth / 2 - spacing;
                const startY = window.innerHeight / 2 - spacing;
                
                target.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${startX + col * spacing}px;
                    top: ${startY + row * spacing}px;
                    background: linear-gradient(135deg, #2c3e50, #34495e);
                    border: 2px solid rgba(255,255,255,0.3);
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                    color: white;
                    font-weight: bold;
                    z-index: 10;
                `;
                
                target.textContent = i + 1;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                target.addEventListener('click', () => handleSequenceClick(i));
                
                gameArea.appendChild(target);
                gameState.sequenceTargets.push(target);
            }
            
            console.log('åºåˆ—ç›®æ ‡åˆ›å»ºå®Œæˆ:', gameState.sequenceTargets.length);
        }
        
        function showSequenceStep() {
            if (!gameState.gameActive || !gameState.isShowingSequence) {
                console.log('showSequenceStep stopped - gameActive:', gameState.gameActive, 'isShowingSequence:', gameState.isShowingSequence);
                return;
            }
            
            // ä½¿ç”¨æ–°çš„é€Ÿåº¦é…ç½®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤
            const speedConfig = gameState.currentSpeedConfig || { displayTime: 800, interval: 200 };
            console.log('ä½¿ç”¨é€Ÿåº¦é…ç½®:', speedConfig);
            
            if (gameState.sequenceIndex < gameState.currentSequence.length) {
                const targetIndex = gameState.currentSequence[gameState.sequenceIndex];
                const target = gameState.sequenceTargets[targetIndex];
                
                console.log('æ˜¾ç¤ºåºåˆ—æ­¥éª¤:', gameState.sequenceIndex, 'ç›®æ ‡ç´¢å¼•:', targetIndex, 'ç›®æ ‡å­˜åœ¨:', !!target);
                
                if (!target) {
                    console.error('ç›®æ ‡ä¸å­˜åœ¨! targetIndex:', targetIndex, 'sequenceTargets:', gameState.sequenceTargets);
                    return;
                }
                
                // é«˜äº®ç›®æ ‡
                target.style.background = 'linear-gradient(135deg, #00ff88, #00e676)';
                target.style.borderColor = '#00ff88';
                target.style.transform = 'scale(1.2)';
                
                playSound(600 + (gameState.sequenceIndex * 100), 0.2);
                
                // æ˜¾ç¤ºæ—¶é—´åæ¢å¤
                setTimeout(() => {
                    if (!gameState.gameActive || !gameState.isShowingSequence) {
                        console.log('æ¸¸æˆçŠ¶æ€å·²æ”¹å˜ï¼Œåœæ­¢åºåˆ—æ˜¾ç¤º');
                        return;
                    }
                    
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                    target.style.transform = 'scale(1)';
                    
                    gameState.sequenceIndex++;
                    console.log('åºåˆ—ç´¢å¼•å¢åŠ åˆ°:', gameState.sequenceIndex);
                    
                    // ç»§ç»­ä¸‹ä¸€ä¸ªæˆ–å¼€å§‹ç©å®¶å›åˆ
                    setTimeout(() => {
                        if (gameState.sequenceIndex < gameState.currentSequence.length) {
                            console.log('ç»§ç»­ä¸‹ä¸€ä¸ªåºåˆ—æ­¥éª¤');
                            showSequenceStep();
                        } else {
                            console.log('åºåˆ—æ˜¾ç¤ºå®Œæˆï¼Œå¼€å§‹ç©å®¶å›åˆ');
                            startPlayerTurn();
                        }
                    }, speedConfig.interval);
                }, speedConfig.displayTime);
            } else {
                console.log('åºåˆ—ç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œå¼€å§‹ç©å®¶å›åˆ');
                startPlayerTurn();
            }
        }
        
        function startPlayerTurn() {
            gameState.isShowingSequence = false;
            gameState.isPlayerTurn = true;
            gameState.sequenceIndex = 0;
            
            document.getElementById('sequenceInstruction').textContent = 'è¯·æŒ‰é¡ºåºç‚¹å‡»ç›®æ ‡...';
        }
        
        function handleSequenceClick(targetIndex) {
            if (!gameState.gameActive || !gameState.isPlayerTurn) return;
            
            const target = gameState.sequenceTargets[targetIndex];
            
            if (targetIndex === gameState.currentSequence[gameState.sequenceIndex]) {
                // æ­£ç¡®ç‚¹å‡»
                target.style.background = 'linear-gradient(135deg, #00ff88, #00e676)';
                target.style.borderColor = '#00ff88';
                
                gameState.playerSequence.push(targetIndex);
                gameState.sequenceIndex++;
                gameState.hits++;
                gameState.score += 10;
                
                playSound(700, 0.1);
                
                setTimeout(() => {
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                }, 200);
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆåºåˆ—
                if (gameState.sequenceIndex >= gameState.currentSequence.length) {
                    gameState.combo++;
                    gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
                    setTimeout(() => {
                        document.getElementById('sequenceInstruction').textContent = 'æ­£ç¡®ï¼å‡†å¤‡ä¸‹ä¸€è½®...';
                        setTimeout(() => startSequenceRound(), 1500);
                    }, 500);
                }
            } else {
                // é”™è¯¯ç‚¹å‡»
                target.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                target.style.borderColor = '#ff4757';
                
                gameState.misses++;
                gameState.combo = 0;
                playSound(200, 0.3);
                
                setTimeout(() => {
                    target.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                    target.style.borderColor = 'rgba(255,255,255,0.3)';
                    
                    document.getElementById('sequenceInstruction').textContent = 'é”™è¯¯ï¼é‡æ–°å¼€å§‹è¿™ä¸€è½®...';
                    // é”™è¯¯æ—¶é‡æ–°å¼€å§‹å½“å‰è½®æ¬¡ï¼Œéœ€è¦å…ˆå‡å»è½®æ¬¡è®¡æ•°
                    setTimeout(() => {
                        gameState.currentRound--; // æ¢å¤åˆ°å½“å‰è½®æ¬¡
                        startSequenceRound();
                    }, 1500);
                }, 200);
            }
            
            gameState.totalClicks++;
            updateSequenceStats();
        }
        
        function updateSequenceStats() {
            document.getElementById('sequenceScore').textContent = gameState.score;
            
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 100;
            document.getElementById('sequenceAccuracy').textContent = accuracy + '%';
        }
        
        function endSequenceGame() {
            gameState.gameActive = false;
            showSequenceGameOverScreen();
        }
        
        function showSequenceGameOverScreen() {
            const accuracy = gameState.totalClicks > 0 ? 
                Math.round((gameState.hits / gameState.totalClicks) * 100) : 0;
            const avgReaction = gameState.reactionTimes.length > 0 ?
                Math.round(gameState.reactionTimes.reduce((a, b) => a + b, 0) / gameState.reactionTimes.length) : 0;
            
            // è¯„ä¼°ç­‰çº§
            let rank = '';
            let rankColor = '';
            if (accuracy >= 90 && gameState.combo >= gameState.sequenceRounds * 0.8) {
                rank = 'è®°å¿†å¤§å¸ˆ ğŸ§ ';
                rankColor = '#FFD700';
            } else if (accuracy >= 75 && gameState.combo >= gameState.sequenceRounds * 0.6) {
                rank = 'åºåˆ—ä¸“å®¶ âš¡';
                rankColor = '#C0C0C0';
            } else if (accuracy >= 60) {
                rank = 'è®°å¿†æ–°æ‰‹ ğŸŒŸ';
                rankColor = '#CD7F32';
            } else {
                rank = 'éœ€è¦æ›´å¤šç»ƒä¹  ğŸ’ª';
                rankColor = '#FF6B6B';
            }
            
            document.getElementById('finalStats').innerHTML = `
                <h3 style="color: ${rankColor}; margin-bottom: 20px;">${rank}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="color: #00ff88;">æ€»å¾—åˆ†: ${gameState.score}</div>
                        <div>å®Œæˆè½®æ¬¡: ${gameState.currentRound}/${gameState.sequenceRounds}</div>
                        <div>è®°å¿†å‡†ç¡®ç‡: ${accuracy}%</div>
                    </div>
                    <div>
                        <div>è¿ç»­æ­£ç¡®: ${gameState.maxCombo}è½®</div>
                        <div>éš¾åº¦: ${gameState.difficulty.toUpperCase()}</div>
                        <div>æ€»ç‚¹å‡»: ${gameState.totalClicks}æ¬¡</div>
                    </div>
                </div>
                
                <div>
                    <div style="margin: 10px 0;">è®°å¿†èƒ½åŠ›è¯„ä¼°:</div>
                    <div class="accuracy-bar">
                        <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                    <p>ğŸ’¡ æå‡å»ºè®®:</p>
                    ${accuracy < 70 ? '<p>â€¢ ä¸“æ³¨è§‚å¯Ÿåºåˆ—ï¼Œå¯ä»¥åœ¨è„‘ä¸­é‡å¤ç›®æ ‡ä½ç½®</p>' : ''}
                    ${gameState.maxCombo < gameState.sequenceRounds * 0.5 ? '<p>â€¢ å°è¯•å°†åºåˆ—ç¼–ç ä¸ºè®°å¿†è·¯å¾„æˆ–æ•…äº‹</p>' : ''}
                    <p>â€¢ åºåˆ—è®­ç»ƒèƒ½æœ‰æ•ˆæå‡å·¥ä½œè®°å¿†å’Œæ³¨æ„åŠ›</p>
                </div>
            `;
            
            // ä¿å­˜è®°å½•å¹¶æ£€æŸ¥æˆå°±
            saveBestRecord(accuracy, avgReaction || 1000, gameState.score);
            checkAchievements({
                accuracy: accuracy,
                avgReaction: avgReaction || 1000,
                score: gameState.score,
                maxCombo: gameState.maxCombo
            });
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // é˜²æ­¢å³é”®èœå•
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // ä¿¡æ¯å¼¹çª—åŠŸèƒ½
        const infoModalContent = {
            about: {
                title: 'ğŸ¢ å…³äºæˆ‘ä»¬',
                content: `
                    <h3>ğŸ† äº§å“ä»‹ç»</h3>
                    <p>ç²¾å‡†ç‚¹å‡»è®­ç»ƒå™¨æ˜¯ä¸€æ¬¾ä¸“ä¸šçº§çš„ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦è®­ç»ƒå¹³å°ï¼Œä¸ºç”¨æˆ·æä¾›å¤šç»´åº¦çš„è®¤çŸ¥è®­ç»ƒä½“éªŒã€‚</p>
                    
                    <h3>ğŸ¯ åŠŸèƒ½ç‰¹è‰²</h3>
                    <ul>
                        <li>ğŸ¯ ååº”é€Ÿåº¦è®­ç»ƒ - æå‡ç‚¹å‡»ååº”å’Œç›®æ ‡è¯†åˆ«èƒ½åŠ›</li>
                        <li>ğŸ® è¿½è¸ªè®­ç»ƒ - å¢å¼ºåŠ¨æ€è§†è§‰è·Ÿè¸ªåŠæ‰‹çœ¼åè°ƒ</li>
                        <li>ğŸ”¢ åºåˆ—è®­ç»ƒ - è®­ç»ƒå·¥ä½œè®°å¿†å’Œåºåˆ—å¤„ç†èƒ½åŠ›</li>
                        <li>ğŸ§  èˆ’å°”ç‰¹æ–¹æ ¼ - æå‡æ³¨æ„åŠ›é›†ä¸­å’Œè§†è§‰æœç´¢</li>
                    </ul>
                    
                    <h3>ğŸ“Š ç§‘å­¦ä¾æ®</h3>
                    <p>æˆ‘ä»¬çš„è®­ç»ƒæ–¹æ³•åŸºäºè®¤çŸ¥ç¥ç»ç§‘å­¦çš„ç ”ç©¶æˆæœï¼Œé’ˆå¯¹ä¸åŒçš„è®¤çŸ¥èƒ½åŠ›è¿›è¡Œé’ˆå¯¹æ€§è®­ç»ƒï¼Œå¸®åŠ©ç”¨æˆ·åœ¨æ—¥å¸¸ç”Ÿæ´»å’Œå·¥ä½œä¸­å–å¾—æ›´å¥½çš„è¡¨ç°ã€‚</p>
                    
                    <h3>ğŸ“… ç‰ˆæœ¬ä¿¡æ¯</h3>
                    <p>å½“å‰ç‰ˆæœ¬ï¼šv2.1.0 | æ›´æ–°æ—¥æœŸï¼š2024å¹´12æœˆ</p>
                `
            },
            xpro: {
                title: 'ğŸ–±ï¸ Xâ€‘Pro æ¨è',
                content: `
                    <h3>Xâ€‘Pro é«˜ç²¾åº¦æ¸¸æˆé¼ æ ‡</h3>
                    <p>Xâ€‘Pro æä¾›ç¨³å®šçš„å®šä½ç²¾åº¦å’Œä½å»¶è¿Ÿä¼ æ„Ÿå™¨ï¼Œé€‚åˆè¿½è¸ªä¸å¿«é€Ÿç‚¹å°„è®­ç»ƒã€‚ä¸»è¦ç‰¹ç‚¹ï¼š</p>
                    <ul>
                        <li>é«˜ç²¾åº¦å…‰å­¦ä¼ æ„Ÿå™¨ï¼ˆå¯è°ƒ DPIï¼‰</li>
                        <li>ä½å»¶è¿Ÿå¾®åŠ¨å¼€å…³</li>
                        <li>äººä½“å·¥å­¦è®¾è®¡ä¸è½»é‡åŒ–å¤–å£³</li>
                        <li>å¯è‡ªå®šä¹‰æŒ‰é”®ä¸é…ç½®ä¿å­˜</li>
                    </ul>
                    <p style="margin-top:10px;">è´­ä¹°ä¸æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®åˆ¶é€ å•†é¡µé¢æˆ–åœ¨æœ¬åœ°æ¸ é“æœç´¢å‹å· <strong>Xâ€‘Pro</strong>ã€‚</p>
                    <div style="text-align:center; margin-top:12px;">
                        <button class="btn" onclick="closeInfoModal()">å…³é—­</button>
                    </div>
                `
            },
            contact: {
                title: 'ğŸ“ è”ç³»æˆ‘ä»¬',
                content: `
                    <h3>ğŸ“§ è”ç³»æ–¹å¼</h3>
                    <p>å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–å¯¹äº§å“æœ‰ä»»ä½•å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡é‚®ç®±è”ç³»æˆ‘ä»¬ï¼š</p>
                    
                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: rgba(0,255,136,0.1); border-radius: 15px; border: 2px solid rgba(0,255,136,0.3);">
                        <h3 style="color: #00ff88; margin-bottom: 10px;">ğŸ“§ é‚®ç®±åœ°å€</h3>
                        <p style="font-size: 18px; font-weight: bold; color: #00ff88;">lujinfen783@gmail.com</p>
                    </div>
                    
                    <h3>ğŸ’¬ åé¦ˆå»ºè®®</h3>
                    <p>æ‚¨çš„æ„è§å’Œå»ºè®®å¯¹æˆ‘ä»¬éå¸¸é‡è¦ï¼è¯·éšæ—¶é€šè¿‡é‚®ç®±å‘æˆ‘ä»¬åé¦ˆäº§å“ä½¿ç”¨ä½“éªŒï¼Œå¸®åŠ©æˆ‘ä»¬æŒç»­æ”¹è¿›å’Œä¼˜åŒ–äº§å“ã€‚</p>
                    
                    <p style="margin-top: 20px; font-size: 12px; opacity: 0.7; text-align: center;">
                        æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨çš„é‚®ä»¶å’¨è¯¢
                    </p>
                `
            },
            privacy: {
                title: 'ğŸ”’ éšç§æ”¿ç­–',
                content: `
                    <h3>ğŸ“Š æ•°æ®æ”¶é›†</h3>
                    <p>æˆ‘ä»¬ä»…æ”¶é›†æ‚¨çš„è®­ç»ƒæ•°æ®ç”¨äºæ¸¸æˆä½“éªŒä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š</p>
                    <ul>
                        <li>è®­ç»ƒæˆç»©å’Œè¿›åº¦è®°å½•</li>
                        <li>è®¾ç½®åå¥½å’Œéš¾åº¦é€‰æ‹©</li>
                        <li>æˆå°±è§£é”å’Œå†å²è®°å½•</li>
                    </ul>
                    
                    <h3>ğŸ’¾ æ•°æ®å­˜å‚¨</h3>
                    <p>æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨æ‚¨çš„æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ è‡³ä»»ä½•æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥éšæ—¶æ¸…é™¤æµè§ˆå™¨æ•°æ®æ¥åˆ é™¤è¿™äº›ä¿¡æ¯ã€‚</p>
                    
                    <h3>ğŸš« ä¸æ”¶é›†çš„ä¿¡æ¯</h3>
                    <p>æˆ‘ä»¬ä¸ä¼šæ”¶é›†ï¼š</p>
                    <ul>
                        <li>ä¸ªäººèº«ä»½ä¿¡æ¯ï¼ˆå§“åã€èº«ä»½è¯å·ç­‰ï¼‰</li>
                        <li>è”ç³»æ–¹å¼ï¼ˆç”µè¯ã€é‚®ç®±ç­‰ï¼‰</li>
                        <li>ä½ç½®ä¿¡æ¯</li>
                        <li>è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦</li>
                    </ul>
                    
                    <h3>ğŸ›¡ï¸ æ•°æ®å®‰å…¨</h3>
                    <p>æˆ‘ä»¬é‡‡ç”¨å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ä¿æŠ¤æ‚¨çš„æ•°æ®å®‰å…¨ï¼Œå¹¶ä¸¥æ ¼éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚</p>
                    
                    <h3>ğŸ“… æ”¿ç­–æ›´æ–°</h3>
                    <p>æœ¬éšç§æ”¿ç­–å¯èƒ½ä¼šä¸å®šæœŸæ›´æ–°ï¼Œæ›´æ–°åä¼šåœ¨æ¸¸æˆä¸­æ˜¾ç¤ºé€šçŸ¥ã€‚æœ€åæ›´æ–°æ—¥æœŸï¼š2024å¹´12æœˆã€‚</p>
                `
            },
            disclaimer: {
                title: 'âš ï¸ å…è´£å£°æ˜',
                content: `
                    <h3>ğŸ¯ äº§å“ç”¨é€”</h3>
                    <p>ç²¾å‡†ç‚¹å‡»è®­ç»ƒå™¨ä»…ä¾›å¨±ä¹å’Œè®¤çŸ¥è®­ç»ƒä½¿ç”¨ï¼Œä¸åº”ç”¨äºåŒ»ç–—è¯Šæ–­ã€æ²»ç–—æˆ–ä»»ä½•åŒ»å­¦ç›®çš„ã€‚</p>
                    
                    <h3>ğŸ“Š è®­ç»ƒæ•ˆæœ</h3>
                    <p>è®­ç»ƒæ•ˆæœå› äººè€Œå¼‚ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯ä»»ä½•ç‰¹å®šçš„è®­ç»ƒæ•ˆæœæˆ–æ”¹å–„ç¨‹åº¦ã€‚è¯·ä»¥ç§‘å­¦çš„æ€åº¦å¯¹å¾…è®­ç»ƒæˆæœã€‚</p>
                    
                    <h3>âš ï¸ å¥åº·æç¤º</h3>
                    <ul>
                        <li>è¯·é€‚åº¦ä½¿ç”¨ï¼Œé¿å…é•¿æ—¶é—´è¿ç»­è®­ç»ƒ</li>
                        <li>å¦‚æ„Ÿåˆ°çœ¼éƒ¨ç–²åŠ³æˆ–ä¸é€‚ï¼Œè¯·ç«‹å³åœæ­¢ä½¿ç”¨</li>
                        <li>æœ‰ç›¸å…³ç–¾ç—…è€…è¯·åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ä½¿ç”¨</li>
                        <li>è¯·åœ¨å…‰çº¿é€‚å®œã€ç¯å¢ƒå®‰å…¨çš„åœ°æ–¹ä½¿ç”¨</li>
                    </ul>
                    
                    <h3>ğŸ“œ æŠ€æœ¯æ”¯æŒ</h3>
                    <p>æœ¬äº§å“åŸºäºWebæŠ€æœ¯å¼€å‘ï¼Œå¯èƒ½åœ¨ä¸åŒè®¾å¤‡å’Œæµè§ˆå™¨ä¸Šè¡¨ç°ä¸åŒã€‚æˆ‘ä»¬ä¸å¯¹ç”±æ­¤å¼•èµ·çš„æŠ€æœ¯é—®é¢˜æ‰¿æ‹…è´£ä»»ã€‚</p>
                    
                    <h3>ğŸ“… æ³•å¾‹å£°æ˜</h3>
                    <p>åœ¨æ³•å¾‹å…è®¸çš„æœ€å¤§èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯¹å› ä½¿ç”¨æœ¬äº§å“è€Œäº§ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±ä¸æ‰¿æ‹…è´£ä»»ã€‚</p>
                    
                    <p style="margin-top: 20px; font-size: 12px; opacity: 0.7; text-align: center;">
                        æœ€åæ›´æ–°æ—¥æœŸï¼š2024å¹´12æœˆ | ç‰ˆæœ¬ï¼šv2.1.0
                    </p>
                `
            }
            ,
            features: {
                title: 'ğŸš€ æ ¸å¿ƒä¼˜åŠ¿ & è®­ç»ƒä½“ç³»',
                content: `
                    <h3>ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿</h3>
                    <ul>
                        <li><strong>æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ</strong>ï¼šAIé©±åŠ¨çš„åŠ¨æ€éš¾åº¦è°ƒæ•´ã€å®æ—¶è¿½è¸ªä¸åˆ†æã€ä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’</li>
                        <li><strong>ç«æŠ€æ’è¡Œæ¦œ</strong>ï¼šå…¨çƒç©å®¶å®æ—¶æ’åã€å†å²æœ€ä½³è®°å½•è¿½è¸ªã€å‘¨/æœˆå† å†›æ¦œã€å¥½å‹æŒ‘æˆ˜åŠŸèƒ½</li>
                        <li><strong>è¿›é˜¶ç³»ç»Ÿ</strong>ï¼šç§‘å­¦æŠ€èƒ½è¯„ä¼°ã€é˜¶æ®µæ€§è®­ç»ƒç›®æ ‡ã€æˆå°±å¾½ç« ç³»ç»Ÿã€è§†è§‰åŒ–è¿›åº¦è¿½è¸ª</li>
                    </ul>

                    <h3>ğŸ“Š è®­ç»ƒç³»ç»Ÿ</h3>
                    <h4>ğŸ‘¶ å…¥é—¨çº§åˆ« â€” "3å¤©å¿«é€Ÿå…¥é—¨è®¡åˆ’"</h4>
                    <ul>
                        <li>æŒæ¡åŸºæœ¬å®šä½æŠ€å·§</li>
                        <li>å»ºç«‹æ­£ç¡®çš„è®­ç»ƒèŠ‚å¥</li>
                        <li>é¦–æ¬¡å®Œæˆ5Ã—5æŒ‘æˆ˜</li>
                        <li>äº†è§£è®­ç»ƒåŸç†ä¸æ–¹æ³•</li>
                    </ul>

                    <h4>âš¡ è¿›é˜¶è®­ç»ƒ</h4>
                    <ul>
                        <li>å¹²æ‰°æ¨¡å¼è®­ç»ƒï¼ˆè‰²å—ã€æ–‡å­—ï¼‰</li>
                        <li>ç¬æ—¶è®°å¿†æŒ‘æˆ˜ï¼ˆæ•°å­—é—ªç°ï¼‰</li>
                        <li>å¤šç»´æ•°æ®åˆ†æï¼ˆååº”æ—¶é—´ã€å‡†ç¡®ç‡ï¼‰</li>
                        <li>æ—¶é—´å‹åŠ›æ¨¡å¼</li>
                    </ul>

                    <h4>ğŸ“ ä¸“å®¶æŒ‡å¯¼</h4>
                    <ul>
                        <li>åº”ç”¨ç¥ç»å¯å¡‘æ€§åŸç†</li>
                        <li>å®šåˆ¶è®­ç»ƒè®¡åˆ’</li>
                        <li>ä¸“ä¸šæ•°æ®åˆ†ææŠ¥å‘Š</li>
                        <li>è®¤çŸ¥èƒ½åŠ›å‘å±•è¶‹åŠ¿åˆ†æ</li>
                    </ul>
                `
            }
        };
        
        function showInfoModal(type) {
            const modal = document.getElementById('infoModal');
            const title = document.getElementById('infoModalTitle');
            const body = document.getElementById('infoModalBody');
            
            if (infoModalContent[type]) {
                title.textContent = infoModalContent[type].title;
                body.innerHTML = infoModalContent[type].content;
                modal.style.display = 'flex';
                
                // æ’­æ”¾å¼¹çª—æ‰“å¼€éŸ³æ•ˆ
                if (gameState.soundEnabled) {
                    playSound(800, 0.1);
                }
            }
        }
        
        function closeInfoModal() {
            const modal = document.getElementById('infoModal');
            modal.style.display = 'none';
            
            // æ’­æ”¾å¼¹çª—å…³é—­éŸ³æ•ˆ
            if (gameState.soundEnabled) {
                playSound(600, 0.1);
            }
        }

        function showXProInfo() {
            showInfoModal('xpro');
        }
        
        // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­å¼¹çª—
        document.getElementById('infoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeInfoModal();
            }
        });
        
        // ESC é”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const infoModal = document.getElementById('infoModal');
                const purchaseModal = document.getElementById('purchaseModal');
                
                if (infoModal.style.display === 'flex') {
                    closeInfoModal();
                }
                
                if (purchaseModal.style.display === 'flex') {
                    closePurchaseModal();
                }
            }
        });
        
        // VIPä¼šå‘˜ç³»ç»ŸåŠŸèƒ½
        let vipStatus = {
            isVIP: false,
            plan: null,
            expiryDate: null,
            features: {
                removeAds: false,
                premiumModes: false,
                detailedStats: false
            }
        };
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½VIPçŠ¶æ€
        function loadVIPStatus() {
            const savedVIP = JSON.parse(localStorage.getItem('vipStatus') || '{}');
            if (savedVIP.isVIP) {
                // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                if (savedVIP.expiryDate && new Date(savedVIP.expiryDate) > new Date()) {
                    vipStatus = savedVIP;
                    updateVIPUI();
                } else if (savedVIP.plan === 'lifetime') {
                    // ç»ˆèº«VIPæ°¸ä¸è¿‡æœŸ
                    vipStatus = savedVIP;
                    updateVIPUI();
                } else {
                    // VIPå·²è¿‡æœŸ
                    resetVIPStatus();
                }
            }
        }

    // VIP/è´¦æˆ·/æ”¯ä»˜åŠŸèƒ½å·²å–æ¶ˆï¼ŒAPI ä¸å¯ç”¨
    // VIP/è´¦æˆ·/æ”¯ä»˜å·²å–æ¶ˆï¼šä¿ç•™æœ€å° vipStatus å¯¹è±¡ä¸å®‰å…¨çš„ no-op æ¥å£ï¼Œé¿å…å¼•ç”¨é”™è¯¯
    const API_BASE_URL = '';

    function resetVIPStatus() {
        vipStatus = { isVIP: false, plan: null, expiryDate: null, features: {} };
        localStorage.setItem('vipStatus', JSON.stringify(vipStatus));
        updateVIPUI();
    }

    function updateVIPUI() {
        const vipStatusElement = document.getElementById('vipStatus');
        if (!vipStatusElement) return;
        if (vipStatus.isVIP) vipStatusElement.classList.add('show');
        else vipStatusElement.classList.remove('show');
    }

    function showPurchaseModal() { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }
    function closePurchaseModal() { /* noop */ }
    function openPaymentPanel() { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }
    function closePaymentPanel() { /* noop */ }
    function selectPlan(plan) { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }
    function initiatePayment(plan) { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }
    // æ”¯ä»˜é€»è¾‘å·²ç§»é™¤ï¼Œä¿ç•™æ¥å£ä¸º no-op
        
        // æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸæç¤º
        function showSuccessMessage(plan) {
            // åˆ›å»ºæˆåŠŸæç¤º
            const successMsg = document.createElement('div');
            successMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #00ff88, #00e676);
                color: #1a1a1a;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                font-weight: bold;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                z-index: 2000;
                animation: bounceIn 0.5s;
            `;
            
            let planName = 'æœˆåº¦å»å¹¿å‘Šè®¢é˜…';
            if (plan === 'yearly') planName = 'å¹´åº¦ï¼ˆæš‚ä¸å¯ç”¨ï¼‰';
            if (plan === 'lifetime') planName = 'ç»ˆèº«ï¼ˆæš‚ä¸å¯ç”¨ï¼‰';
            
            successMsg.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 20px;">âœ…</div>
                <div style="font-size: 24px; margin-bottom: 10px;">æ”¯ä»˜æˆåŠŸï¼</div>
                <div style="font-size: 18px;">æ‚¨å·²æˆåŠŸå‡çº§ä¸º${planName}VIPä¼šå‘˜</div>
            `;
            
            document.body.appendChild(successMsg);
            
            // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
            playSound(880, 0.2);
            setTimeout(() => playSound(1100, 0.2), 200);
            setTimeout(() => playSound(1320, 0.3), 400);
            
            // 3ç§’åç§»é™¤æç¤º
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }
        
        // éšè—æ‰€æœ‰å¹¿å‘Š
        function hideAllAds() {
            const adElements = document.querySelectorAll('.ad-banner');
            adElements.forEach(ad => {
                ad.style.display = 'none';
            });
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰å¹¿å‘Š
        function showAllAds() {
            const adElements = document.querySelectorAll('.ad-banner');
            adElements.forEach(ad => {
                // å¦‚æœå¹¿å‘Šæ²¡æœ‰å…¶ä»–åŸå› éœ€è¦éšè—ï¼Œåˆ™æ˜¾ç¤º
                if (ad.id !== 'gameEndAd') {
                    ad.style.display = 'flex';
                }
            });
        }
        
        // è§£é”ä»˜è´¹åŠŸèƒ½
        function unlockPremiumFeatures() {
            const premiumFeatures = document.querySelectorAll('.premium-feature');
            premiumFeatures.forEach(feature => {
                feature.classList.add('unlocked');
            });
        }
        
        // é”å®šä»˜è´¹åŠŸèƒ½
        function lockPremiumFeatures() {
            const premiumFeatures = document.querySelectorAll('.premium-feature');
            premiumFeatures.forEach(feature => {
                feature.classList.remove('unlocked');
            });
        }
        
    // å¹¿å‘Šä½å·²ç§»é™¤ï¼Œä¿ç•™å®‰å…¨çš„ no-op æ¥å£ä»¥é˜²æ—§ä»£ç è°ƒç”¨
    function showGameEndAd() { /* noop: ads provided by AdSense in head */ }
    function hideGameEndAd() { /* noop */ }
        
    // ä¸“ä¸šè®­ç»ƒåŠŸèƒ½å·²ç§»é™¤ï¼šä¿ç•™ç©ºå®ç°ä»¥é˜²å…¶ä»–ä»£ç è°ƒç”¨
    const professionalModeSettings = {};
    function setupProfessionalModes() { /* å·²ç§»é™¤ */ }
    function startProfessionalTraining() { /* å·²ç§»é™¤ */ }
    function spawnProfessionalTarget() { /* å·²ç§»é™¤ */ }
    function hitProfessionalTarget() { /* å·²ç§»é™¤ */ }
    function spawnChaosTarget() { /* å·²ç§»é™¤ */ }
    function hitChaosTarget() { /* å·²ç§»é™¤ */ }
        
        // è¯¦ç»†æ•°æ®åˆ†æåŠŸèƒ½
        function generateDetailedStats() {
            if (!vipStatus.isVIP) return null;
            
            const history = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
            const recent = history.slice(-20); // æœ€è¿‘20æ¬¡è®­ç»ƒ
            
            if (recent.length === 0) return null;
            
            // è®¡ç®—å„ç§ç»Ÿè®¡æ•°æ®
            const stats = {
                totalGames: history.length,
                averageAccuracy: recent.reduce((sum, record) => sum + record.accuracy, 0) / recent.length,
                averageReaction: recent.reduce((sum, record) => sum + record.avgReaction, 0) / recent.length,
                averageScore: recent.reduce((sum, record) => sum + record.score, 0) / recent.length,
                bestAccuracy: Math.max(...recent.map(r => r.accuracy)),
                bestReaction: Math.min(...recent.map(r => r.avgReaction)),
                bestScore: Math.max(...recent.map(r => r.score)),
                improvement: {
                    accuracy: recent.length > 5 ? 
                        recent.slice(-5).reduce((sum, r) => sum + r.accuracy, 0) / 5 - 
                        recent.slice(0, 5).reduce((sum, r) => sum + r.accuracy, 0) / 5 : 0,
                    reaction: recent.length > 5 ? 
                        recent.slice(0, 5).reduce((sum, r) => sum + r.avgReaction, 0) / 5 -
                        recent.slice(-5).reduce((sum, r) => sum + r.avgReaction, 0) / 5 : 0
                },
                consistencyScore: calculateConsistency(recent),
                strengthsAndWeaknesses: analyzePerformance(recent)
            };
            
            return stats;
        }
        
        // è®¡ç®—ä¸€è‡´æ€§å¾—åˆ†
        function calculateConsistency(records) {
            if (records.length < 3) return 0;
            
            const accuracies = records.map(r => r.accuracy);
            const reactions = records.map(r => r.avgReaction);
            
            const accStdDev = calculateStandardDeviation(accuracies);
            const reactStdDev = calculateStandardDeviation(reactions);
            
            // æ ‡å‡†å·®è¶Šå°ï¼Œä¸€è‡´æ€§è¶Šé«˜
            const consistency = Math.max(0, 100 - (accStdDev + reactStdDev / 10));
            return Math.round(consistency);
        }
        
        // è®¡ç®—æ ‡å‡†å·®
        function calculateStandardDeviation(values) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            const squaredDiffs = values.map(val => Math.pow(val - mean, 2));
            const avgSquaredDiff = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
            return Math.sqrt(avgSquaredDiff);
        }
        
        // åˆ†æä¼˜ç¼ºç‚¹
        function analyzePerformance(records) {
            const avgAccuracy = records.reduce((sum, r) => sum + r.accuracy, 0) / records.length;
            const avgReaction = records.reduce((sum, r) => sum + r.avgReaction, 0) / records.length;
            
            const strengths = [];
            const weaknesses = [];
            
            if (avgAccuracy >= 85) strengths.push('ç²¾å‡†åº¦ä¼˜ç§€');
            else if (avgAccuracy < 70) weaknesses.push('ç²¾å‡†åº¦éœ€æå‡');
            
            if (avgReaction <= 400) strengths.push('ååº”é€Ÿåº¦ä¼˜ç§€');
            else if (avgReaction > 600) weaknesses.push('ååº”é€Ÿåº¦éœ€æå‡');
            
            const consistency = calculateConsistency(records);
            if (consistency >= 80) strengths.push('è¡¨ç°ç¨³å®š');
            else if (consistency < 60) weaknesses.push('è¡¨ç°æ³¢åŠ¨è¾ƒå¤§');
            
            return { strengths, weaknesses };
        }
        
        // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡æ•°æ®
        function showDetailedStats(gameResult) {
            if (!vipStatus.isVIP) return;
            
            const detailedStats = generateDetailedStats();
            if (!detailedStats) return;
            
            const statsHtml = `
                <div class="detailed-stats">
                    <h3 style="text-align: center; color: #00ff88; margin-bottom: 20px;">ğŸ¯ VIPè¯¦ç»†æ•°æ®åˆ†æ</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-title">å¹³å‡å‡†ç¡®ç‡</div>
                            <div class="stat-value">${Math.round(detailedStats.averageAccuracy)}%</div>
                            <div class="stat-desc">æœ€è¿‘20æ¬¡è®­ç»ƒå¹³å‡å€¼</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">å¹³å‡ååº”æ—¶é—´</div>
                            <div class="stat-value">${Math.round(detailedStats.averageReaction)}ms</div>
                            <div class="stat-desc">ååº”é€Ÿåº¦è¡¨ç°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">å¹³å‡å¾—åˆ†</div>
                            <div class="stat-value">${Math.round(detailedStats.averageScore)}</div>
                            <div class="stat-desc">ç»¼åˆè¡¨ç°è¯„ä¼°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">ç¨³å®šæ€§è¯„åˆ†</div>
                            <div class="stat-value">${detailedStats.consistencyScore}%</div>
                            <div class="stat-desc">è¡¨ç°ä¸€è‡´æ€§æŒ‡æ ‡</div>
                        </div>
                    </div>
                    
                    <div class="progress-chart">
                        <div class="chart-title">ğŸš€ è¿›æ­¥è¶‹åŠ¿åˆ†æ</div>
                        <div class="progress-bars">
                            <div class="progress-item">
                                <div class="progress-label">å‡†ç¡®ç‡è¿›æ­¥</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.max(0, Math.min(100, 50 + detailedStats.improvement.accuracy * 2))}%"></div>
                                </div>
                                <div class="progress-value">${detailedStats.improvement.accuracy > 0 ? '+' : ''}${Math.round(detailedStats.improvement.accuracy * 10) / 10}%</div>
                            </div>
                            <div class="progress-item">
                                <div class="progress-label">ååº”æ—¶é—´</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.max(0, Math.min(100, 50 + detailedStats.improvement.reaction / 10))}%"></div>
                                </div>
                                <div class="progress-value">${detailedStats.improvement.reaction > 0 ? '-' : '+'}${Math.round(Math.abs(detailedStats.improvement.reaction))}ms</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="background: rgba(0,255,136,0.1); border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00ff88; margin-bottom: 10px;">ğŸ’ª ä¼˜åŠ¿é¡¹ç›®</h4>
                            ${detailedStats.strengthsAndWeaknesses.strengths.length > 0 ? 
                                detailedStats.strengthsAndWeaknesses.strengths.map(s => `<div style="margin: 5px 0; font-size: 13px;">â€¢ ${s}</div>`).join('') : 
                                '<div style="opacity: 0.7; font-size: 13px;">ç»§ç»­åŠ æ²¹ï¼</div>'}
                        </div>
                        <div style="background: rgba(255,107,53,0.1); border-radius: 10px; padding: 15px;">
                            <h4 style="color: #ff6b35; margin-bottom: 10px;">ğŸ¯ æå‡ç©ºé—´</h4>
                            ${detailedStats.strengthsAndWeaknesses.weaknesses.length > 0 ? 
                                detailedStats.strengthsAndWeaknesses.weaknesses.map(w => `<div style="margin: 5px 0; font-size: 13px;">â€¢ ${w}</div>`).join('') : 
                                '<div style="opacity: 0.7; font-size: 13px;">è¡¨ç°ä¼˜ç§€ï¼</div>'}
                        </div>
                    </div>
                </div>
            `;
            
            // æ’å…¥åˆ°æ¸¸æˆç»“æŸç»Ÿè®¡ä¸­
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML += statsHtml;
        }
        
        // VIP æˆå°±ç³»ç»Ÿå·²ç¦ç”¨ï¼ˆæŒ‰ç”¨æˆ·è¦æ±‚å–æ¶ˆè´¦æˆ·ä¸ VIPï¼‰
        // ä¿ç•™ç®€çŸ­å ä½ä»¥é¿å…è¿è¡Œæ—¶å¼•ç”¨é”™è¯¯ã€‚
        const vipAchievements = {};

        function checkVIPAchievements(gameResult) {
            // VIP åŠŸèƒ½å·²ç§»é™¤ â€” no-op
            return;
        }

        function showVIPAchievements(achievementIds) {
            // VIP åŠŸèƒ½å·²ç§»é™¤ â€” no-op
            return;
        }
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½VIPçŠ¶æ€
        function initializeApp() {
            console.log('åˆå§‹åŒ–åº”ç”¨...');
            loadVIPStatus();
            // è´¦æˆ·ç³»ç»Ÿåˆå§‹åŒ–
            loadAccounts();
            updateAccountUI();
            setupProfessionalModes();
            
            // ç¡®ä¿ç‚¹å‡»å¼¹çª—èƒŒæ™¯èƒ½å…³é—­å¼¹çª—
            const purchaseModal = document.getElementById('purchaseModal');
            if (purchaseModal) {
                purchaseModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closePurchaseModal();
                    }
                });
            }

            const accountModal = document.getElementById('accountModal');
            if (accountModal) {
                accountModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeAccountModal();
                    }
                });
            }

            // ç»‘å®šæ”¯ä»˜æ–¹å¼æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const payWeChat = document.getElementById('payWeChat');
            const payAlipay = document.getElementById('payAlipay');
            const payPaypal = document.getElementById('payPaypal');
            if (payWeChat && payAlipay && payPaypal) {
                const buttons = [payWeChat, payAlipay, payPaypal];
                buttons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        buttons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                // é»˜è®¤é€‰ä¸­å¾®ä¿¡
                payWeChat.classList.add('active');
            }
            
            console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼ŒVIPçŠ¶æ€:', vipStatus);
        }

    function openAccountModal() { alert('è´¦æˆ·åŠŸèƒ½å·²å–æ¶ˆ'); }

        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
        }
        
        // å¤šç§æ–¹å¼ç¡®ä¿åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½åä¹Ÿæ‰§è¡Œä¸€æ¬¡
        window.addEventListener('load', function() {
            setTimeout(initializeApp, 100);
        });

        // --- æ–°å¢ï¼šæ¢å¤è´­ä¹°ä¸å¹¿å‘Šè½®æ’­é€»è¾‘ ---

    // è´¦æˆ·ä¸VIPåŠŸèƒ½å·²å–æ¶ˆï¼Œä¸‹é¢ä¸ºå®‰å…¨çš„ç©ºå®ç°ä»¥é¿å…è¿è¡Œæ—¶æŠ¥é”™
    function registerAccount() { alert('è´¦æˆ·åŠŸèƒ½å·²å–æ¶ˆ'); }
    function loginAccount() { alert('è´¦æˆ·åŠŸèƒ½å·²å–æ¶ˆ'); }
    function logoutAccount() { /* noop */ }
    function updateAccountUI() { /* noop */ }
    function changePasswordPrompt() { alert('è´¦æˆ·åŠŸèƒ½å·²å–æ¶ˆ'); }
    function deleteAccountPrompt() { alert('è´¦æˆ·åŠŸèƒ½å·²å–æ¶ˆ'); }
    function changePassword() { /* noop */ }
    function deleteAccount() { return false; }

        function getCurrentUser() {
            return currentUser;
        }

        function saveAccountReceipt(receipt) {
            // attach receipt to current user if exists
            loadAccounts();
            if (!currentUser) {
                // fallback: save to global vipReceipt
                localStorage.setItem('vipReceipt', JSON.stringify(receipt));
                return;
            }
            const a = accounts[currentUser] || { passwordHash: null, receipts: [], vipStatus: null };
            a.receipts = a.receipts || [];
            a.receipts.push(receipt);
            // also update user's vipStatus
            a.vipStatus = {
                plan: receipt.plan,
                purchaseDate: receipt.purchaseDate,
                receiptId: receipt.receiptId,
                expiryDate: new Date(new Date(receipt.purchaseDate).setMonth(new Date(receipt.purchaseDate).getMonth() + 1)).toISOString(),
                features: { removeAds: true, premiumModes: false, detailedStats: false }
            };
            accounts[currentUser] = a;
            saveAccounts();
        }

        function restorePurchasesForCurrentUser() {
            // è´¦æˆ·/è´­ä¹°ç³»ç»Ÿå·²è¢«ç”¨æˆ·å–æ¶ˆ â€” ä¸æ‰§è¡Œæ¢å¤æ“ä½œ
            alert('æ¢å¤è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ');
            return;
        }

        function applyReceiptToVIP(receipt) {
            const now = new Date();
            const expiry = new Date(now.setMonth(now.getMonth() + 1));
            vipStatus = {
                isVIP: true,
                plan: receipt.plan || 'monthly',
                expiryDate: expiry.toISOString(),
                purchaseDate: receipt.purchaseDate || new Date().toISOString(),
                receiptId: receipt.receiptId,
                features: { removeAds: true, premiumModes: false, detailedStats: false }
            };
            localStorage.setItem('vipStatus', JSON.stringify(vipStatus));
            updateVIPUI();
            showSuccessMessage('monthly');
        }

        // ===== ç»“æŸè´¦æˆ·ç³»ç»Ÿ =====

    function saveMockReceipt() { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); return null; }

        // æ¢å¤è´­ä¹°ï¼ˆä»æœ¬åœ°æ”¶æ®ï¼‰
    function simulateRestorePurchase() { alert('æ¢å¤è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }

        // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸæµç¨‹ï¼ˆä¸»å®ç°ï¼‰
    function simulateSuccessfulPayment() { alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ'); }

        // æ˜¾ç¤ºVIPç®¡ç†é¢æ¿ï¼ˆç®€å•å®ç°ï¼‰
        function showVIPManagement() {
            const saved = JSON.parse(localStorage.getItem('vipStatus') || '{}');
            if (!saved.isVIP) {
                alert('å½“å‰æœªä¸ºVIPã€‚è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆã€‚');
                return;
            }

            const expiry = saved.expiryDate ? new Date(saved.expiryDate).toLocaleString() : 'æ°¸ä¹…';
            const plan = saved.plan || 'æœªçŸ¥';
            const receipt = saved.receiptId ? ('æ”¶æ®ID: ' + saved.receiptId) : '';

            const msg = `å½“å‰VIP: ${plan}\nåˆ°æœŸæ—¶é—´: ${expiry}\n${receipt}\n\næ‚¨å¯ä»¥é€‰æ‹©é€€å‡ºVIPä»¥æ¢å¤å¹¿å‘Šï¼ˆæœ¬åœ°æ“ä½œï¼‰ã€‚å¦‚éœ€åœ¨å•†åº—å–æ¶ˆè®¢é˜…ï¼Œè¯·åœ¨ç›¸åº”åº”ç”¨/å¹³å°ç®¡ç†è®¢é˜…ã€‚`;
            if (confirm(msg)) {
                // æä¾›ä¸€ä¸ªé€€å‡ºVIPçš„é€‰é¡¹
                resetVIPStatus();
            }
        }

        // ä»èœå•ç›´æ¥è¿›å…¥ä¸“ä¸šè®­ç»ƒï¼ˆéœ€è¦VIPï¼‰
        function startProfessionalFromMenu() {
            if (!vipStatus.isVIP) {
                // æç¤ºå¹¶è·³è½¬åˆ°è´­ä¹°å¼¹çª—
                if (confirm('ä¸“ä¸šè®­ç»ƒä¸ºVIPä¸“å±åŠŸèƒ½ï¼Œæ˜¯å¦å‰å¾€å‡çº§ï¼Ÿ')) {
                    alert('è´­ä¹°åŠŸèƒ½å·²å–æ¶ˆ');
                }
                return;
            }

            // VIP ç”¨æˆ·ç›´æ¥è¿›å…¥ä¸“ä¸šè®­ç»ƒè®¾ç½®å¹¶æ‰“å¼€ä¸“ä¸šæ¨¡å¼é€‰æ‹©
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameHeader').style.display = 'block';
            gameState.trainingMode = 'professional';
            // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªä¸“ä¸šæ¨¡å¼
            const firstPro = document.querySelector('.pro-mode-btn');
            if (firstPro) firstPro.classList.add('active');
            setupProfessionalModes();
            startProfessionalTraining();
        }

        // å¹¿å‘Šè½®æ’­ï¼ˆéVIPæ—¶å¯ç”¨ï¼‰ï¼šç®€å•è½®æ’­æ–‡æ¡ˆ
        let adRotationInterval = null;
        const ads = [
            {title: 'å®šä½ç²¾åº¦ä¼˜åŒ–', detail: 'æå‡å®šä½ç²¾åº¦ï¼Œæ¨èå‹å·ï¼šX-Pro', action: 'showXProInfo'},
            {title: 'äººä½“å·¥å­¦æœºæ¢°é”®ç›˜', detail: 'é•¿æ—¶é—´è®­ç»ƒä¹Ÿæ›´èˆ’é€‚'},
            {title: 'ä¸“ä¸šé¼ æ ‡å«', detail: 'ä½æ‘©æ“¦/é«˜ç¨³å®šï¼Œæå‡è¿½è¸ªè¡¨ç°'},
            {title: 'è®­ç»ƒè®¡åˆ’è®¢åˆ¶', detail: 'ä¸“å®¶å®šåˆ¶è®­ç»ƒè®¡åˆ’ï¼Œæé«˜æ•ˆç‡'}
        ];

        function startAdRotation() {
            stopAdRotation();
            if (vipStatus.isVIP) return; // VIP ä¸æ˜¾ç¤ºè½®æ’­

            const adElements = document.querySelectorAll('.ad-banner');
            let index = 0;
            adRotationInterval = setInterval(() => {
                adElements.forEach(ad => {
                    const content = `<div style=\"display:flex;flex-direction:column;align-items:center;\"><div style=\"font-size:18px;margin-bottom:6px;\">${ads[index].title}</div><div style=\"font-size:13px;opacity:0.85;\">${ads[index].detail}</div></div>`;
                    ad.innerHTML = content;
                    // keep ad label
                    const label = document.createElement('div');
                    label.style.cssText = 'position:absolute;top:5px;right:8px;font-size:10px;opacity:0.5;';
                    label.textContent = 'å¹¿å‘Š';
                    ad.appendChild(label);
                });
                index = (index + 1) % ads.length;
            }, 4000);
        }

        function stopAdRotation() {
            if (adRotationInterval) {
                clearInterval(adRotationInterval);
                adRotationInterval = null;
            }
        }

        // åœ¨VIPçŠ¶æ€æ›´æ–°æ—¶æ§åˆ¶å¹¿å‘Šè½®æ’­
        const originalUpdateVIPUI = updateVIPUI;
        updateVIPUI = function() {
            originalUpdateVIPUI();
            if (vipStatus.isVIP) {
                stopAdRotation();
            } else {
                startAdRotation();
            }
        };

        // å¯åŠ¨å¹¿å‘Šè½®æ’­ï¼ˆé¡µé¢åŠ è½½åï¼‰
        window.addEventListener('load', function() {
            setTimeout(() => {
                startAdRotation();
            }, 200);
        });

        // --- ç»“æŸæ–°å¢å†…å®¹ ---
        // --- i18n ç®€æ˜“å®ç° ---
        const i18n = {
            zh: {
                subtitle: 'ä¸“ä¸šçº§ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦è®­ç»ƒå¹³å°',
                choose_mode: 'ğŸ® é€‰æ‹©è®­ç»ƒæ¨¡å¼',
                reaction_mode: 'ååº”é€Ÿåº¦è®­ç»ƒ',
                reaction_desc: 'ç‚¹å‡»éšæœºç›®æ ‡ï¼Œæå‡ååº”é€Ÿåº¦å’Œç²¾å‡†åº¦',
                tracking_mode: 'è¿½è¸ªè®­ç»ƒ',
                tracking_desc: 'è·Ÿè¸ªç§»åŠ¨ç›®æ ‡ï¼Œæå‡åŠ¨æ€ååº”èƒ½åŠ›',
                schulte_mode: 'èˆ’å°”ç‰¹æ–¹æ ¼è®­ç»ƒ',
                schulte_desc: 'æŒ‰é¡ºåºç‚¹å‡»æ•°å­—ï¼Œæå‡æ³¨æ„åŠ›å’Œè§†è§‰æœç´¢èƒ½åŠ›',
                training_mode: 'è®­ç»ƒæ¨¡å¼',
                mode_normal: 'æ™®é€šæ¨¡å¼',
                mode_flick: 'å¿«é€Ÿåˆ‡æ¢',
                mode_tracking: 'è·Ÿè¸ªè®­ç»ƒ',
                easy_label: 'ğŸŸ¢ æ–°æ‰‹',
                easy_stats: 'ç›®æ ‡: 60px\næŒç»­: 2.5s\né—´éš”: 800ms',
                medium_label: 'ğŸŸ¡ è¿›é˜¶',
                medium_stats: 'ç›®æ ‡: 45px\næŒç»­: 2.0s\né—´éš”: 600ms',
                hard_label: 'ğŸŸ  å›°éš¾',
                hard_stats: 'ç›®æ ‡: 35px\næŒç»­: 1.5s\né—´éš”: 400ms',
                expert_label: 'ğŸ”´ ä¸“å®¶',
                expert_stats: 'ç›®æ ‡: 25px\næŒç»­: 1.2s\né—´éš”: 300ms',
                label_duration: 'æ¸¸æˆæ—¶é•¿',
                opt_30s: '30ç§’',
                opt_60s: '60ç§’',
                opt_90s: '90ç§’',
                opt_2min: '2åˆ†é’Ÿ',
                label_target_style: 'ç›®æ ‡æ ·å¼',
                opt_head: 'å¤´éƒ¨å½¢çŠ¶',
                opt_circle: 'åœ†å½¢',
                opt_square: 'æ–¹å½¢',
                label_sound: 'éŸ³æ•ˆåé¦ˆ',
                opt_on: 'å¼€å¯',
                opt_off: 'å…³é—­',
                label_training_mode: 'è®­ç»ƒæ¨¡å¼',
            },
            en: {
                subtitle: 'Professional reaction speed & precision trainer',
                choose_mode: 'ğŸ® Choose training mode',
                reaction_mode: 'Reaction Speed',
                reaction_desc: 'Click appearing targets to improve speed and accuracy',
                tracking_mode: 'Tracking',
                tracking_desc: 'Follow moving targets to improve dynamic response',
                schulte_mode: 'Schulte Grid',
                schulte_desc: 'Click numbers in order to improve attention and visual search',
                training_mode: 'Training mode',
                mode_normal: 'Normal',
                mode_flick: 'Flick',
                mode_tracking: 'Tracking',
                easy_label: 'ğŸŸ¢ Easy',
                easy_stats: 'Target: 60px\nDuration: 2.5s\nInterval: 800ms',
                medium_label: 'ğŸŸ¡ Medium',
                medium_stats: 'Target: 45px\nDuration: 2.0s\nInterval: 600ms',
                hard_label: 'ğŸŸ  Hard',
                hard_stats: 'Target: 35px\nDuration: 1.5s\nInterval: 400ms',
                expert_label: 'ğŸ”´ Expert',
                expert_stats: 'Target: 25px\nDuration: 1.2s\nInterval: 300ms',
                label_duration: 'Game duration',
                opt_30s: '30s',
                opt_60s: '60s',
                opt_90s: '90s',
                opt_2min: '2 min',
                label_target_style: 'Target style',
                opt_head: 'Head shape',
                opt_circle: 'Circle',
                opt_square: 'Square',
                label_sound: 'Sound effects',
                opt_on: 'On',
                opt_off: 'Off',
                label_training_mode: 'Training mode',
            }
        };

        function getStoredLang() {
            return localStorage.getItem('i18n_lang') || 'zh';
        }

        function changeLanguage(lang) {
            if (!i18n[lang]) return;
            localStorage.setItem('i18n_lang', lang);
            translateAll(lang);
        }

        function t(key) {
            const lang = getStoredLang();
            return (i18n[lang] && i18n[lang][key]) || key;
        }

        function translateAll(lang) {
            lang = lang || getStoredLang();
            const sel = document.getElementById('langSelect');
            if (sel) sel.value = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const text = (i18n[lang] && i18n[lang][key]) || el.textContent;
                el.textContent = text;
            });
        }

        window.addEventListener('DOMContentLoaded', function() {
            translateAll(getStoredLang());
        });
        window.addEventListener('load', function() { translateAll(getStoredLang()); });
    </script>
</body>
</html>
